/*!
* xhear v5.2.0
* https://github.com/kirakiray/Xhear#readme
* 
* (c) 2018-2020 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const s=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),a=e=>void 0===e,n=e=>s(e).includes("function"),i=e=>JSON.parse(JSON.stringify(e)),l=(()=>{if(null!==document.currentScript.getAttribute("debug")){let e=new Map;return(r,s)=>{s||(s=t());let a=e.get(s);clearTimeout(a),e.set(s,setTimeout(()=>{r(),e.delete(s)}))}}let e=!1,r=new Map,s=setTimeout;return"object"==typeof process&&process.nextTick&&(s=process.nextTick),(a,n)=>{e||(e=!0,s(()=>{r.size&&r.forEach(({key:e,fun:t})=>{try{t()}catch(e){console.error(e)}r.delete(e)}),r.clear(),e=!1})),n||(n=t()),r.set(n,{key:n,fun:a})}})(),o=(e,r,s,a)=>{let n;n=e._modifyId?e._modifyId:t(),C(e,_).push(n),d(e);let l=new v({type:"update",target:e[E]||e});Object.defineProperties(l,{trend:{get:()=>new $(l)}}),a&&Object.assign(l,a),l.modify={name:r,args:s.map(e=>e instanceof I?e.object:e instanceof Object?i(e):e),mid:n},e.emit(l)};let c,h=new Set;const d=e=>{e[_].length<50||(clearTimeout(c),h.add(e),c=setTimeout(()=>{let e=Array.from(h);setTimeout(()=>{e.forEach(e=>d(e))},1e3),h.forEach(e=>{let t=e[_];t.splice(0,Math.ceil(t.length/2))}),h.clear()},3e3))},u=e=>{if(!(e instanceof I))return;let t=e[O];if(t)try{t.index=void 0,t.parent=void 0}catch(e){}if(e instanceof F){let{mappingXData:r}=e,s=r[A].find(e=>e.data===t),{leftUpdate:a,rightUpdate:n}=s;e.off("update",n),r.off("update",a),t.mappingXData=null}if(t[D])for(let[e,r]of t[D])t.unsync(e);t[A]&&(t[A].forEach(e=>{let{data:r,leftUpdate:s,rightUpdate:a}=e;r.off("update",a),t.off("update",s),r.mappingXData=null}),t[A].splice(0)),t[k]&&t[k].clear(),t[g]&&t[g].clear()},f=(e,t)=>{let r=e;switch(s(e)){case"object":case"array":r=new I(e,t)}return r},p=(e,t)=>{if(e instanceof Array)return e.map(e=>p(e,t));if(e instanceof Object){let r={},s=[];return Object.keys(e).forEach(a=>{/\D/.test(a)?r[a]=p(e[a]):s.push(p(e[a],t))}),s.length&&(r[t]=s),r}return e},g=Symbol("events"),b=(e,t)=>{let r=t[g];r||(r=new Map,Object.defineProperty(t,g,{value:r}));let s=r.get(e);return s||(s=[],r.set(e,s)),s},m=(e,t)=>{let r;return e instanceof v?e=(r=e).type:r=new v({type:e,target:t[E]||t}),r};class y{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,r){this.addListener({type:e,data:r,callback:t})}one(e,t,r){this.addListener({count:1,type:e,data:r,callback:t})}addListener(e={}){let{type:t,data:r,callback:s,count:n=1/0,eventId:i}=e;if(!t)throw{desc:"addListener no type",options:e};let l=t.split("#");1 in l&&(t=l[0],i=l[1]);let o=b(t,this);a(i)||Array.from(o).some(e=>{if(e.eventId===i){let t=o.indexOf(e);return t>-1&&o.splice(t,1),!0}}),s&&o.push({type:t,data:r,callback:s,eventId:i,count:n})}off(e,t){if(e){if(!t)throw{desc:"off must have callback"};{let r=b(e,this),s=r.findIndex(e=>e.callback==t);s>-1&&r.splice(s,1)}}}emitHandler(e,t){let r=m(e,this);e=r.type;let s=b(e,this),a=[];return r.currentTarget=this[E]||this,s.some(e=>{e.data&&(r.data=e.data),e.eventId&&(r.eventId=e.eventId);let s={self:this,event:r,emitData:t};if((e.before?e.before(s):1)&&e.callback.call(this[E]||this,r,t),e.after&&e.after(s),delete r.data,delete r.eventId,e.count--,e.count||a.push(e),r.cancel)return!0}),delete r.currentTarget,a.forEach(e=>{let t=s.indexOf(e);t>-1&&s.splice(t,1)}),r}emit(e,t){let r=this.emitHandler(e,t);if(r.bubble&&!r.cancel){let{parent:e}=this;e&&(r.keys.unshift(this.index),e.emit(r,t))}}}class v extends y{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const x=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,w=/^parent$|^index$|^length$|^object$/;let j={get:(e,t,r)=>"symbol"==typeof t||x.test(t)?Reflect.get(e,t,r):e.getData(t),set:(e,t,r,s)=>"symbol"==typeof t?Reflect.set(e,t,r,s):e.setData(t,r)};const E=Symbol("proxyThis"),O=Symbol("XDataSelf"),k=Symbol("WatchHost"),_=Symbol("ModifyIDS"),D=Symbol("SyncHost"),A=Symbol("VirDataHost"),S=Symbol("StanzID"),C=(e,t)=>{let r=e[t];if(!r){switch(t){case k:case D:r=new Map;break;case _:case A:r=[]}Object.defineProperty(e,t,{value:r})}return r},P="undefined"!=typeof Element;class I extends y{constructor(e,r={}){super(r);let s=new Proxy(this,j),a=0;Object.keys(e).forEach(t=>{let r=e[t];/^\_/.test(t)||P&&r instanceof Element?Object.defineProperty(this,t,{configurable:!0,writable:!0,value:r}):(/\D/.test(t)||(t=parseInt(t))>=a&&(a=t+1),r instanceof Object?this[t]=new I(r,{parent:this,index:t}):this[t]=r)});const n=t();Object.defineProperties(this,{[O]:{get:()=>this},[E]:{value:s},[S]:{value:n},xid:{get:()=>n},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:a}})}setData(e,t){if(w.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let r=this[O];if(/\./.test(e)){let s=e.split("."),a=s.length-1;return s.some((t,s)=>{if(s==a)return e=t,!0;r=r[t]}),r.setData(e,t),!0}if("string"===s(e)){let s=r[e];return t===s||(s instanceof I&&(s=s.object),t instanceof I?((t=t[O]).remove(),t.parent=r,t.index=e):t instanceof Object&&(t=f(t,{parent:r,index:e})),r[e]=t,o(r,"setData",[e,t],{oldValue:s}),!0)}if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let s=t[e];r.setData(e,s)}),!0}}getData(e){let t=this[e];return t instanceof I&&(t=t[E]),t}remove(e){if(a(e)){let{parent:e}=this;e?e.remove(this.index):u(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],u(t),o(this,"remove",[e])):this.splice(parseInt(e),1)}}deepClear(){Object.keys(this).forEach(e=>{if(/\D/.test(e)){let t=this[e];t instanceof I&&t.deepClear()}}),this.forEach(e=>{e instanceof I&&e.deepClear()}),u(this)}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return f(i(this))[E]}emitHandler(e,t){let r=m(e,this);if("update"===r.type){let{_unBubble:e,_update:t,_unpush:s}=this,{fromKey:a}=r.trend;(!1===t||e&&e.includes(a))&&(r.bubble=!1),s&&s.includes(a)&&Object.defineProperty(r,"_unpush",{value:!0})}return y.prototype.emitHandler.call(this,r,t),r}noStanz(e={childKey:"children"}){return p(this.object,e.childKey)}get object(){let e={},t=!0,{_unBubble:r=[]}=this;return Object.keys(this).forEach(s=>{if(/^_/.test(s)||!/\D/.test(s)||r.includes(s))return;let a=this[s];if(a instanceof I){if(!1===a._update)return;a=a.object}e[s]=a,t=!1}),this.forEach((t,r)=>{t instanceof I&&(t=t.object),e[r]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}getTarget(e){let t=this;return e.length&&e.forEach(e=>{t=t[e]}),t}seek(e){let t=s(e);if("function"===t){let t=[],r=r=>{if(r instanceof I){e(r)&&t.push(r);let s=r.seek(e);t=[...t,...s]}};return Object.keys(this).forEach(e=>{/\D/.test(e)&&r(this[e])}),this.forEach(r),r=null,t}if("string"===t){let t,r=(e=e.replace(/[\[\]]/g,"")).split("=");if(2==r.length){let[e,s]=r;t=(t=>t[e]==s)}else{let[e]=r;t=(t=>Object.keys(t).includes(e))}return this.seek(t)}}watch(e,t,r){let a,n=s(e);if("object"===n)return void Object.keys(e).forEach(t=>{this.watch(t,e[t])});/function/.test(n)&&(r=t,t=e,e=""),a=""===e?"watchSelf":e instanceof RegExp?"watchKeyReg":/\[.+\]/.test(e)?"seekData":/\./.test(e)?"watchPointKey":"watchKey";let i=C(this,k).get(e);i||(i=new Set,C(this,k).set(e,i));let o,c={trends:[],callback:t,expr:e};i.add(c);let h=this[E];switch(a){case"watchSelf":o=(e=>{c.trends.push(e.trend),l(()=>{t.call(h,{trends:Array.from(c.trends)},h),c.trends.length=0},c)}),!0===r&&t.call(h,{trends:[]},h);break;case"watchKey":case"watchKeyReg":o=(r=>{let{trend:s}=r;("watchKeyReg"===a&&e.test(s.fromKey)||s.fromKey==e)&&(c.trends.push(r.trend),c.cacheOld||(c._oldVal=r.oldValue instanceof I?r.oldValue.object:r.oldValue,c.cacheOld=!0),l(()=>{let r=this[e];t.call(h,{expr:e,val:r,old:c._oldVal,trends:Array.from(c.trends)},r),c.trends.length=0,c._oldVal=c.cacheOld=!1},c))}),!0===r&&t.call(h,{expr:e,val:h[e],trends:[]},h[e]);break;case"watchPointKey":let s=e.split("."),n=s[0],i=this.getTarget(s);o=(r=>{let{trend:a}=r;if(a.fromKey==n){let n;try{n=this.getTarget(s)}catch(r){}n!==i&&(c.trends.push(a),l(()=>{(n=this.getTarget(s))!==i&&t.call(h,{expr:e,old:i,val:n,trends:Array.from(c.trends)},n),c.trends.length=0},c))}}),!0===r&&t.call(h,{expr:e,val:i},i);break;case"seekData":let d=h.seek(e);o=(r=>{l(()=>{let r=h.seek(e),s=1;r.length===d.length?r.some(e=>{if(!d.includes(e))return s=0,!0}):s=0,!s&&t.call(h,{expr:e,old:d,val:r},r),d=r},c)}),!0===r&&t.call(h,{expr:e,old:d,val:d},d)}return this.on("update",o),c.updateMethod=o,this}unwatch(e,t){let r=s(e);if("object"===r)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(r)&&(t=e,e="");let a=C(this,k).get(e);if(a){let r=Array.from(a).find(r=>r.callback===t&&r.expr===e);r&&(r.updateMethod&&this.off("update",r.updateMethod),a.delete(r),!a.size&&C(this,k).delete(e))}return this}watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r,s=new Function(`\n            try{with(this){\n                return ${e}\n            }}catch(e){}`).bind(this);this.watch(r=(()=>{let e=s();e&&(this.unwatch(r),t(e))}),!0)})}entrend(e){let{mid:t,keys:r,name:s,args:a,_unpush:n}=e;if(n)return;let{_unpull:i}=this,l=T(e);if(i&&i.includes(l))return;if(!t)throw{text:"Illegal trend data"};let o=this.getTarget(r)[O];return!C(o,_).includes(t)&&(o._modifyId=t,o[s](...a),o._modifyId=null,!0)}}const T=e=>{let t=e.keys[0];return!a(t)||"setData"!==e.name&&"remove"!==e.name||(t=e.args[0]),t};class ${constructor(e){if(e instanceof v){let{modify:{name:t,args:r,mid:s},keys:a}=i(e),{_unpush:n}=e;n&&Object.defineProperty(this,"_unpush",{value:!0}),Object.assign(this,{name:t,args:r,mid:s,keys:a})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){return T(this)}set fromKey(e){let t=this.keys[0];a(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}const L=(e,t,r)=>{t.trends.forEach(t=>{t.fromKey===e&&r.entrend(t)})},M=(e,t,r)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&r.entrend(t)})},N=(e,t,r)=>{i(t.trends).forEach(t=>{t=new $(t);let{fromKey:s}=t;if(!a(s)){let a=e.get(s);a&&(t.fromKey=a,r.entrend(t))}})},H=e=>(e instanceof I&&(e=e.object),e),K=(e,t,r)=>{Object.keys(e).forEach(s=>{let a=e[s];if(a instanceof Object){t[s]||(t.setData?t.setData(s,{}):t[s]={});let e=t[s];K(a,e,r)}else{let n=r([s,a],{self:e,target:t});if(n){let[e,r]=n;t[e]=r}}})},V=(e,t,r)=>{let{trend:s}=t;if(s){switch(s.name){case"setData":let e=s.args[1];if(e instanceof Object){let t={};K(e,t,r),s.args[1]=t}else a(e)||(s.args=r(s.args,{event:t}));break;default:s.args=s.args.map(e=>{let t=e;return e instanceof Object&&K(e,t={},r),t})}e.entrend(s)}},W={sync(e,t,r){let a,n;switch(s(t)){case"string":r&&e.setData(t,H(this[t])),a=(r=>L(t,r,e)),n=(e=>L(t,e,this));break;case"array":r&&t.forEach(t=>{e.setData(t,H(this[t]))}),a=(r=>M(t,r,e)),n=(e=>M(t,e,this));break;case"object":let i=new Map(Object.entries(t)),l=new Map(Object.entries(t).map(e=>e.reverse()));r&&Object.keys(t).forEach(r=>{e.setData(t[r],H(this[r]))}),a=(t=>N(i,t,e)),n=(e=>N(l,e,this));break;default:if(r){let t=this.object;Object.keys(t).forEach(r=>{e.setData(r,t[r])})}a=(t=>t.trends.forEach(t=>e.entrend(t))),n=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(a),e.watch(n);let i=C(this,D);i.has(e)&&this.unsync(e),i.set(e,{selfWatch:a,oppWatch:n}),C(e,D).set(this,{selfWatch:n,oppWatch:a})},unsync(e){let t=C(this,D).get(e);if(t){let{selfWatch:r,oppWatch:s}=t;this.unwatch(r),e.unwatch(s),C(this,D).delete(e),C(e,D).delete(this)}},virData(e,t){let r,a,n=new F(this[O],{}),i=s(e),l=e;if("object"==i)if("mapKey"in l){let r=Object.entries(l.mapKey),s=new Map(r),a=new Map(r.map(e=>e.reverse()));e=(([e,t])=>s.has(e)?[s.get(e),t]:[e,t]),t=(([e,t])=>a.has(e)?[a.get(e),t]:[e,t])}else if("mapValue"in l){let r=l.key,s=Object.entries(l.mapValue),a=new Map(s),n=new Map(s.map(e=>e.reverse()));e=(([e,t])=>e===r&&a.has(t)?[e,a.get(t)]:[e,t]),t=(([e,t])=>e===r&&n.has(t)?[e,n.get(t)]:[e,t])}return K(this,n,e),this.on("update",r=(t=>V(n,t,e))),n.on("update",a=(e=>V(this,e,t))),C(this,A).push({data:n,leftUpdate:r,rightUpdate:a}),n[E]}};Object.keys(W).forEach(e=>{Object.defineProperty(I.prototype,e,{writable:!0,value:W[e]})});class F extends I{constructor(e,...t){super(...t),Object.defineProperty(this,"mappingXData",{writable:!0,value:e})}}["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...e){return t.apply(this,e)}})}),["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...r){let s=[],a=this[O],n=a.object;r.forEach(e=>{if(e instanceof I){let t=e[O];t.remove(),s.push(t)}else{let t=f(e,{parent:a});s.push(t)}});let i=t.apply(a,s);switch(a.forEach((e,t)=>{e instanceof I&&(e.index=t)}),e){case"shift":case"pop":i instanceof I&&u(i);break;case"splice":i.forEach(e=>{e instanceof I&&u(e)})}return o(a,e,r,{oldValue:n}),i}})}),Object.defineProperties(I.prototype,{sort:{value(e){let t=[],r=this[O],s=r.object,a=Array.from(r);if(n(e)||!e){Array.prototype.sort.call(r,e),r.forEach((e,t)=>{e instanceof I&&(e.index=t)}),t=[a.map(e=>e.index)],a=null}else e instanceof Array&&(e.forEach((e,t)=>{(r[e]=a[t]).index=e}),t=[e]);return o(r,"sort",t,{oldValue:s}),this}}});const J=(e,t)=>{if(e===t)return!0;if(e===document)return!1;let r=document.createElement("template"),s=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`;return r.innerHTML=s,!!r.content.querySelector(t)},U=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let{data:r}=e;if(r&&Object.keys(r).forEach(e=>{let s=r[e];t.dataset[e]=s}),t.xvele){let r=ve(t);r[G].forEach(t=>{let s=e[t];a(s)||(r[t]=s)})}let s=0;for(;s in e;){let r=U(e[s]);t.appendChild(r),s++}return t},X=e=>{let t;if(e instanceof re)return e.ele;switch(s(e)){case"string":/\<.+\>/.test(e)&&(t=(t=(e=>{let t=document.createElement("div");return t.innerHTML=e,Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e))[0]);break;case"object":t=U(e);break;default:(e instanceof Element||e instanceof DocumentFragment||e instanceof Document)&&(t=e)}return t},B=(e,t)=>{let r=e.querySelectorAll(t);return r?Array.from(r):[]},R=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),q=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),z={get:function(e,t){return e._ele.getAttribute(q(t))},set:function(e,t,r){return null===r?e._ele.removeAttribute(q(t)):e._ele.setAttribute(q(t),String(r)),!0}};const Z=e=>{let t=e.__p_attrs;return t||(e.__p_attrs=t=new Proxy(new class{constructor(e){Object.defineProperties(this,{_ele:{get:()=>e}})}}(e),z)),t},G=Symbol("cansetkeys"),Q=Symbol("orignEvents"),Y=new Set(["text","html","display","style"]),ee=new Set(["parent","index","slot"]),te=I.prototype.setData;class re extends I{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this,configurable:!0}});let t=e.tagName?e.tagName.toLowerCase():"";Object.defineProperties(this,{tag:{enumerable:!0,value:t},ele:{value:e},[Q]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?xe(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){if("string"==s(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),a=Object.keys(e);r.forEach(e=>{a.includes(e)||(t[e]="")}),Object.assign(t,e)}get $shadow(){let{shadowRoot:e}=this.ele;return e&&xe(e)}get $root(){let e=this.ele;for(;e.parentNode;)e=e.parentNode;return e&&xe(e)}get $host(){let{$root:e}=this;return e&&e.ele.host&&xe(e.ele.host)}get attrs(){return Z(this.ele)}moni(e,t){let r;this.watch(()=>{let s=this.all(e),a=!0;if(r&&r.length==s.length?s.some(e=>{if(!r.includes(e))return a=!1,!0}):a=!1,a)return;let n={old:r,val:s};r=s,t(s,n)},!0)}setData(e,t){if(ee.has(e))return console.warn("can't set this key => ",e),!1;e=R(e);let r=this[O],s=this[G];if(Y.has(e)){r[e];return r[e]=t,!0}if(s&&s.has(e)||/^_.+/.test(e))return te.call(r,e,t);if(!/\D/.test(e)){let s=we(t),a=r.ele.children[e];if(a){let n=r.getData(e).object;r.ele.insertBefore(s.ele,a),r.ele.removeChild(a),o(r,"setData",[e,t],{oldValue:n})}else r.ele.appendChild(s.ele),o(r,"setData",[e,t],{oldValue:void 0})}return!1}getData(e){e=R(e);let t,r=this[O];return/\D/.test(e)?t=r[e]:(t=r.ele.children[e])&&(t=xe(t)),t instanceof I&&(t=t[E]),t}siblings(e){let t=Array.from(this.ele.parentElement.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(J(t,e))return!0})),t.map(e=>xe(e))}empty(){return this.splice(0,this.length),this}parents(e,t){let r=[],a=this.parent;if(e){if("string"==s(e))for(;a;)J(a.ele,e)&&r.push(a),a=a.parent}else for(;a;)r.push(a),a=a.parent;if(t)if(t instanceof re){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==s(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}is(e){return J(this.ele,e)}$(e){let t=this.ele.querySelector(e);if(t)return xe(t)}all(e){return B(this.ele,e).map(e=>xe(e))}clone(){let e=xe(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}extend(e){return Object.keys(e).forEach(t=>{let{get:r,set:s,value:a}=Object.getOwnPropertyDescriptor(e,t);a?Object.defineProperty(this,t,{value:a}):(Object.defineProperty(this,t,{get:r,set:s}),s&&Y.add(t))}),this}}const se=re.prototype,ae=e.MouseEvent||Event,ne=e.TouchEvent||Event,ie=new Map([["click",ae],["mousedown",ae],["mouseup",ae],["mousemove",ae],["mouseenter",ae],["mouseleave",ae],["touchstart",ne],["touchend",ne],["touchmove",ne]]),le=e=>{let t,r,a,n=e[0];if("object"==s(n)){let e=n;n=e.event,r=e.callback,a=e.data,t=e.selector}else switch(s(e[1])){case"string":t=e[1],r=e[2],a=e[3];break;default:r=e[1],a=e[2]}return{eventName:n,selector:t,callback:r,data:a}};function oe(e,t={count:1/0}){let{eventName:r,selector:s,callback:a,data:n}=le(e),i=this[Q]||(this[Q]=new Map);if(!i.has(r)){let e=e=>{let s,{_para_x_eve_:n}=e;if(n){(s=n).target.ele!==e.target&&(s.target=xe(e.target));let t=[],r=e.target;for(;r!==e.currentTarget;){let e=r.parentNode;if(!e)break;let s=Array.from(e.children).indexOf(r);t.unshift(s),r=e}s.keys=t}else(s=new v({type:r,target:xe(e.target)})).on("set-bubble",(t,r)=>!r&&e.stopPropagation()),s.on("set-cancel",(t,r)=>r&&e.stopImmediatePropagation()),s.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=s;s.originalEvent=e,this.emitHandler(s),s.originalEvent=null,t.count--,t.count||this.off(r,a)};i.set(r,e),this.ele.addEventListener(r,e)}if(this.addListener({type:r,count:t.count,data:n,callback:a}),s){b(r,this).forEach(e=>{e.callback==a&&(e.before=(e=>{let t,{self:r,event:a}=e,n=a.target;return(t=n.is(s)?n:n.parents(s)[0])?(Object.assign(a,{selector:s,delegateTarget:t}),1):0}),e.after=(e=>{let{self:t,event:r}=e;delete r.selector,delete r.delegateTarget}))})}}se.extend({on(...e){return oe.call(this,e),this},off(...e){let t=e[0],r=b(t,this);if(I.prototype.off.apply(this,e),!r.length){let e=this[Q]||(this[Q]=new Map),r=e.get(t);r&&this.ele.removeEventListener(t,r),e.delete(t)}return this},one(...e){return oe.call(this,e,{count:1}),this},trigger(e,t){let r,s={bubbles:!0,cancelable:!0};if(Object.assign(s,t),e instanceof Event)r=e;else{r=new(ie.get(e)||Event)(e,{bubbles:s.bubbles,cancelable:s.cancelable})}return this.ele.dispatchEvent(r),this}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(se,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>xe(e)),e)}})});const ce=(e,t,r,s=[])=>{let a=e[O],n=[],i=a.ele,{children:l}=i,c=r;for(;c>0;){let e=l[t];if(!e)break;n.push(xe(e)),i.removeChild(e),c--}let h=l[t];if(s.length){let e=document.createDocumentFragment();s.forEach(t=>e.appendChild(X(t))),t>=0&&h?i.insertBefore(e,h):i.appendChild(e)}return o(a,"splice",[t,r,...s]),n},he=(e,t)=>{let r=e[O],{ele:s}=r,a=Array.from(s.children),n=document.createDocumentFragment();t.forEach(e=>{let t=a[e];t.xvele&&(t[ue]=1),n.appendChild(t)}),s.appendChild(n),a.forEach(e=>e.xvele&&(e[ue]=0))};se.extend({push(...e){let t=document.createDocumentFragment();return e.forEach(e=>{let r=X(e);t.appendChild(r)}),this.ele.appendChild(t),o(this[O],"push",e),this.length},splice(e,t,...r){return ce(this,e,t,r)},unshift(...e){return ce(this,0,0,e),this.length},shift(){return ce(this,0,1)},pop(){return ce(this,this.length-1,1)},reverse(){let e=Array.from(this.ele.children),t=e.length;he(this,e.map((e,r)=>t-1-r)),o(this[O],"reverse",[])},sort(e){if(n(e)){let r=Array.from(this.ele.children).map(e=>xe(e)),s=Array.from(r);r.sort(e),e=[];let a=t();r.forEach(t=>{let r=s.indexOf(t);s[r]=a,e.push(r)})}e instanceof Array&&he(this,e),o(this[O],"sort",[e])}});const de=new Map,ue=Symbol("runArray"),fe=Symbol("renderend"),pe=Symbol("renderend_resove"),ge=(Symbol("renderend_reject"),t(),e=>/[ \|\&\(\)\?\:\!;]/.test(e.trim())),be=e=>new Function("$event",`\nwith(this){\n    try{\n        return ${e}\n    }catch(e){\n        let errObj = {\n            expr:'${e.replace(/'/g,"\\'").replace(/"/g,'\\"')}',\n        }\n        ele.__xInfo && Object.assign(errObj,ele.__xInfo);\n        console.error(errObj,e);\n    }\n}\n    `),me=({sroot:e,proxyEle:r,syncData:s=!1})=>{const a=new Map,n=e=>{let t=a.get(e.trim());return t||(t=[],a.set(e,t)),t};B(e,"[xv-for]").forEach(e=>{let s,a,i,l=e.getAttribute("xv-for");const o=e.cloneNode(!0),c=t();o.setAttribute("for-id",c),o.removeAttribute("xv-for");let h=document.createTextNode(""),d=e.parentNode;d.insertBefore(h,e),d.removeChild(e);let u=l.split("in");if(!u)throw{desc:"xv-for value expression error",value:l};let[f,p]=u;i=p.trim(),(s=f.trim()).includes("(")&&([s,a]=s.replace(/[\(\))]/g,"").split(",")),n(i).push({change(e,t){let n=t.find(e=>"setData"==e.name&&!t.keys.length&&e.args&&e.args[0]===i),l=t.find(e=>1===e.keys.length&&e.keys[0]===i);if(n||l){we(d).all(`[for-id="${c}"]`).forEach(e=>{e.remove()});let t=document.createDocumentFragment();e.forEach((e,n)=>{let i=o.cloneNode(!0),l={[s]:{get:()=>e}};a&&(l[a]={get:()=>n});let c=Object.create(r,l);i._forObj=c,me({sroot:i,proxyEle:c,syncData:!0}),t.appendChild(i)}),d.insertBefore(t,h)}}})}),B(e,"[xv-show]").forEach(e=>{n(e.getAttribute("xv-show")).push({change:t=>{e.style.display=t?"":"none"}})}),B(e,"xv-span").forEach(e=>{let t=document.createTextNode(""),r=e.parentNode;r.insertBefore(t,e),r.removeChild(e);let s=e.getAttribute("xvkey");n(s).push({change:e=>{t.textContent=e}})}),B(e,"[xv-on]").forEach(e=>{let t=JSON.parse(e.getAttribute("xv-on")),s=ve(e);Object.keys(t).forEach(e=>{let a,[n,...i]=e.split("."),l=t[e];a=ge(l)?be(l):r[l];let o="on";i.includes("once")&&(o="one"),s[o](n,(e,t)=>{i.includes("prevent")&&e.preventDefault(),i.includes("stop")&&(e.bubble=!1),a.call(r,e,t)})})}),B(e,"[xv-bind]").forEach(e=>{let t=JSON.parse(e.getAttribute("xv-bind"));Object.keys(t).forEach(s=>{let a=t[s],i=/^#(.+)/.exec(s);if(i){if(s=i[1],i=!!i,ge(a))throw{desc:"Function expressions cannot be used for sync binding"};ve(e).watch(s,(e,t)=>{r.setData(a,t)})}n(a).push({change:t=>{t instanceof re&&(t=t.object),e.xvele?ve(e).setData(s,t):e.setAttribute(s,t)}})})});let i=new Set;B(e,"[xv-model]").forEach(s=>{if(i.has(s))return;let a=s.getAttribute("xv-model");switch(s.tagName.toLowerCase()){case"input":switch(s.getAttribute("type")){case"checkbox":let n=B(e,`input[type="checkbox"][xv-model="${a}"]`);return void(n.length>1?(n.forEach(e=>{e.addEventListener("change",e=>{let{value:t,checked:s}=e.target,n=r.getData(a);s?n.add(t):n.delete(t)})}),n.forEach(e=>{i.add(e)})):(r.watch(a,(e,t)=>{s.checked=t}),s.addEventListener("change",e=>{let{checked:t}=s;r.setData(a,t)})));case"radio":let l=B(e,`input[type="radio"][xv-model="${a}"]`),o=t();return void l.forEach(e=>{e.setAttribute("name",`radio_${a}_${o}`),e.addEventListener("change",t=>{e.checked&&r.setData(a,e.value)})})}case"textarea":r.watch(a,(e,t)=>{s.value=t}),s.addEventListener("input",e=>{r.setData(a,s.value)});break;case"select":r.watch(a,(e,t)=>{s.value=t}),s.addEventListener("change",e=>{r.setData(a,s.value)});break;default:if(s.xvele){let e=s.__xhear__;e.watch("value",(e,t)=>{r.setData(a,t)}),r.watch(a,(t,r)=>{e.setData("value",r)})}else console.warn("can't xv-model with thie element => ",s)}}),i.clear(),i=null;const l=r[G];for(let[e,t]of a)if(l.has(e))r.watch(e,(e,r)=>{t.forEach(t=>t.change(r,e.trends))},s);else{let a,n=be(e);r.watch(e=>{let s=n.call(r);if(s===a)return;let{trends:i}=e;t.forEach(e=>e.change(s,i)),a=s},s)}},ye=(e,t)=>{let r=ve(e),s=[];t.proto&&r.extend(t.proto);let n,{temp:i}=t,o=Object.assign({},t.data),c=Object.keys(o);c.push(...t.attrs),c.push(...Object.keys(t.watch)),(c=new Set(c)).forEach(e=>{/^_.+/.test(e)&&c.delete(e)});let h=r[G];if(h?c.forEach(e=>h.add(e)):Object.defineProperty(r,G,{value:c}),c.has("value")&&Object.defineProperty(e,"value",{get:()=>r.value,set(e){r.value=e}}),i){n=e.attachShadow({mode:"open"});var d=(i=i.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);d&&d.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(i=i.replace(e,`<xv-span xvkey="${t[1].trim()}"></xv-span>`))}),n.innerHTML=i,B(n,"*").forEach(e=>{let t=Array.from(e.attributes),s=new Set,a={},n={};t.forEach(t=>{let{name:i,value:l}=t;if("$"===(i=R(i)))return Object.defineProperty(r,"$"+l,{get:()=>xe(e)}),void s.add(i);let o=/^@(.+)/.exec(i);if(o)return a[o[1]]=l,void s.add(i);let c=/^:(.+)/.exec(i);return c?(n[c[1]]=l,void s.add(i)):void 0});let i=JSON.stringify(a);"{}"!=i&&e.setAttribute("xv-on",i);let l=JSON.stringify(n);"{}"!=l&&e.setAttribute("xv-bind",l),s.forEach(t=>{e.removeAttribute(t)})}),me({sroot:n,proxyEle:r[E]})}if(r.watch(t.watch),t.attrs.forEach(t=>{r.watch(t,r=>{null===r.val||void 0===r.val?e.removeAttribute(q(t)):e.setAttribute(q(t),r.val)})}),Object.keys(o).forEach(e=>{let t=o[e];a(t)||r.setData(e,t)}),n){let t=B(n,"link");t.length&&t.forEach(t=>{s.push(new Promise((r,s)=>{t.sheet?r():(t.addEventListener("load",e=>{r()}),t.addEventListener("error",t=>{s({desc:"link load error",error:t,target:e})}))}))})}let u=()=>{l(()=>e.setAttribute("xv-ele",1),e.xvid),r[pe](),r.trigger("renderend",{bubbles:!1}),u=null};s.length?Promise.all(s).then(()=>{u()}):u()},ve=e=>e.__xhear__||new re(e),xe=e=>ve(e)[E];let we=e=>{if(e instanceof re)return e;let t;return(t="string"!==s(e)||/\<.+\>/.test(e)?X(e):document.querySelector(e))?xe(t):null};Object.assign(we,{register:e=>{let r={tag:"",temp:"",attrs:[],data:{},watch:{}};Object.assign(r,e);let a=r.attrs,n=s(a);if("object"==n){let e=Object.keys(a);e.forEach(e=>{r.data[R(e)]=a[e]}),a=r.attrs=e.map(e=>R(e))}else"array"==n&&(a=r.attrs=a.map(e=>R(e)));r.data=i(r.data),r.watch=Object.assign({},r.watch);let o=r.tag=q(r.tag);const c=class extends re{constructor(...e){super(...e),this[fe]=new Promise((e,t)=>{this[pe]=e})}get finish(){return this[fe]}};r.proto&&c.prototype.extend(r.proto);let h=document.currentScript&&document.currentScript.src;const d=class extends HTMLElement{constructor(){super(),this.__xInfo={scriptSrc:h},delete this.__xhear__;let e=new c(this);Object.defineProperty(this,"xvele",{value:!0}),Object.defineProperty(e,"xvele",{value:!0});let s=this.xvid="xv"+t(),a=Object.assign({},r);this.parentElement?this.setAttribute("xv-ele",""):l(()=>this.setAttribute("xv-ele",""),s),ye(this,a),a.ready&&a.ready.call(e[E]),a.slotchange&&e.$shadow.on("slotchange",t=>a.slotchange.call(e[E],t)),Object.defineProperties(this,{[ue]:{writable:!0,value:0}})}connectedCallback(){this[ue]||r.attached&&r.attached.call(xe(this))}disconnectedCallback(){if(this[ue])return;let e=xe(this);r.detached&&r.detached.call(e),e.deepClear()}attributeChangedCallback(e,t,r){let s=this.__xhear__;r!=s[e=R(e)]&&s.setData(e,r)}static get observedAttributes(){return a.map(e=>q(e))}};Object.assign(r,{XhearElement:d}),de.set(r.tag,r),customElements.define(o,d)},nextTick:l,xdata:e=>f(e)[E],v:5002e3,version:"5.2.0",fn:se,isXhear:e=>e instanceof re,ext:e=>{e({renderEle:ye})},all:e=>B(document,e).map(e=>xe(e))}),e.$=we})(window);