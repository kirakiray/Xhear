(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const a=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),s=e=>void 0===e,i=e=>a(e).includes("function"),n=e=>JSON.parse(JSON.stringify(e)),l=(()=>{let e=!1,r=new Map;return(a,s)=>{e||(e=!0,setTimeout(()=>{r.size&&r.forEach(e=>{e()}),r.clear(),e=!1},0)),s||(s=t()),r.set(s,a)}})(),c=(e,r,a,s)=>{let i;i=e._modifyId?e._modifyId:t(),_(e,k).push(i),d(e);let l=new y({type:"update",target:e[j]||e});Object.defineProperties(l,{trend:{get:()=>new C(l)}}),s&&Object.assign(l,s),l.modify={name:r,args:n(a),mid:i},e.emit(l)};let h,o=new Set;const d=e=>{e[k].length<50||(clearTimeout(h),o.add(e),h=setTimeout(()=>{let e=Array.from(o);setTimeout(()=>{e.forEach(e=>d(e))},1e3),o.forEach(e=>{let t=e[k];t.splice(0,Math.ceil(t.length/2))}),o.clear()},3e3))},f=e=>{if(!(e instanceof S))return;let t=e[O];if(t&&(t.index=void 0,t.parent=void 0),e instanceof N){let{mappingXData:r}=e,a=r[A].find(e=>e.data===t),{leftUpdate:s,rightUpdate:i}=a;e.off("update",i),r.off("update",s),t.mappingXData=null}if(t[D])for(let[e,r]of t[D])t.unsync(e);t[A]&&(t[A].forEach(e=>{let{data:r,leftUpdate:a,rightUpdate:s}=e;r.off("update",s),t.off("update",a),r.mappingXData=null}),t[A].splice(0)),t[E]&&t[E].clear(),t[p]&&t[p].clear()},u=(e,t)=>{let r=e;switch(a(e)){case"object":case"array":r=new S(e,t)}return r},p=Symbol("events"),g=(e,t)=>{let r=t[p];r||(r=new Map,Object.defineProperty(t,p,{value:r}));let a=r.get(e);return a||(a=[],r.set(e,a)),a},b=(e,t)=>{let r;return e instanceof y?e=(r=e).type:r=new y({type:e,target:t[j]||t}),r};class m{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,r){this.addListener({type:e,data:r,callback:t})}one(e,t,r){this.addListener({count:1,type:e,data:r,callback:t})}addListener(e={}){let{type:t,data:r,callback:a,count:i=1/0,eventId:n}=e;if(!t)throw{desc:"addListener no type",options:e};let l=t.split("#");1 in l&&(t=l[0],n=l[1]);let c=g(t,this);s(n)||Array.from(c).some(e=>{if(e.eventId===n){let t=c.indexOf(e);return t>-1&&c.splice(t,1),!0}}),a&&c.push({type:t,data:r,callback:a,eventId:n,count:i})}off(e,t){if(e)if(t){let r=g(e,this),a=r.findIndex(e=>e.callback==t);a>-1&&r.splice(a,1)}else this[p]&&this[p].delete(e)}emitHandler(e,t){let r=b(e,this);e=r.type;let a=g(e,this),s=[];return r.currentTarget=this[j]||this,a.some(e=>{e.data&&(r.data=e.data),e.eventId&&(r.eventId=e.eventId);let a={self:this,event:r,emitData:t};if((e.before?e.before(a):1)&&e.callback.call(this[j]||this,r,t),e.after&&e.after(a),delete r.data,delete r.eventId,e.count--,e.count||s.push(e),r.cancel)return!0}),delete r.currentTarget,s.forEach(e=>{let t=a.indexOf(e);t>-1&&a.splice(t,1)}),r}emit(e,t){let r=this.emitHandler(e,t);if(r.bubble&&!r.cancel){let{parent:e}=this;e&&(r.keys.unshift(this.index),e.emit(r,t))}}}class y extends m{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const v=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,x=/^parent$|^index$|^length$|^object$/;let w={get:(e,t,r)=>"symbol"==typeof t||v.test(t)?Reflect.get(e,t,r):e.getData(t),set:(e,t,r,a)=>"symbol"==typeof t?Reflect.set(e,t,r,a):e.setData(t,r)};const j=Symbol("proxyThis"),O=Symbol("XDataSelf"),E=Symbol("WatchHost"),k=Symbol("ModifyIDS"),D=Symbol("SyncHost"),A=Symbol("VirDataHost"),_=(e,t)=>{let r=e[t];if(!r){switch(t){case E:case D:r=new Map;break;case k:case A:r=[]}Object.defineProperty(e,t,{value:r})}return r};class S extends m{constructor(e,t={}){super(t);let r=new Proxy(this,w),a=0;Object.keys(e).forEach(t=>{if(/^\_/.test(t))return void Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e[t]});let r=e[t];/\D/.test(t)||(t=parseInt(t))>=a&&(a=t+1),r instanceof Object?this[t]=new S(r,{parent:this,index:t}):this[t]=r}),Object.defineProperties(this,{[O]:{get:()=>this},[j]:{value:r},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:a}})}setData(e,t){if(x.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let r=this[O];if("string"===a(e)){let a=r[e];if(t===a)return;t instanceof S?((t=t[O]).remove(),t.parent=r,t.index=e):t instanceof Object&&(t=u(t,{parent:r,index:e})),r[e]=t,c(r,"setData",[e,t],{oldValue:a})}else if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let a=t[e];r.setData(e,a)}),!0}}getData(e){let t=this[e];return t instanceof S&&(t=t[j]),t}remove(e){if(s(e)){let{parent:e}=this;e?e.remove(this.index):f(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],f(t),c(this,"remove",[e])):this.splice(parseInt(e),1)}}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return u(n(this))[j]}emitHandler(e,t){let r=b(e,this);if("update"===r.type){let{_unBubble:e,_update:t}=this;if(!1===t||e&&e.includes(r.trend.fromKey))return r.bubble=!1,r}return m.prototype.emitHandler.call(this,r,t),r}get object(){let e={},t=!0;return Object.keys(this).forEach(r=>{if(/^_/.test(r)||!/\D/.test(r))return;t=!1;let a=this[r];a instanceof S&&(a=a.object),e[r]=a}),this.forEach((t,r)=>{t instanceof S&&(t=t.object),e[r]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}getTarget(e){let t=this;return e.length&&e.forEach(e=>{t=t[e]}),t}seek(e){let t=a(e);if("function"===t){let t=[],r=r=>{if(r instanceof S){e(r)&&t.push(r);let a=r.seek(e);t=[...t,...a]}};return Object.keys(this).forEach(e=>{/\D/.test(e)&&r(this[e])}),this.forEach(r),r=null,t}if("string"===t){let t,r=(e=e.replace(/[\[\]]/g,"")).split("=");if(2==r.length){let[e,a]=r;t=(t=>t[e]==a)}else{let[e]=r;t=(t=>Object.keys(t).includes(e))}return this.seek(t)}}watch(e,t,r){let s=a(e);if("object"===s)return void Object.keys(e).forEach(t=>{this.watch(t,e[t])});/function/.test(s)&&(t=e,e="");let i;i=""==e?"watchSelf":/\[.+\]/.test(e)?"seekData":"watchKey";let n=_(this,E).get(e);n||(n=new Set,_(this,E).set(e,n));let c={trends:[],callback:t,expr:e};n.add(c);let h,o=this[j];switch(i){case"watchSelf":h=(e=>{c.trends.push(e.trend),l(()=>{t.call(o,{trends:Array.from(c.trends)},o),c.trends.length=0},c)}),!0===r&&t.call(o,{trends:[]},o);break;case"watchKey":h=(r=>{let{trend:a}=r;a.fromKey==e&&(c.trends.push(r.trend),l(()=>{let r=this[e];t.call(o,{expr:e,val:r,trends:Array.from(c.trends)},r),c.trends.length=0},c))}),!0===r&&t.call(o,{expr:e,val:o[e],trends:[]},o[e]);break;case"seekData":let a=o.seek(e);h=(r=>{l(()=>{let r=o.seek(e),s=1;r.length===a.length?r.some(e=>{if(!a.includes(e))return s=0,!0}):s=0,!s&&t.call(o,{expr:e,old:a,val:r},r),a=r},c)}),!0===r&&t.call(o,{expr:e,old:a,val:a},a)}return this.on("update",h),c.updateMethod=h,this}unwatch(e,t){let r=a(e);if("object"===r)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(r)&&(t=e,e="");let s=_(this,E).get(e);if(s){let r=Array.from(s).find(r=>r.callback===t&&r.expr===e);r&&(this.off("update",r.updateMethod),s.delete(r),!s.size&&_(this,E).delete(e))}return this}entrend(e){let{mid:t,keys:r,name:a,args:s}=e;if(!t)throw{text:"Illegal trend data"};if(_(this,k).includes(t))return!1;let i=this.getTarget(r)[O];return i._modifyId=t,i[a](...s),i._modifyId=null,!0}}class C{constructor(e){if(e instanceof y){let{modify:{name:t,args:r,mid:a},keys:s}=n(e);Object.assign(this,{name:t,args:r,mid:a,keys:s})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){let e=this.keys[0];return!s(e)||"setData"!==this.name&&"remove"!==this.name||(e=this.args[0]),e}set fromKey(e){let t=this.keys[0];s(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}const I=(e,t,r)=>{t.trends.forEach(t=>{t.fromKey===e&&r.entrend(t)})},P=(e,t,r)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&r.entrend(t)})},L=(e,t,r)=>{n(t.trends).forEach(t=>{t=new C(t);let{fromKey:a}=t;if(!s(a)){let s=e.get(a);s&&(t.fromKey=s,r.entrend(t))}})},T=e=>(e instanceof S&&(e=e.object),e),M=(e,t,r)=>{Object.keys(e).forEach(a=>{let s=e[a];if(s instanceof Object){t[a]||(t.setData?t.setData(a,{}):t[a]={});let e=t[a];M(s,e,r)}else{let i=r([a,s],{self:e,target:t});if(i){let[e,r]=i;t[e]=r}}})},H=(e,t,r)=>{let{trend:a}=t;if(a){switch(a.name){case"setData":let e=a.args[1];if(e instanceof Object){let t={};M(e,t,r),a.args[1]=t}else s(e)||(a.args=r(a.args,{event:t}));break;default:a.args=a.args.map(e=>{let t=e;return e instanceof Object&&M(e,t={},r),t})}e.entrend(a)}},$={sync(e,t,r){let s,i;switch(a(t)){case"string":r&&e.setData(t,T(this[t])),s=(r=>I(t,r,e)),i=(e=>I(t,e,this));break;case"array":r&&t.forEach(t=>{e.setData(t,T(this[t]))}),s=(r=>P(t,r,e)),i=(e=>P(t,e,this));break;case"object":let n=new Map(Object.entries(t)),l=new Map(Object.entries(t).map(e=>e.reverse()));r&&Object.keys(t).forEach(r=>{e.setData(t[r],T(this[r]))}),s=(t=>L(n,t,e)),i=(e=>L(l,e,this));break;default:r&&e.setData(this.object),s=(t=>t.trends.forEach(t=>e.entrend(t))),i=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(s),e.watch(i);let n=_(this,D);n.has(e)&&this.unsync(e),n.set(e,{selfWatch:s,oppWatch:i}),_(e,D).set(this,{selfWatch:i,oppWatch:s})},unsync(e){let t=_(this,D).get(e);if(t){let{selfWatch:r,oppWatch:a}=t;this.unwatch(r),e.unwatch(a),_(this,D).delete(e),_(e,D).delete(this)}},virData(e,t){let r=new N(this[O],{}),s=a(e),i=e;if("object"==s)if("mapKey"in i){let r=Object.entries(i.mapKey),a=new Map(r),s=new Map(r.map(e=>e.reverse()));e=(([e,t])=>a.has(e)?[a.get(e),t]:[e,t]),t=(([e,t])=>s.has(e)?[s.get(e),t]:[e,t])}else if("mapValue"in i){let r=i.key,a=Object.entries(i.mapValue),s=new Map(a),n=new Map(a.map(e=>e.reverse()));e=(([e,t])=>e===r&&s.has(t)?[e,s.get(t)]:[e,t]),t=(([e,t])=>e===r&&n.has(t)?[e,n.get(t)]:[e,t])}M(this,r,e);let n,l;return this.on("update",n=(t=>H(r,t,e))),r.on("update",l=(e=>H(this,e,t))),_(this,A).push({data:r,leftUpdate:n,rightUpdate:l}),r[j]}};Object.keys($).forEach(e=>{Object.defineProperty(S.prototype,e,{writable:!0,value:$[e]})});class N extends S{constructor(e,...t){super(...t),Object.defineProperty(this,"mappingXData",{writable:!0,value:e})}}["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(S.prototype,e,{value(...e){return t.apply(this,e)}})}),["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(S.prototype,e,{value(...r){let a=[],s=this[O];r.forEach(e=>{if(e instanceof S){let t=e[O];t.remove(),a.push(t)}else{let t=u(e,{parent:s});a.push(t)}});let i=t.apply(s,a);switch(s.forEach((e,t)=>{e instanceof S&&(e.index=t)}),e){case"shift":case"pop":i instanceof S&&f(i);break;case"splice":i.forEach(e=>{e instanceof S&&f(e)})}return c(s,e,r),i}})}),Object.defineProperties(S.prototype,{sort:{value(e){let t=[],r=this[O],a=Array.from(r);if(i(e)){Array.prototype.sort.call(r,e),r.forEach((e,t)=>{e instanceof S&&(e.index=t)});t=[a.map(e=>e.index)],a=null}else e instanceof Array&&(e.forEach((e,t)=>{(r[e]=a[t]).index=e}),t=[e]);return c(r,"sort",t),this}}});const K=(e,t)=>{if(e===t)return!0;let r=document.createElement("div");return e!==document&&(r.appendChild(e.cloneNode(!1)),!!r.querySelector(t))},W=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);if(e.class&&t.setAttribute("class",e.class),e.text&&(t.textContent=e.text),e.data){let{data:r}=e;Object.keys(r).forEach(e=>{let a=r[e];t.dataset[e]=a})}if(t.xvele){let r=re(t);r[X].forEach(t=>{let a=e[t];s(a)||(r[t]=a)})}let r=0;for(;r in e;){let a=W(e[r]);t.appendChild(a),r++}return t},q=e=>{let t;switch(a(e)){case"string":/\<.+\>/.test(e)&&(t=(e=>{let t=document.createElement("div");t.innerHTML=e;return Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e));break;case"object":t=W(e);break;default:e instanceof Element&&(t=e)}return t},X=Symbol("cansetkeys"),U=Symbol("orignEvents"),R=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),V=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),B=new Set(["text","html","display","style"]),J=new Set(["parent","index"]),F=S.prototype.setData;class z extends S{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this}}),Object.defineProperties(this,{tag:{enumerable:!0,value:e.tagName.toLowerCase()},ele:{value:e},[U]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?re(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.innerText}set text(e){this.ele.innerText=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){let{style:t}=this,r=Array.from(t),a=Object.keys(e);r.forEach(e=>{a.includes(e)||(t[e]="")}),Object.assign(t,e)}setData(e,t){if(J.has(e))return console.warn("can't set this key => ",e),!1;e=R(e);let r=this[O],a=this[X];if(B.has(e))return r[e]=t,!0;if(a&&a.has(e))return F.call(r,e,t);if(!/\D/.test(e)){let a=ae(t),s=r.ele.children[e],i=r.getData(e).object;s?(r.ele.insertBefore(a.ele,s),r.ele.removeChild(s),c(r,"setData",[e,t],{oldValue:i})):r.ele.appendChild(a.ele)}return!1}getData(e){e=R(e);let t,r=this[O];return/\D/.test(e)?t=r[e]:(t=r.ele.children[e])&&(t=re(t)),t instanceof S&&(t=t[j]),t}siblings(e){let t=Array.from(this.ele.parentElement.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(K(t,e))return!0})),t.map(e=>re(e))}empty(){return this.splice(0,this.length),this}parents(e){let t=[],r=this.parent;if(e){if("string"!=a(e)){if(e instanceof z&&(e=e.ele),e instanceof Element)for(;r;){if(r.ele==e)return!0;r=r.parent}return!1}for(;r;)K(r.ele,e)&&t.push(r),r=r.parent}else for(;r;)t.push(r),r=r.parent;return t}is(e){return K(this.ele,e)}attr(e,t){if(s(t)){if(!(e instanceof Object))return this.ele.getAttribute(e);Object.keys(e).forEach(t=>{this.attr(t,e[t])})}else if(this.xvRender){Q.get(this.tag).attrs.includes(e)&&(this[e]=t)}else this.ele.setAttribute(e,t)}removeAttr(e){return this.ele.removeAttribute(e),this}que(e){let t=this.ele.querySelector(e);if(t)return re(t)}queAll(e){let t=this.ele.querySelectorAll(e);if(t)return Array.from(t).map(e=>re(e))}queShadow(e){let{shadowRoot:t}=this.ele;if(!t)throw{target:this,msg:"it must be a customElement"};{let r=t.querySelector(e);if(r)return re(r)}}queAllShadow(e){let{shadowRoot:t}=this.ele;if(!t)throw{target:this,msg:"it must be a customElement"};{let r=t.querySelectorAll(e);if(r)return Array.from(r).map(e=>re(e))}}}window.XhearEle=z,Object.defineProperties(z.prototype,{on:{value(...e){let t,r,s,i=e[0];if("object"==a(i)){let e=i;i=e.event,r=e.callback,s=e.data,t=e.selector}else switch(a(e[1])){case"string":t=e[1],r=e[2],s=e[3];break;default:r=e[1],s=e[2]}let n=this[U]||(this[U]=new Map);if(!n.has(i)){let e=e=>{let t,{_para_x_eve_:r}=e;if(r){(t=r).target.ele!==e.target&&(t.target=re(e.target));let a=[],s=e.target;for(;s!==e.currentTarget;){let e=s.parentNode,t=Array.from(e.children).indexOf(s);a.unshift(t),s=e}t.keys=a}else(t=new y({type:i,target:re(e.target)})).on("set-bubble",(t,r)=>!r&&e.stopPropagation()),t.on("set-cancel",(t,r)=>!r&&e.stopImmediatePropagation()),t.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=t;t.originalEvent=e,this.emitHandler(t),t.originalEvent=null};n.set(i,e),this.ele.addEventListener(i,e)}if(this.addListener({type:i,data:s,callback:r}),t){g(i,this).forEach(e=>{e.callback==r&&(e.before=(e=>{let{self:r,event:a}=e,s=a.target,i=s.parents(t)[0];return!i&&s.is(t)&&(i=s),i?(Object.assign(a,{selector:t,delegateTarget:i}),1):0}),e.after=(e=>{let{self:t,event:r}=e;delete r.selector,delete r.delegateTarget}))})}}},off:{value(...e){let t=e[0],r=g(t,this);if(S.prototype.off.apply(this,e),!r.length){let e=(this[U]||(this[U]=new Map)).get(t);e&&this.ele.removeEventListener(t,e)}}}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(z.prototype,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>re(e)[j]),e)}})});const Z=(e,t,r,a=[])=>{let s=e[O],i=[],n=s.ele,{children:l}=n;for(;r>0;){let e=l[t];i.push(re(e)),n.removeChild(e),r--}let h=l[t];if(a.length){let e=document.createDocumentFragment();a.forEach(t=>e.appendChild(q(t))),t>=0&&h?n.insertBefore(e,h):n.appendChild(e)}c(s,"splice",[t,r,...a])},G=(e,t)=>{let r=e[O],{ele:a}=r,s=Array.from(a.children),i=document.createDocumentFragment();t.forEach(e=>{let t=s[e];t.xvele&&(t[Y]=1),i.appendChild(t)}),a.appendChild(i),s.forEach(e=>e.xvele&&(e[Y]=0))};Object.defineProperties(z.prototype,{push:{value(...e){let t=document.createDocumentFragment();return e.forEach(e=>{let r=q(e);t.appendChild(r)}),this.ele.appendChild(t),c(this[O],"push",e),this.length}},splice:{value(e,t,...r){return Z(this,e,t,r)}},unshift:{value(...e){return Z(this,0,0,e),this.length}},shift:{value(){return Z(this,0,1)}},pop:{value(){return Z(this,this.length-1,1)}},reverse:{value(){let e=Array.from(this.ele.children),t=e.length;G(this,e.map((e,r)=>t-1-r)),c(this[O],"reverse",[])}},sort:{value(e){if(i(e)){let r=Array.from(this.ele.children).map(e=>re(e)),a=Array.from(r);r.sort(e),e=[];let s=t();r.forEach(t=>{let r=a.indexOf(t);a[r]=s,e.push(r)})}e instanceof Array&&G(this,e),c(this[O],"sort",[e])}}});const Q=new Map,Y=Symbol("runArray"),ee=(e,t)=>{let r=e.querySelectorAll(t);return r?Array.from(r):[]},te=(e,r)=>{let a=re(e),{proto:i}=r;i&&Object.keys(i).forEach(e=>{let{get:t,set:r,value:s}=Object.getOwnPropertyDescriptor(i,e);s?Object.defineProperty(a,e,{value:s}):Object.defineProperty(a,e,{get:t,set:r})}),Object.defineProperty(e,"xvele",{value:!0}),Object.defineProperty(a,"xvele",{value:!0});let n=e.attachShadow({mode:"open"});n.innerHTML=r.temp,ee(n,"[xv-tar]").forEach(e=>{let t=e.getAttribute("xv-tar");Object.defineProperty(a,"$"+t,{value:re(e)})}),ee(n,"xv-span").forEach(e=>{var t=document.createTextNode("");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e);var r=e.getAttribute("xvkey");a.watch(r,e=>t.textContent=a[r])});let l=new Set;ee(n,"[xv-model]").forEach(e=>{if(l.has(e))return;let r=e.getAttribute("xv-model");switch(e.tagName.toLowerCase()){case"input":switch(e.getAttribute("type")){case"checkbox":let s=ee(n,`input[type="checkbox"][xv-model="${r}"]`);return void(s.length>1?(s.forEach(e=>{e.addEventListener("change",e=>{let{value:t,checked:s}=e.target,i=a.getData(r);s?i.add(t):i.delete(t)})}),s.forEach(e=>{l.add(e)})):(a.watch(r,(t,r)=>{e.checked=r}),e.addEventListener("change",t=>{let{checked:s}=e;a.setData(r,s)})));case"radio":let i=ee(n,`input[type="radio"][xv-model="${r}"]`),c=t();return void i.forEach(e=>{e.setAttribute("name",`radio_${c}_${r}`),e.addEventListener("change",t=>{e.checked&&a.setData(r,e.value)})})}case"textarea":a.watch(r,(t,r)=>{e.value=r}),e.addEventListener("input",t=>{a.setData(r,e.value)});break;case"select":a.watch(r,(t,r)=>{e.value=r}),e.addEventListener("change",t=>{a.setData(r,e.value)});break;default:if(e.xvele){let t=e.__xhear__;t.watch("value",(e,t)=>{a.setData(r,t)}),a.watch(r,(e,r)=>{t.setData("value",r)})}else console.warn("can't xv-model with thie element => ",e)}}),l.clear(),l=null,a.watch(r.watch);let c=Object.assign({},r.data);r.attrs.forEach(t=>{let r=e.getAttribute(t);s(r)||null==r||(c[t]=r),a.watch(t,r=>{e.setAttribute(t,r.val)})}),r.props.forEach(t=>{let r=e.getAttribute(t);!s(r)&&null!=r&&(c[t]=r)});let h=Object.keys(c);h.push(...r.attrs),h.push(...r.props),h.push(...Object.keys(r.watch)),h=new Set(h),Object.defineProperty(a,X,{value:h}),h.forEach(e=>{let t=c[e];s(t)||a.setData(e,t)})},re=e=>e.__xhear__||new z(e);let ae=e=>{if(e instanceof z)return e;let t;return(t="string"!==a(e)||/\<.+\>/.test(e)?q(e):document.querySelector(e))?re(t)[j]:null};Object.assign(ae,{register:e=>{let t={tag:"",temp:"",attrs:[],props:[],data:{},watch:{}};Object.assign(t,e);let r=t.attrs=t.attrs.map(e=>V(e));t.props=t.props.map(e=>V(e)),t.data=n(t.data),t.watch=Object.assign({},t.watch);let a=t.tag=V(t.tag);if(t.temp){let{temp:e}=t;var s=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);s&&s.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<xv-span xvkey="${r[1].trim()}"></xv-span>`))}),t.temp=e}let i=class extends HTMLElement{constructor(){super(),te(this,t),t.inited&&t.inited.call(re(this)[j]),Object.defineProperties(this,{[Y]:{writable:!0,value:0}})}connectedCallback(){this[Y]||t.attached&&t.attached.call(re(this)[j])}disconnectedCallback(){this[Y]||t.detached&&t.detached.call(re(this)[j])}attributeChangedCallback(e,t,r){let a=this.__xhear__;r!=a[e]&&(a[e]=r)}static get observedAttributes(){return r}};Object.assign(t,{XhearElement:i}),Q.set(t.tag,t),customElements.define(a,i)}}),e.$=ae})(window);