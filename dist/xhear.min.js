/*!
* xhear v5.4.0
* https://github.com/kirakiray/Xhear#readme
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const n=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),s=e=>void 0===e,a=e=>n(e).includes("function"),l=e=>e instanceof T?e.object:JSON.parse(JSON.stringify(e)),i=(()=>{if(null!==document.currentScript.getAttribute("debug")){let e=new Map;return(r,n)=>{n||(n=t());let s=e.get(n);clearTimeout(s),e.set(n,setTimeout(()=>{r(),e.delete(n)}))}}let e=new Map;const r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let n=!1;return(s,a)=>{a||(a=t()),e.set(a,{key:a,fun:s}),n||(n=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),n=!1}))}})(),o=(e,r,n,s,a)=>{let i;i=e._modifyId?e._modifyId:t(),I(e,D).push(i),d(e);let o=new w({type:"update",target:e[_]||e});Object.defineProperties(o,{trend:{get:()=>new P(o)}}),s&&Object.assign(o,s),o.modify={name:r,args:n.map(e=>e instanceof T?e.object:e instanceof Object?l(e):e),mid:i},a&&a(o),e.emit(o)};let c,h=new Set;const d=e=>{e[D].length<50||(clearTimeout(c),h.add(e),c=setTimeout(()=>{let e=Array.from(h);setTimeout(()=>{e.forEach(e=>d(e))},1e3),h.forEach(e=>{let t=e[D];t.splice(0,Math.ceil(t.length/2))}),h.clear()},3e3))},u=e=>{if(e instanceof H)return void(e=>{e.index=void 0,e.parent=void 0,e[M].mirrorHost.off("update",e[L]),e[M].mirrorHost=void 0})(e);if(!(e instanceof T))return;let t=e[k];if(t)try{t.index=void 0,t.parent=void 0}catch(e){}if(t[$])for(let[r,n]of t[$])e.unsync(r);t.emit("clearxdata"),t[A]&&t[A].clear(),t[b]&&t[b].clear()},f=(e,t)=>{if(e instanceof H)return e;let r=e;switch(n(e)){case"object":case"array":r=new T(e,t)}return r},p=(e,t)=>{if(e instanceof Array)return e.map(e=>p(e,t));if(e instanceof Object){let r={},n=[];return Object.keys(e).forEach(s=>{/\D/.test(s)?r[s]=p(e[s]):n.push(p(e[s],t))}),n.length&&(r[t]=n),r}return e};function m(e,t){if(!(e instanceof T))return!1;try{return t.call(e,e)}catch(e){}}let g=(e,t,r)=>{m(e,t)&&r.push(e),e instanceof T&&r.push(...e.seek(t,!1))};const b=Symbol("events"),y=(e,t)=>{let r=t[b];r||(r=new Map,Object.defineProperty(t,b,{value:r}));let n=r.get(e);return n||(n=[],r.set(e,n)),n},x=(e,t)=>{let r;return e instanceof w?e=(r=e).type:r=new w({type:e,target:t[_]||t}),r};class v{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,r){this.addListener({type:e,data:r,callback:t})}one(e,t,r){this.addListener({count:1,type:e,data:r,callback:t})}addListener(e={}){let{type:t,data:r,callback:n,count:a=1/0,eventId:l}=e;if(!t)throw{desc:"addListener no type",options:e};let i=t.split("#");1 in i&&(t=i[0],l=i[1]);let o=y(t,this);s(l)||Array.from(o).some(e=>{if(e.eventId===l){let t=o.indexOf(e);return t>-1&&o.splice(t,1),!0}}),n&&o.push({type:t,data:r,callback:n,eventId:l,count:a})}off(e,t){if(e){if(!t)throw{desc:"off must have callback"};{let r=y(e,this),n=r.findIndex(e=>e.callback==t);n>-1&&r.splice(n,1)}}}emitHandler(e,t){let r=x(e,this);e=r.type;let n=y(e,this),s=[];return r.currentTarget=this[_]||this,n.some(e=>{e.data&&(r.data=e.data),e.eventId&&(r.eventId=e.eventId);let n={self:this,event:r,emitData:t};if((e.before?e.before(n):1)&&e.callback.call(this[_]||this,r,t),e.after&&e.after(n),delete r.data,delete r.eventId,e.count--,e.count||s.push(e),r.cancel)return!0}),delete r.currentTarget,s.forEach(e=>{let t=n.indexOf(e);t>-1&&n.splice(t,1)}),r}emit(e,t){let r=this.emitHandler(e,t);if(r.bubble&&!r.cancel){let{parent:e}=this;e&&(r.keys.unshift(this.index),e.emit(r,t))}}}class w extends v{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const E=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,j=/^parent$|^index$|^length$|^object$/;let O={get:(e,t,r)=>"symbol"==typeof t||E.test(t)?Reflect.get(e,t,r):e.getData(t),set:(e,t,r,n)=>"symbol"==typeof t?Reflect.set(e,t,r,n):e.setData(t,r)};const _=Symbol("proxyThis"),k=Symbol("XDataSelf"),A=Symbol("WatchHost"),D=Symbol("ModifyIDS"),$=Symbol("SyncHost"),S=Symbol("StanzID"),I=(e,t)=>{let r=e[t];if(!r){switch(t){case A:case $:r=new Map;break;case D:case VIRDATAHOST:r=[]}Object.defineProperty(e,t,{value:r})}return r},C="undefined"!=typeof Element;class T extends v{constructor(e,r={}){super(r);let n=new Proxy(this,O),s=0,a=Object.getOwnPropertyDescriptors(e);Object.keys(a).forEach(e=>{let{value:t,get:r,set:n}=a[e];r||n?Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:r,set:n}):/^\_/.test(e)||C&&t instanceof Element?Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}):(/\D/.test(e)||(e=parseInt(e))>=s&&(s=e+1),t instanceof H?(this[e]=t,t.parent=this,t.index=e):t instanceof Object?this[e]=new T(t,{parent:this,index:e}):this[e]=t)});const l=t();Object.defineProperties(this,{[k]:{get:()=>this},[_]:{value:n},[S]:{value:l},xid:{get:()=>l},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:s}})}setData(e,t){if(j.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let r=this[k];if(/\./.test(e)){let n=e.split("."),s=n.length-1;return n.some((t,n)=>{if(n==s)return e=t,!0;r=r[t]}),r.setData(e,t),!0}let s=n(e);if("string"===s||"number"===s){let n=r[e];return t===n||(n instanceof T&&(n=n.object),t instanceof H?(t.parent&&t.remove(),t.parent=r,t.index=e):t instanceof T?(t[k]&&(t=t[k]),t.parent&&t.remove(),t.parent=r,t.index=e):t instanceof Object&&(t=f(t,{parent:r,index:e})),r[e]=t,o(r,"setData",[e,t],{oldValue:n}),!0)}if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let n=t[e];r.setData(e,n)}),!0}}getData(e){let t;if(e.includes&&e.includes(".")){let r=e.split(".");t=this;do{t=t[r.shift()]}while(r.length)}else t=this[e];return t instanceof T&&(t=t[_]),t}remove(e){if(s(e)){let{parent:e}=this;e?e.remove(this.index):u(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],u(t),o(this,"remove",[e])):this.splice(parseInt(e),1)}}deepClear(){Object.keys(this).forEach(e=>{if(/\D/.test(e)){let t=this[e];t instanceof T&&t.deepClear(),t instanceof H&&u(t)}}),this.forEach(e=>{e instanceof T&&e.deepClear(),e instanceof H&&u(e)}),u(this)}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return f(l(this))[_]}emitHandler(e,t){let r=x(e,this);if("update"===r.type){let{_unBubble:e,_update:t,_unpush:n}=this,{fromKey:s}=r.trend;(!1===t||e&&e.includes(s))&&(r.bubble=!1),n&&n.includes(s)&&Object.defineProperty(r,"_unpush",{value:!0})}return v.prototype.emitHandler.call(this,r,t),r}noStanz(e={childKey:"children"}){return p(this.object,e.childKey)}get object(){let e={},t=!0,{_unBubble:r=[]}=this;return Object.keys(this).forEach(n=>{if(/^_/.test(n)||!/\D/.test(n)||r.includes(n)||"length"===n)return;let s=this[n];if(s instanceof T||s instanceof H){if(!1===s._update)return;s=s.object}e[n]=s,t=!1}),this.forEach((t,r)=>{(t instanceof T||t instanceof H)&&(t=t.object),e[r]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}toJSON(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}get mirror(){return new H(this)}getTarget(e){let t=this;return e.length&&e.some(e=>{if(!t)return console.warn("getTarget failure"),!0;t=t[e]}),t}watch(e,t,r){let s,a=n(e);if("object"===a)return void Object.keys(e).forEach(r=>{this.watch(r,e[r],t)});/function/.test(a)&&(r=t,t=e,e=""),s=""===e?"watchSelf":e instanceof RegExp?"watchKeyReg":/\./.test(e)?"watchPointKey":"watchKey";let l=I(this,A).get(e);l||(l=new Set,I(this,A).set(e,l));let o,c={trends:[],callback:t,expr:e,push(e){this.trends.push(e)}};l.add(c);let h=this[_];switch(s){case"watchSelf":o=(e=>{c.push(e.trend),i(()=>{t.call(h,{trends:Array.from(c.trends)},h),c.trends.length=0},c)}),!0===r&&t.call(h,{trends:[]},h);break;case"watchKey":case"watchKeyReg":o=(r=>{let{trend:n}=r;("watchKeyReg"===s&&e.test(n.fromKey)||n.fromKey==e)&&(c.push(r.trend),c.cacheOld||(c._oldVal=r.oldValue instanceof T?r.oldValue.object:r.oldValue,c.cacheOld=!0),i(()=>{let r=this[e];t.call(h,{expr:e,val:r,old:c._oldVal,trends:Array.from(c.trends)},r),c.trends.length=0,c._oldVal=c.cacheOld=!1},c))}),!0===r&&t.call(h,{expr:e,val:h[e],trends:[]},h[e]);break;case"watchPointKey":let n=e.split("."),a=this.getTarget(n);a=a instanceof T?a.object:a,o=(r=>{let{trend:s}=r,l=s.keys.slice();if(l.length<n.length&&l.push(s.finalSetterKey),JSON.stringify(n)===JSON.stringify(l.slice(0,n.length))){let l;try{l=this.getTarget(n)}catch(r){}l!==a&&(c.push(s),i(()=>{(l=this.getTarget(n))!==a&&t.call(h,{expr:e,old:a,trends:Array.from(c.trends)},l),c.trends.length=0},c))}}),!0===r&&t.call(h,{expr:e,val:a},a)}return this.on("update",o),c.updateMethod=o,this}unwatch(e,t){let r=n(e);if("object"===r)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(r)&&(t=e,e="");let s=I(this,A).get(e);if(s){let r=Array.from(s).find(r=>r.callback===t&&r.expr===e);r&&(r.updateMethod&&this.off("update",r.updateMethod),s.delete(r),!s.size&&I(this,A).delete(e))}return this}watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r,n=new Function(`\n            try{with(this){\n                return ${e}\n            }}catch(e){}`).bind(this);this.watch(r=(()=>{let e=n();e&&(this.unwatch(r),t(e))}),!0)})}seek(e,t=!0){a(e)||(e=new Function(`with(this){return ${e}}`));let r=[];return t&&m(this,e)&&r.push(this),Object.keys(this).forEach(t=>{/\D/.test(t)&&g(this[t],e,r)}),this.forEach(t=>g(t,e,r)),r}entrend(e){let{mid:t,keys:r,name:n,args:s,_unpush:a}=e;if(a)return;let{_unpull:l}=this,i=N(e);if(l&&l.includes(i))return;if(!t)throw{text:"Illegal trend data"};let o=this.getTarget(r);if(o){let e=o[k];if(I(e,D).includes(t))return!1;e._modifyId=t,e[n](...s),e._modifyId=null}return!0}}const N=e=>{let t=e.keys[0];return!s(t)||"setData"!==e.name&&"remove"!==e.name||(t=e.args[0]),t};class P{constructor(e){if(e instanceof w){let{modify:{name:t,args:r,mid:n},keys:s}=l(e),{_unpush:a}=e;a&&Object.defineProperty(this,"_unpush",{value:!0}),Object.assign(this,{name:t,args:r,mid:n,keys:s})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){return N(this)}set fromKey(e){let t=this.keys[0];s(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}class H{constructor(e){this[M]=this,this.mirrorHost=e,this.parent=void 0,this.index=void 0;let t=e=>{this.parent&&o(this.parent,"",[],{},t=>{Object.assign(t,{keys:l(e.keys),modify:l(e.modify),currentTarget:e.currentTarget,target:e.target,oldValue:e.oldValue}),t.keys.unshift(this.index)})};return e.on("update",t),this[L]=t,new Proxy(this,K)}remove(e){return T.prototype.remove.call(this,e)}}const L=Symbol("XMirrorUpdataBinder"),M=Symbol("XMirror_self"),V=new Set(["index","parent","remove",L,M]),K={get(e,t,r){if(V.has(t))return Reflect.get(e,t,r);let n;return n="symbol"==typeof t?e.mirrorHost[t]:e.mirrorHost.getData(t),a(n)&&(n=n.bind(e.mirrorHost[_])),n},set:(e,t,r,n)=>V.has(t)?Reflect.set(e,t,r,n):e.mirrorHost.setData(t,r)},W=(e,t,r)=>{t.trends.forEach(t=>{t.fromKey===e&&r.entrend(t)})},J=(e,t,r)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&r.entrend(t)})},R=(e,t,r)=>{l(t.trends).forEach(t=>{t=new P(t);let{fromKey:n}=t;if(!s(n)){let s=e.get(n);s&&(t.fromKey=s,r.entrend(t))}})},F=e=>(e instanceof T&&(e=e.object),e),B={sync(e,t,r){let s,a;switch(n(t)){case"string":r&&e.setData(t,F(this[t])),s=(r=>W(t,r,e)),a=(e=>W(t,e,this));break;case"array":r&&t.forEach(t=>{e.setData(t,F(this[t]))}),s=(r=>J(t,r,e)),a=(e=>J(t,e,this));break;case"object":let l=new Map(Object.entries(t)),i=new Map(Object.entries(t).map(e=>e.reverse()));r&&Object.keys(t).forEach(r=>{e.setData(t[r],F(this[r]))}),s=(t=>R(l,t,e)),a=(e=>R(i,e,this));break;default:if(r){let t=this.object;Object.keys(t).forEach(r=>{e.setData(r,t[r])})}s=(t=>t.trends.forEach(t=>e.entrend(t))),a=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(s),e.watch(a);let l=I(this,$);l.has(e)&&this.unsync(e),l.set(e,{selfWatch:s,oppWatch:a}),I(e,$).set(this,{selfWatch:a,oppWatch:s})},unsync(e){let t=I(this,$).get(e);if(t){let{selfWatch:r,oppWatch:n}=t;this.unwatch(r),e.unwatch(n),I(this,$).delete(e),I(e,$).delete(this)}}};Object.keys(B).forEach(e=>{Object.defineProperty(T.prototype,e,{writable:!0,value:B[e]})}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(T.prototype,e,{value(...e){return t.apply(this,e)}})});const q=(e,t,r)=>{(e instanceof T||e instanceof H)&&t!==r&&(e.index=t,e.emitHandler("updateIndex",{oldIndex:r,index:t}))};["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(T.prototype,e,{value(...r){let n=[],s=this[k],a=s.object;r.forEach(e=>{if(e instanceof T){let t=e[k];t.remove(),n.push(t)}else if(e instanceof H)e.parent=s,n.push(e);else{let t=f(e,{parent:s});n.push(t)}});let l=t.apply(s,n);switch(s.forEach((e,t)=>{let r=e.index;q(e,t,r)}),e){case"shift":case"pop":(l instanceof T||l instanceof H)&&u(l);break;case"splice":l.forEach(e=>{(e instanceof T||e instanceof H)&&u(e)})}return o(s,e,r,{oldValue:a}),l}})}),Object.defineProperties(T.prototype,{sort:{value(e){let t=[],r=this[k],n=r.object,s=Array.from(r);if(a(e)||!e){Array.prototype.sort.call(r,e),r.forEach((e,t)=>{let r=e.index;q(e,t,r)}),t=[s.map(e=>e.index)],s=null}else e instanceof Array&&(e.forEach((e,t)=>{let n=r[e]=s[t],a=n.index;q(n,e,a)}),t=[e]);return o(r,"sort",t,{oldValue:n}),this}}});const X=(e,t)=>{if(!e.tagName)return!1;if(e===t)return!0;if(e===document)return!1;let r=document.createElement("template"),n=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`;return r.innerHTML=n,!!r.content.querySelector(t)},z=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let{data:r}=e;if(r&&Object.keys(r).forEach(e=>{let n=r[e];t.dataset[e]=n}),t.xvele){let r=Ne(t);r[ne].forEach(t=>{let n=e[t];s(n)||(r[t]=n)})}let n=0;for(;n in e;){let r=z(e[n]);t.appendChild(r),n++}return t},U=Object.getOwnPropertyDescriptor,Z=e=>{let t;if(e instanceof oe)return e.ele;switch(n(e)){case"string":/\<.+\>/.test(e)&&(t=(t=(e=>{let t=document.createElement("div");return t.innerHTML=e,Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e))[0]);break;case"object":t=z(e);break;default:(e instanceof Element||e instanceof DocumentFragment||e instanceof Document)&&(t=e)}return t},G=(e,t)=>{let r=e.querySelectorAll(t);return r?Array.from(r):[]},Q=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),Y=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),ee={get:function(e,t){return e._ele.getAttribute(Y(t))},set:function(e,t,r){return null===r?e._ele.removeAttribute(Y(t)):e._ele.setAttribute(Y(t),String(r)),!0}};const te=e=>{let t=e.__p_attrs;return t||(e.__p_attrs=t=new Proxy(new class{constructor(e){Object.defineProperties(this,{_ele:{get:()=>e}})}}(e),ee)),t},re=(e,t)=>{Object.keys(t).forEach(r=>{let{get:n,set:s,value:a}=U(t,r);a?e.hasOwnProperty(r)?e[r]=a:Object.defineProperty(e,r,{value:a}):(Object.defineProperty(e,r,{get:n,set:s}),s&&ae.add(r))})},ne=Symbol("cansetkeys"),se=Symbol("orignEvents"),ae=new Set(["text","html","display","style"]),le=new Set(["parent","slot"]),ie=T.prototype.setData;class oe extends T{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this,configurable:!0}});let t=e.tagName?e.tagName.toLowerCase():"";Object.defineProperties(this,{tag:{enumerable:!0,value:t},ele:{value:e},[se]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?Pe(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){if("string"==n(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),s=Object.keys(e);r.forEach(e=>{s.includes(e)||(t[e]="")}),Object.assign(t,e)}get $shadow(){let{shadowRoot:e}=this.ele;return e&&Pe(e)}get $root(){let e=this.ele;for(;e.parentNode;)e=e.parentNode;return e&&Pe(e)}get $host(){let{$root:e}=this;return e&&e.ele.host&&Pe(e.ele.host)}get attrs(){return te(this.ele)}moni(e,t){let r;this.watch(()=>{let n=this.all(e),s=!0;if(r&&r.length==n.length?n.some(e=>{if(!r.includes(e))return s=!1,!0}):s=!1,s)return;let a={old:r,val:n};r=n,t(n,a)},!0)}setData(e,t){if(le.has(e))return console.warn("can't set this key => ",e),!1;e=Q(e);let r=this[k],n=this[ne];if(ae.has(e)){let n=U(r,e);return n&&n.set?n.set.call(this[_],t):r[e]=t,!0}if(n&&n.has(e)||/^_.+/.test(e))return ie.call(r,e,t);if(!/\D/.test(e)){let n=He(t),s=r.ele.children[e];if(s){let a=r.getData(e).object;r.ele.insertBefore(n.ele,s),r.ele.removeChild(s),o(r,"setData",[e,t],{oldValue:a})}else r.ele.appendChild(n.ele),o(r,"setData",[e,t],{oldValue:void 0})}return!0}getData(e){e=Q(e);let t,r=this[k];if(/\D/.test(e)){let n=U(r,e);if(n){let{get:r,value:a}=n;s(a)?r&&(t=r.call(this[_],e)):t=a}else t=r[e]}else(t=r.ele.children[e])&&(t=Pe(t));return t instanceof T&&(t=t[_]),t}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(X(t,e))return!0})),t.map(e=>Pe(e))}empty(){return this.splice(0,this.length),this}parents(e,t){let r=[],s=this.parent;if(e){if("string"==n(e))for(;s&&s;)X(s.ele,e)&&r.push(s),s=s.parent}else for(;s;)r.push(s),s=s.parent;if(t)if(t instanceof oe){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==n(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}is(e){return X(this.ele,e)}$(e){let t=this.ele.querySelector(e);if(t)return Pe(t)}all(e){return G(this.ele,e).map(e=>Pe(e))}clone(){let e=Pe(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}}const ce=oe.prototype,he=e.MouseEvent||Event,de=e.TouchEvent||Event,ue=new Map([["click",he],["mousedown",he],["mouseup",he],["mousemove",he],["mouseenter",he],["mouseleave",he],["touchstart",de],["touchend",de],["touchmove",de]]),fe=e=>{let t,r,s,a=e[0];if("object"==n(a)){let e=a;a=e.event,r=e.callback,s=e.data,t=e.selector}else switch(n(e[1])){case"string":t=e[1],r=e[2],s=e[3];break;default:r=e[1],s=e[2]}return{eventName:a,selector:t,callback:r,data:s}};function pe(e,t={count:1/0}){let{eventName:r,selector:n,callback:s,data:a}=fe(e),l=this[se]||(this[se]=new Map);if(!l.has(r)){let e=e=>{let n,{_para_x_eve_:a}=e;if(a){(n=a).target.ele!==e.target&&(n.target=Pe(e.target));let t=[],r=e.target;for(;r!==e.currentTarget;){let e=r.parentNode;if(!e)break;let n=Array.from(e.children).indexOf(r);t.unshift(n),r=e}n.keys=t}else(n=new w({type:r,target:Pe(e.target)})).on("set-bubble",(t,r)=>!r&&e.stopPropagation()),n.on("set-cancel",(t,r)=>r&&e.stopImmediatePropagation()),n.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=n;n.originalEvent=e,this.emitHandler(n),n.originalEvent=null,t.count--,t.count||this.off(r,s)};l.set(r,e),this.ele.addEventListener(r,e)}if(this.addListener({type:r,count:t.count,data:a,callback:s}),n){y(r,this).forEach(e=>{e.callback==s&&(e.before=(e=>{let t,{self:r,event:s}=e,a=s.target;return(t=a.is(n)?a:a.parents(n)[0])?(Object.assign(s,{selector:n,delegateTarget:t}),1):0}),e.after=(e=>{let{self:t,event:r}=e;delete r.selector,delete r.delegateTarget}))})}}re(ce,{on(...e){return pe.call(this,e),this},off(...e){let t=e[0],r=y(t,this);if(T.prototype.off.apply(this,e),!r.length){let e=this[se]||(this[se]=new Map),r=e.get(t);r&&this.ele.removeEventListener(t,r),e.delete(t)}return this},one(...e){return pe.call(this,e,{count:1}),this},trigger(e,t){let r,n={bubbles:!0,cancelable:!0};if(Object.assign(n,t),e instanceof Event)r=e;else{r=new(ue.get(e)||Event)(e,{bubbles:n.bubbles,cancelable:n.cancelable})}return this.ele.dispatchEvent(r),this}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(ce,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>Pe(e)),e)}})});const me=(e,t)=>{e.forEach((e,r)=>{let n=t.findIndex(t=>t===e);-1!==n&&n!==r&&q(e,r,n)})},ge=(e,t,r,n=[])=>{let s=e[k],a=[];t<0&&(t+=s.length);let l=s.ele,{children:i}=l,c=/\D/.test(r)?s.length:r,h=s.map(e=>e);for(;c>0;){let e=i[t];if(!e)break;a.push(Pe(e)),l.removeChild(e),c--}let d=i[t];if(n.length){let e=document.createDocumentFragment();n.forEach(t=>e.appendChild(Z(t))),t>=0&&d?l.insertBefore(e,d):l.appendChild(e)}return me(s,h),o(s,"splice",[t,r,...n]),a},be=(e,t)=>{let r=e[k],{ele:n}=r,s=Array.from(n.children),a=document.createDocumentFragment();t.forEach(e=>{let t=s[e];t.xvele&&(t[ve]=1),a.appendChild(t)}),n.appendChild(a),s.forEach(e=>e.xvele&&(e[ve]=0))};re(ce,{push(...e){return ge(this,this.length,0,e),this.length},splice(e,t,...r){return ge(this,e,t,r)},unshift(...e){return ge(this,0,0,e),this.length},shift(){return ge(this,0,1)},pop(){return ge(this,this.length-1,1)},reverse(){let e=this.map(e=>e),t=Array.from(this.ele.children),r=t.length;be(this,t.map((e,t)=>r-1-t)),me(this,e),o(this[k],"reverse",[])},sort(e){let r=this.map(e=>e);if(a(e)){let r=Array.from(this.ele.children).map(e=>Pe(e)),n=Array.from(r);r.sort(e),e=[];let s=t();r.forEach(t=>{let r=n.indexOf(t);n[r]=s,e.push(r)})}e instanceof Array&&be(this,e),me(this,r),o(this[k],"sort",[e])}});const ye=({useTempName:e,temps:t,itemData:r,host:n,parent:s,index:a})=>{let l,i=t.get(e);if(!i)throw{desc:"find out the template",name:e,targetElement:n.ele};const o=n.$host&&n.$data?n.$host:n;r instanceof T?(l=f({$data:r.mirror,get $host(){return o},get $parent(){return s},get $index(){return void 0!==r.index?r.index:a}}),r.on("updateIndex",e=>{l.emitHandler("updateIndex")})):l=f({get $data(){return r},set $data(e){s[a]=e},get $host(){return o},get $parent(){return s},get $index(){return a}}),l[ne]=new Set,l=l[_];let c=Ne(Z(i.innerHTML));return c._update=!1,c.__fill_item=r,c.__fake_item=l,Ie({sroot:c.ele,proxyEle:l,temps:t}),{itemEle:c,fakeData:l}},xe=new Map,ve=Symbol("runArray"),we=Symbol("renderend"),Ee=Symbol("renderend_resove"),je=(Symbol("renderend_reject"),t(),e=>(Oe.lastIndex=0,Oe.test(e.trim()))),Oe=/(".*?"|'.*?'|\(|\)|\[|\]|\{|\}|\|\||\&\&|\?|\!|:| |\+|\-|\*|%|\,|\<|\>)/g,_e=/(".*?"|'.*?'|\(|\)|\[|\]|\{|\}|\|\||\&\&|\?|\!|:| |\+|\-|\*|%|\,|[\<\>\=]?[=]?=|\<|\>)/,ke=/(^\$event$|^\$args$|^debugger$|^console\.|^Number$|^String$|^Object$|^Array$|^parseInt$|^parseFloat$|^undefined$|^null$|^true$|^false$|^[\d])/,Ae=e=>{const r="$$"+t()+"_";let n=[],s=e.replace(/\? *[\w]+?:/g,e=>{let r="__"+t()+"__";return n.push({k:r,v:e}),r}).replace(/[\w]+? *:/g,e=>`${r}${e}`);return n.forEach(e=>{s=s.replace(e.k,e.v)}),s.split(Oe).map(e=>e.includes(r)?e.replace(r,""):_e.test(e)||!e.trim()||/^\./.test(e)||ke.test(e)?e:`this.${e}`).join("")},De=e=>new Function("...args",`\n    const $event = args[0];\n    const $args = args;\n    args = undefined;\n\n    try{\n        ${(e=>{let t="",r=e.split(";").filter(e=>!!e);return r.length>1?r.forEach(e=>{t+="\n"+Ae(e)+";"}):t=`return ${Ae(r[0])}`,t})(e)}\n    }catch(e){\n    let ele = this.ele;\n    if(!ele && this.$host){\n        ele = this.$host.ele;\n    }\n    let errObj = {\n        expr:'${e.replace(/'/g,"\\'").replace(/"/g,'\\"')}',\n        target:ele,\n        error:e\n    }\n    ele && ele.__xInfo && Object.assign(errObj,ele.__xInfo);\n    console.error(errObj);\n    }\n            `),$e=e=>{let t=document.createTextNode(""),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{textnode:t,par:r}},Se=(e,t,r={rmAttr:!0})=>{let n=G(e,t).map(e=>({ele:e}));e instanceof Element&&Ne(e).is(t)&&n.unshift({ele:e});let s=/^\[(.+)\]$/.exec(t);if(n.length&&s){let e=s[1];n.forEach(t=>{let{ele:n}=t,s=n.getAttribute(e);r.rmAttr&&(n.removeAttribute(e),n.setAttribute(`rendered-${e}`,s)),t.attrVal=s})}return n};const Ie=({sroot:e,proxyEle:r,temps:n,templateId:s})=>{let l=new class{constructor(e){this.processObj=new Map,this.proxyEle=e,this._hasAdd=!1}init(){if(!this._hasAdd)return;let{processObj:e,proxyEle:t}=this;const r=t[ne];for(let[n,s]of e){let{calls:e,target:a}=s;if(a=a||t,r.has(n)){let r;a.watch(n,r=((t,r)=>{console.log("change 1",n),e.forEach(e=>e.change(r))})),i(()=>r({},a[n])),t.on("clearxdata",e=>{a.unwatch(n,r)})}else{let r,s,l=De(n),o=1;a.watch(s=(t=>{let n=l.call(a);if(o)o=0;else if(n===r||n instanceof T&&n.string===r)return;e.forEach(e=>e.change(n)),r=n instanceof T?n.string:n})),i(()=>s({})),t.on("clearxdata",e=>{a.unwatch(s)}),a.on("updateIndex",s),a.on("reloadView",s)}}}add(e,t){let r=this.processObj,n=r.get(e.trim());n?n=n.calls:(n=[],r.set(e,{calls:n})),n.push({change:t}),this._hasAdd=!0}remove(e,t){let r=this.processObj.get(e.trim());if(r){let e=(r=r.calls).findIndex(e=>e.change===t);r.splice(e,1)}}}(r);const o=r[ne];Se(e,"[x-if]").forEach(t=>{let a,{ele:i,attrVal:o}=t,{textnode:c,par:h}=$e(i),d=t.ele;l.add(o,t=>{!t&&a?(h.removeChild(a.ele),a=null):t&&!a&&(a=Pe(Z(d.innerHTML)),h.insertBefore(a.ele,c),Ie({sroot:e,proxyEle:r,temps:n,xpAgent:l,templateId:s}))})});let c=Se(e,"[x-fill]");c.length&&c.forEach(e=>{let{ele:t,attrVal:s}=e,a=s.match(/(.+?) +use +(.+)/);if(!a)return void console.error({expr:s,desc:"fill expression error"});let[,l,o]=a;(({ele:e,attrName:t,useTempName:r,host:n,temps:s})=>{let a=Pe(e);a._update=!1;let l=n[t];l.forEach((t,a)=>{let{itemEle:i}=ye({useTempName:r,itemData:t,temps:s,host:n,parent:l,index:a});e.appendChild(i.ele)}),n.watch(t,e=>{let l=n[t];e.trends.forEach(e=>{let o=e.keys.slice();"setData"==e.name&&e.keys.length<t.split(".").length&&o.push(e.args[0]),t==o.join(".")&&i(()=>{l=n[t],a.forEach(e=>{let t=e.__fill_item;t instanceof T?l.includes(t)?e.ele[ve]=1:(e.__fill_item=null,e.ele.parentNode.removeChild(e.ele)):e.ele.parentNode.removeChild(e.ele)});let e=a.map(e=>e.ele),i=document.createDocumentFragment();l.forEach((e,t)=>{let o=a.find(t=>t.__fill_item==e);if(o)i.appendChild(o.ele);else{let{itemEle:a}=ye({useTempName:r,itemData:e,temps:s,host:n,parent:l,index:t});i.appendChild(a.ele)}}),a.ele.appendChild(i),e.forEach(e=>e[ve]=0)},l)})})})({ele:t,attrName:l,useTempName:o,host:r,temps:n})}),Se(e,"[x-target]").forEach(e=>{let{ele:t,attrVal:n}=e;Object.defineProperty(r,"$"+n,{get:()=>Pe(t)})}),Se(e,"[x-show]").forEach(e=>{let{ele:t,attrVal:r}=e;l.add(r,e=>{t.style.display=e?"":"none"})}),Se(e,"x-span").forEach(e=>{let{ele:t}=e,{textnode:r,par:n}=$e(t),s=t.getAttribute("xvkey");l.add(s,e=>{e=e instanceof T?e.string:String(e),r.textContent=e})}),Se(e,"[x-on]").forEach(t=>{let{ele:n,attrVal:s}=t,l=JSON.parse(s),i=Ne(n);Object.keys(l).forEach(t=>{let n,[s,...o]=t.split("."),c=l[t];n=je(c)?De(c):r[c];let h="on";o.includes("once")&&(h="one");let d=a(n);d||console.warn({target:e,eventName:s,desc:"no binding functions"}),i[h](s,(e,t)=>{o.includes("prevent")&&e.preventDefault(),o.includes("stop")&&(e.bubble=!1),d&&n.call(r,e,t)})})}),Se(e,"[x-bind]").forEach(e=>{let{ele:t,attrVal:n}=e,s=JSON.parse(n);Object.keys(s).forEach(e=>{let n=s[e],a=/^#(.+)/.exec(e);if(a){if(e=a[1],a=!!a,je(n))throw{desc:"Function expressions cannot be used for sync binding"};o.has(n)||/^\$data\./.test(n)||"$data"===n||console.error({desc:"the key can't sync bind",key:"attrName",target:t,host:r}),Ne(t).watch(e,(e,t)=>{r.setData(n,t)})}l.add(n,r=>{r instanceof oe&&(r=r.object),t.xvele?Ne(t).setData(e,r):(e=Y(e),void 0===r||null===r?t.removeAttribute(e):t.setAttribute(e,r))})})});let h=new Set;Se(e,"[x-model]").forEach(n=>{let{ele:a,attrVal:l}=n;if(h.has(a))return;let o=l;switch(a.tagName.toLowerCase()){case"input":switch(a.getAttribute("type")){case"checkbox":let n=Se(e,`input[type="checkbox"][rendered-x-model="${o}"][x-model-id="${s}"]`);return void(n.length>1?(n.forEach(e=>{e.ele.addEventListener("change",e=>{let{value:t,checked:n}=e.target,s=r.getData(o);n?s.add(t):s.delete(t)})}),n.forEach(e=>{h.add(e)})):(r.watch(o,(e,t)=>{a.checked=t},!0),a.addEventListener("change",e=>{let{checked:t}=a;r.setData(o,t)})));case"radio":let l=Se(e,`input[type="radio"][rendered-x-model="${o}"][x-model-id="${s}"]`),i=t();return void l.forEach(e=>{let t=e.ele;t.setAttribute("name",`radio_${o}_${i}`),t.addEventListener("change",e=>{t.checked&&r.setData(o,t.value)})})}case"textarea":case"text":r.watch(o,(e,t)=>{a.value=t}),i(()=>a.value=r[o]),a.addEventListener("input",e=>{r.setData(o,a.value)});break;case"select":r.watch(o,(e,t)=>{a.value=t}),i(()=>a.value=r[o]),a.addEventListener("change",e=>{r.setData(o,a.value)});break;default:if(a.xvele){let e=a.__xhear__;e.watch("value",(e,t)=>{r.setData(o,t)}),r.watch(o,(t,r)=>{e.setData("value",r)},!0)}else console.warn("can't x-model with thie element => ",a)}}),h.clear(),h=null,l.init()},Ce=e=>{let r=document.createElement("template");r.innerHTML=e,Array.from(r.content.querySelectorAll("[x-if]")).forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(r.content.querySelectorAll("template")).forEach(e=>{let{html:t}=Ce(e.innerHTML);e.innerHTML=t});let{templateId:n}=(e=>{let r=t();return Se(e,"*").forEach(e=>{let{ele:t}=e,n=Array.from(t.attributes),s=new Set,a={},l={};n.forEach(e=>{let{name:r,value:n}=e;if("$"===(r=Q(r)))return t.setAttribute("x-target",n),void s.add(r);let i=/^@(.+)/.exec(r);if(i)return a[i[1]]=n,void s.add(r);let o=/^:(.+)/.exec(r);return o?(l[o[1]]=n,void s.add(r)):void 0});let i=JSON.stringify(a);"{}"!=i&&t.setAttribute("x-on",i);let o=JSON.stringify(l);"{}"!=o&&t.setAttribute("x-bind",o),s.forEach(e=>{t.removeAttribute(Y(e))}),t.getAttribute("x-model")&&t.setAttribute("x-model-id",r)}),{templateId:r}})(r.content);return{templateId:n,html:r.innerHTML}},Te=(e,t)=>{let r=Ne(e),n=[];t.proto&&re(r,t.proto);let a,{temp:l}=t,o=Object.assign({},t.data),c=Object.keys(o);c.push(...t.attrs),c.push(...Object.keys(t.watch)),(c=new Set(c)).forEach(e=>{/^_.+/.test(e)&&c.delete(e)});let h=r[ne];if(h?c.forEach(e=>h.add(e)):Object.defineProperty(r,ne,{value:c}),c.has("value")&&Object.defineProperty(e,"value",{get:()=>r.value,set(e){r.value=e}}),r.watch(t.watch),t.attrs.forEach(t=>{r.watch(t,r=>{null===r.val||void 0===r.val?e.removeAttribute(Y(t)):e.setAttribute(Y(t),r.val)})}),Object.keys(o).forEach(e=>{let t=o[e];s(t)||r.setData(e,t)}),l){a=e.attachShadow({mode:"open"});var d=(l=l.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);d&&d.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(l=l.replace(e,`<x-span xvkey="${t[1].trim()}"></x-span>`))});let{html:t,templateId:n}=Ce(l);a.innerHTML=t;let s=new Map,i=Array.from(a.querySelectorAll("template[name]"));i.length&&i.forEach(e=>{e.parentNode.removeChild(e);let t=e.getAttribute("name");s.set(t,e)}),Ie({sroot:a,proxyEle:r[_],temps:s,templateId:n})}if(a){let t=G(a,"link");t.length&&t.forEach(t=>{n.push(new Promise((r,n)=>{t.sheet?r():(t.addEventListener("load",e=>{r()}),t.addEventListener("error",t=>{n({desc:"link load error",error:t,target:e})}))}))})}let u=()=>{i(()=>e.setAttribute("x-ele",1),e.xvid),r[Ee](),r.trigger("renderend",{bubbles:!1}),u=null};n.length?Promise.all(n).then(()=>{u()}):u()},Ne=e=>e.__xhear__||new oe(e),Pe=e=>Ne(e)[_];let He=e=>{if(e instanceof oe)return e;let t;return(t="string"!==n(e)||/\<.+\>/.test(e)?Z(e):document.querySelector(e))?Pe(t):null};Object.assign(He,{register:e=>{let r={tag:"",temp:"",attrs:[],data:{},watch:{}};Object.assign(r,e);let s=r.attrs,a=n(s);if("object"==a){let e=Object.keys(s);e.forEach(e=>{r.data[Q(e)]=s[e]}),s=r.attrs=e.map(e=>Q(e))}else"array"==a&&(s=r.attrs=s.map(e=>Q(e)));r.data=l(r.data),r.watch=Object.assign({},r.watch);let o=r.tag=Y(r.tag);const c=class extends oe{constructor(...e){super(...e),this[we]=new Promise((e,t)=>{this[Ee]=e})}get finish(){return this[we]}};r.proto&&re(c.prototype,r.proto);let h=document.currentScript&&document.currentScript.src;const d=class extends HTMLElement{constructor(){super(),this.__xInfo={scriptSrc:h},delete this.__xhear__;let e=new c(this);Object.defineProperty(this,"xvele",{value:!0}),Object.defineProperty(e,"xvele",{value:!0});let n=this.xvid="xv"+t(),s=Object.assign({},r);this.parentElement?this.setAttribute("x-ele",""):i(()=>this.setAttribute("x-ele",""),n),Te(this,s),s.ready&&s.ready.call(e[_]),s.slotchange&&e.$shadow.on("slotchange",t=>s.slotchange.call(e[_],t)),Object.defineProperties(this,{[ve]:{writable:!0,value:0}})}connectedCallback(){this[ve]||r.attached&&r.attached.call(Pe(this))}disconnectedCallback(){if(this[ve])return;let e=Pe(this);r.detached&&r.detached.call(e),e.deepClear()}attributeChangedCallback(e,t,r){let n=this.__xhear__;r!=n[e=Q(e)]&&n.setData(e,r)}static get observedAttributes(){return s.map(e=>Y(e))}};Object.assign(r,{XhearElement:d}),xe.set(r.tag,r),customElements.define(o,d)},nextTick:i,xdata:e=>f(e)[_],v:5004e3,version:"5.4.0",fn:ce,isXhear:e=>e instanceof oe,ext:e=>{e({renderComponent:Te})},all:e=>G(document,e).map(e=>Pe(e))}),e.$=He})(window);