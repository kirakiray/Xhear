(e=>{"use strict";function t(e,t={}){let r=new Proxy(this,V),s=0;Object.keys(e).forEach(t=>{let a=e[t];/\D/.test(t)||(t=parseInt(t))>=s&&(s=t+1),this[t]=L(a,{parent:r,hostkey:t})});let a={length:s,[I]:new Map,[_]:new Set,[M]:0,[N]:new Map,[S]:new Map};return h(this,a),d(this,{status:{writable:!0,value:t.parent?"binding":"root"},parent:{writable:!0,value:t.parent},hostkey:{writable:!0,value:t.hostkey}}),r}function r(e,t){d(this,{type:{enumerable:!0,value:e},keys:{enumerable:!0,value:[]},target:{enumerable:!0,value:t},bubble:{enumerable:!0,writable:!0,value:!0},cancel:{enumerable:!0,writable:!0,value:!1},currentTarget:{enumerable:!0,writable:!0,value:t}})}function s(e){d(this,{tag:{enumerable:!0,value:e.tagName.toLowerCase()},ele:{value:e}});let t={[I]:new Map,[_]:new Set,[M]:0,[N]:new Map,[S]:new Map,[y]:new Map,[m]:new Set};return h(this,t),new Proxy(this,W)}const a=()=>Math.random().toString(32).substr(2);let n=Object.prototype.toString;const l=e=>n.call(e).toLowerCase().replace(/(\[object )|(])/g,""),i=e=>void 0===e,o=e=>JSON.parse(JSON.stringify(e)),h=(e,t)=>{for(let r in t)c(e,r,{writable:!0,value:t[r]})};let{defineProperty:c,defineProperties:d,assign:f}=Object;const u=(()=>{let e=!1,t=[];return r=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(r)}})(),y="_xevent_"+a(),p="_xhearEle_"+a(),m="_exkeys_"+a(),v="_attached_"+a(),g="_detached_"+a(),k=new Map,b=new Set(["display","text","html","style"]),w=e=>{let t=e;for(;t.xvRender;){let e=t[p];if(e){let{$content:r}=e;if(!r)break;t=r.ele}}return t},x=(e,t)=>{if(e===t)return!0;let r=document.createElement("div");return e!==document&&(r.appendChild(e.cloneNode(!1)),!!r.querySelector(t))},E=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.text&&(t.textContent=e.text);let r,{xvele:s}=e;s&&(t.setAttribute("xv-ele",""),Q(t),(r=A(t))[m].forEach(t=>{let s=e[t];!i(s)&&(r[t]=s)}));let a=0;for(;a in e;){let s=E(e[a]);if(r){let{$content:e}=r;e&&e.ele.appendChild(s)}else t.appendChild(s);a++}return t},A=e=>{let t=e[p];return t||(t=new s(e),e[p]=t),t},O=e=>{if(e instanceof s)return e;let t;switch(l(e)){case"object":t=E(e),t=A(t);break;case"string":e=(e=>{let t=document.createElement("div");t.innerHTML=e;return Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return e})})(e)[0];default:e instanceof Element&&(t=A(e))}return t},I="_eves_"+a(),j="_runarrmethod_"+a(),_="_modify_"+a(),M="_modify_timer_"+a(),N="_watch_"+a(),S="_synchost_"+a();let C=e=>e instanceof t;const T=(e,t,r,s,a)=>{let n=0;switch(r){case"keyValue":let i=a[e];switch(s){case"=":i==t&&(n=1);break;case":=":C(i)&&i.findIndex(e=>e==t)>-1&&(n=1);break;case"*=":"string"==l(i)&&i.search(t)>-1&&(n=1);break;case"~=":"string"==l(i)&&i.split(" ").findIndex(e=>e==t)>-1&&(n=1)}break;case"hasValue":switch(s){case"=":Object.values(a).findIndex(e=>e==t)>-1&&(n=1);break;case":=":Object.values(a).some(e=>{if(C(e)&&e.findIndex(e=>e==t)>-1)return n=1,!0});break;case"*=":Object.values(a).some(e=>{if("string"==l(e)&&e.search(t)>-1)return n=1,!0});break;case"~=":Object.values(a).some(e=>{if("string"==l(e)&&e.split(" ").findIndex(e=>e==t)>-1)return n=1,!0})}break;case"hasKey":a.hasOwnProperty(e)&&(n=1)}return n};let q=(e,t)=>{let r=[],s=t.k,a=t.v,n=t.type,l=t.eqType;return Object.keys(e).forEach(i=>{let o=e[i];if(C(o)){T(s,a,n,l,o)&&r.push(o);let e=q(o,t);r.push(...e)}}),r};const L=(e,r)=>{let s=e;switch(l(e)){case"object":case"array":s=new t(e,r)}return s};let P=e=>{if(!C(e))return;e.parent&&(e.parent=null),e.status="destory",e.hostkey=null;let t=e[S].keys(),r=t.next();for(;!r.done;){let s=r.value;e.unsync(s),r=t.next()}e[N].clear(),e[I].clear(),e[_].clear()};const K=(e,t)=>{i(e[t.key])||(e[t.toKey]=e[t.key],delete e[t.key]);for(let r in e){let s=e[r];s instanceof Object&&K(s,t)}};let R=t.prototype={};d(r.prototype,{trend:{get(){let{modify:e}=this;if(!e)return;let t={genre:e.genre,keys:this.keys.slice()};switch(c(t,"oldVal",{value:e.oldVal}),e.genre){case"arrayMethod":var{methodName:r,args:s,modifyId:a}=e;f(t,{methodName:r,args:s,modifyId:a});break;default:var{value:n,modifyId:a}=e;C(n)&&(n=n.object);let l=this.keys[0];l=i(l)?e.key:l,f(t,{key:e.key,value:n,modifyId:a,fromKey:l})}return t}}});const D=(e,t)=>{let r=e[I],s=r.get(t);return s||(s=new Set,r.set(t,s)),s};h(R,{on(e,t,r){let s;if("object"==l(e)){let a=e;e=a.event,t=a.callback,r=a.data,s=a.count}let a,n=e.split("#");1 in n&&(a=n[1],e=n[0]);let o=D(this,e);return i(a)||Array.from(o).some(e=>{if(e.eventId===a)return o.delete(e),!0}),t&&o.add({eventName:e,callback:t,data:r,eventId:a,count:s}),this},one(e,t,r){return"object"==l(e)?(e.count=1,this.on(e)):this.on({event:e,callback:t,data:r,count:1}),this},off(e,t){if("object"==l(e)){let r=e;e=r.event,t=r.callback}let r=D(this,e);return Array.from(r).some(e=>{if(e.callback===t)return r.delete(e),!0}),this},emit(e,t){let s,a;if(e instanceof r?(a=e,e=e.type):a=new r(e,this),a.currentTarget=this,s=D(this,e),Array.from(s).some(e=>{if(a.cancel)return!0;let r=[a];!i(e.data)&&(a.data=e.data),!i(e.eventId)&&(a.eventId=e.eventId),!i(e.count)&&(a.count=e.count),!i(t)&&r.push(t),e.callback.apply(this,r),delete a.data,delete a.eventId,delete a.count,e.count&&(e.count--,e.count<=0&&s.delete(e))}),a.bubble&&!a.cancel){let{parent:e}=this;e&&(a.keys.unshift(this.hostkey),e.emit(a,t))}return this}});const $=e=>{let{target:t,key:s,value:n,receiver:l,modifyId:i,genre:o}=e;if(i){if(l[_].has(i))return!0}else i=a();l[_].add(i),H(l);let h=!0,c=new r("update",l);switch(o){case"handleSet":if((d=t[s])===n)return!0;if(C(n)){let e=n.object;n.remove(),n=e}let r;t.hasOwnProperty(s)||(r=1),t[s]=L(n,{parent:l,hostkey:s}),c.modify={genre:r?"new":"change",key:s,value:n,oldVal:d,modifyId:i};break;case"handleDelete":if(!t.hasOwnProperty(s))return!0;var d=t[s];delete t[s],P(d),c.modify={genre:"delete",key:s,oldVal:d,modifyId:i};break;case"arrayMethod":let{methodName:f,args:u}=e;switch(f){case"splice":case"push":case"unshift":u=u.map(e=>{if(C(e)){let t=e.object;e.remove(),e=t}return L(e)})}if(l[j]=1,"sort"!=f||u[0]instanceof Array)h=F[f].apply(l,u);else{let e=l.slice(),t=(h=F[f].apply(l,u)).slice(),r=[],s=a();e.forEach(e=>{let a=t.indexOf(e);t[a]=s,r.push(a)}),u=[r]}switch(delete l[j],f){case"splice":case"pop":case"shift":h.forEach(e=>{P(e)})}c.modify={genre:"arrayMethod",methodName:f,modifyId:i,args:u}}return l.emit(c),h},H=e=>{if(e[M])return;e[M]=1;let t=()=>{let{size:r}=e[_];if(r>2){let s=Math.floor(r/2);e[_].forEach((t,r)=>{r<s&&e[_].delete(t)}),setTimeout(t,3e3)}else e[_].clear(),e[M]=0,t=null};setTimeout(t,3e3)};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","includes"].forEach(e=>{let t=Array.prototype[e];t&&c(R,e,{writable:!0,value(...e){return t.apply(this,e)}})});const F={};["pop","push","reverse","splice","shift","unshift","sort"].forEach(e=>{let t=Array.prototype[e];F[e]=t,t&&c(R,e,{writable:!0,value(...t){let r=this._entrendModifyId;return r&&delete this._entrendModifyId,$({genre:"arrayMethod",args:t,methodName:e,modifyId:r,receiver:this})}})}),f(F,{sort(e){if(e instanceof Array){let t=this.slice();return e.forEach((e,r)=>{this[e]=t[r]}),this}return Array.prototype.sort.call(this,e)}});let V={set(e,t,r,s){if(/^_.+/.test(t)||e.hasOwnProperty(j))return Reflect.set(e,t,r,s);let a=e._entrendModifyId;return a&&delete e._entrendModifyId,$({genre:"handleSet",modifyId:a,target:e,key:t,value:r,receiver:s})},deleteProperty(e,t){if(/^_.+/.test(t)||e.hasOwnProperty(j))return Reflect.deleteProperty(e,t);let r=e._entrendModifyId;r&&delete e._entrendModifyId;let s;return e.parent?s=e.parent[e.hostkey]:(Object.values(e).some(e=>{if(C(e))return s=e.parent,!0}),s||(s=new Proxy(e,V))),$({genre:"handleDelete",modifyId:r,target:e,key:t,receiver:s})}};h(R,{seek(e){let t,r=[],s=e.match(/(^[^\[\]])\[.+\]/);s&&s.length>=2&&(t=s[1]);e.match(/\[.+?\]/g).forEach(e=>{let t=(e=e.replace(/\[|\]/g,"")).split(/(=|\*=|:=|~=)/),s=t[0];switch(t.length){case 3:s?r.push({type:"keyValue",k:s,eqType:t[1],v:t[2]}):r.push({type:"hasValue",eqType:t[1],v:t[2]});break;case 1:r.push({type:"hasKey",k:s})}});let a;return r.forEach((e,t)=>{let r=e.k,s=e.v,n=e.type,l=e.eqType;switch(t){case 0:a=q(this,e);break;default:a=a.filter(e=>T(r,s,n,l,e)?e:void 0)}}),t&&(a=a.filter(e=>e.hostkey==t?e:void 0)),a},watch(e,t){let r=l(e);/function/.test(r)&&(t=e,e="");let s;s=""==e?"watchOri":/\[.+\]/.test(e)?"seekOri":"watchKey";let a=this[N].get(e);if(a||(a={isNextTick:0,arr:new Set,modifys:[]},this[N].set(e,a)),a.arr.add(t),!a.updateFunc){let t;switch(s){case"watchOri":this.on("update",t=(e=>{a.modifys.push(e.trend),a.isNextTick||(a.isNextTick=1,u(()=>{a.arr.forEach(e=>{e.call(this,{modifys:Array.from(a.modifys)})}),a.modifys.length=0,a.isNextTick=0}))}));break;case"watchKey":this.on("update",t=(t=>{let{trend:r}=t;r.fromKey==e&&(a.modifys.push(r),a.isNextTick||(a.isNextTick=1,u(()=>{a.arr.forEach(t=>{t.call(this,{expr:e,val:this[e],modifys:Array.from(a.modifys)})}),a.modifys.length=0,a.isNextTick=0})))}));break;case"seekOri":if(a.isNextTick)return;let r=this.seek(e);a.isNextTick=1,u(()=>{let t=this.seek(e),s=1;t.length!=r.length&&(s=0),s&&t.some((e,t)=>{if(!isEqual(r[t],e))return s=0,!0}),s||a.arr.forEach(s=>{s.call(this,{expr:e,old:r,val:t})}),a.isNextTick=0})}a.updateFunc=t}if("seekOri"==s){let r=this.seek(e);t({expr:e,val:r})}},unwatch(e,t){let r=l(e);/function/.test(r)&&(t=e,e="");let s=this[N].get(e);return s&&(s.arr.delete(t),s.arr.length||(this.off("update",s.updateFunc),delete s.updateFunc,this[N].delete(e))),this},entrend(e){let t=this,{modifyId:r}=e;if(!r)throw"illegal trend data";switch(e.keys.forEach(e=>{t=t[e]}),t._entrendModifyId=r,e.genre){case"arrayMethod":t[e.methodName](...e.args);break;case"delete":delete t[e.key];break;default:t[e.key]=e.value}return this},sync(e,t,r=!1){let s,a;switch(l(t)){case"string":this.watch(s=(r=>{r.modifys.forEach(r=>{r.fromKey==t&&e.entrend(r)})})),e.watch(a=(e=>{e.modifys.forEach(e=>{e.fromKey==t&&this.entrend(e)})}));break;case"array":this.watch(s=(r=>{r.modifys.forEach(r=>{t.includes(r.fromKey)&&e.entrend(r)})})),e.watch(a=(e=>{e.modifys.forEach(e=>{t.includes(e.fromKey)&&this.entrend(e)})}));break;case"object":let r={};Object.keys(t).forEach(e=>{r[t[e]]=e}),this.watch(s=(r=>{r.modifys.forEach(r=>{let s=(r=o(r)).fromKey;t.hasOwnProperty(s)&&(i(r.keys[0])?r.key=t[s]:r.keys[0]=t[s],e.entrend(r))})})),e.watch(s=(e=>{e.modifys.forEach(e=>{let t=(e=o(e)).fromKey;r.hasOwnProperty(t)&&(i(e.keys[0])?e.key=r[t]:e.keys[0]=r[t],this.entrend(e))})}));break;default:this.watch(s=(t=>{t.modifys.forEach(t=>{e.entrend(t)})})),e.watch(a=(e=>{e.modifys.forEach(e=>{this.entrend(e)})}))}return this[S].set(e,{oppWatchFunc:a,watchFunc:s}),e[S].set(this,{oppWatchFunc:s,watchFunc:a}),r&&f(e,this.object),this},unsync(e){let t=this[S].get(e);if(t){let{oppWatchFunc:r,watchFunc:s}=t;this.unwatch(s),e.unwatch(r),this[S].delete(e),e[S].delete(this)}else console.warn("not found => ",e);return this},virData(e){switch(e.type){case"map":let t=this.object;K(t,e);let r={},s={};r[e.key]=e.toKey,s[e.toKey]=e.key,t=L(t);let a;return this.on("update",a=(e=>{let{trend:s}=e,a=r[s.key];i(a)||(s.key=a,t.entrend(s))})),t.on("update",e=>{let{trend:t}=e,r=s[t.key];i(r)||(t.key=r,this.entrend(t))}),c(t,"remove",{value(...e){e.length||this.off("update",a),R.remove.call(t,...e)}}),t}},removeByKey(e){/\D/.test(e)?delete this[e]:this.splice(parseInt(e),1)},remove(e){if(i(e)){let{parent:e}=this;e?e.removeByKey(this.hostkey):P(this)}else if(C(e))e.parent==this&&this.removeByKey(e.hostkey);else{let t=this.indexOf(e);t>-1&&this.removeByKey(t)}},add(e){!this.includes(e)&&this.push(e)},clone(){return L(this.object)},reset(e){let t=Object.keys(e);return Object.keys(this).forEach(e=>{t.includes(e)||"length"===e||delete this[e]}),f(this,e),this}}),d(R,{object:{get(){let e={};return Object.keys(this).forEach(t=>{let r=this[t];C(r)?e[t]=r.object:e[t]=r}),e}},string:{get(){return JSON.stringify(this.object)}},root:{get(){let e=this;for(;e.parent;)e=e.parent;return e}},prev:{get(){if(!/\D/.test(this.hostkey)&&this.hostkey>0)return this.parent[this.hostkey-1]}},next:{get(){if(!/\D/.test(this.hostkey))return this.parent[this.hostkey+1]}}});const W={get(e,t,r){if(/\D/.test(t))return Reflect.get(e,t,r);{let e=w(r.ele).children[t];return e&&A(e)}},set(e,t,r,s){if(/^_.+/.test(t)||b.has(t))return Reflect.set(e,t,r,s);let a=e._entrendModifyId;return a&&delete e._entrendModifyId,!(/\D/.test(t)&&!e[m].has(t))&&z({genre:"handleSet",modifyId:a,target:e,key:t,value:r,receiver:s})},deleteProperty:(e,t)=>/^_.+/.test(t)?Reflect.deleteProperty(e,t):(console.error("you can't use delete with xhearElement"),!1)};let B=s.prototype=Object.create(R);d(B,{hostkey:{get(){return Array.from(this.ele.parentElement.children).indexOf(this.ele)}},parent:{get(){let e=(e=>{let{parentElement:t}=e;if(t){for(;t.xvContent;)t=t[p].$host.ele;return t}})(this.ele);if(e)return A(e)}},xvele:{get(){let{attributes:e}=this.ele;return e.hasOwnProperty("xv-ele")||e.hasOwnProperty("xv-render")}},class:{get(){return this.ele.classList}},object:{get(){let e={tag:this.tag};if(this.xvRender){let t=this[m];t&&t.forEach(t=>{e[t]=this[t]})}else{let t=this.ele.classList.value;t&&(e.class=t)}return this.forEach((t,r)=>{e[r]=t instanceof s?t.object:t}),e}},length:{get(){return w(this.ele).children.length}}}),q=((e,t)=>{let r=[],a=t.k,n=t.v,l=t.type,i=t.eqType,o=s=>{let o=e[s];if(C(o)){T(a,n,l,i,o)&&r.push(o);let e=q(o,t);r.push(...e)}};if(e instanceof s){[...e[m]||[],...Object.keys(w(e.ele).children)].forEach(o)}else Object.keys(e).forEach(o);return o=null,r}),h(B,{on(...e){let t=e[0];if(!this[y].get(t)){let e;this.ele.addEventListener(t,e=(e=>{e.stopImmediatePropagation();let s=A(e.target),a=new r(t,s),n=s;for(;n.ele!==this.ele;)a.keys.unshift(n.hostkey),n=n.parent;a.originalEvent=e,a.preventDefault=e.preventDefault.bind(e),this.emit(a)})),this[y].set(t,e)}return R.on.apply(this,e)},one(...e){let t=e[0],r=R.one.apply(this,e);return J(this,t),r},off(...e){let t=e[0],r=R.off.apply(this,e);return J(this,t),r},emit(...e){let t=e[0];if(t instanceof r&&t.shadow&&t.shadow==this.xvRender)return;return R.emit.apply(this,e)},que(e){return te.que(e,this.ele)}});const J=(e,t)=>{let r=e[I][t];if(r&&!r.length){let r=e[y].get(t);e.ele.removeEventListener(t,r),e[y].delete(t)}},z=e=>{let{target:t,key:s,value:n,receiver:l,modifyId:i,genre:h}=e;if(i){if(l[_].has(i))return!0}else i=a();l[_].add(i),H(l);let c=!0,d=new r("update",l),{ele:f}=l,u=f.getAttribute("xv-shadow");switch(u&&(d.shadow=u),h){case"handleSet":let r;if(/\D/.test(s)){if((r=t[s])==n)return;(y=n)instanceof Object&&(y=o(y),y=L(y,{parent:l,hostkey:s})),t[s]=y}else{var y=O(n);u&&y.ele.setAttribute("xv-shadow",u);let e=l[s];if(e){let{parentElement:t}=e.ele;t.insertBefore(y.ele,e.ele),t.removeChild(e.ele)}else{w(f).appendChild(y.ele)}r=e}d.modify={genre:"change",key:s,value:n,oldVal:r,modifyId:i};break;case"arrayMethod":let{methodName:m,args:v}=e;switch(m){case"splice":c=U(l,...v);break;case"unshift":U(l,0,0,...v),c=l.length;break;case"push":U(l,l.length,0,...v),c=l.length;break;case"shift":c=U(l,0,1,...v);break;case"pop":c=U(l,l.length-1,1,...v);break;case"reverse":p=w(l.ele);Array.from(p.children).reverse().forEach(e=>{p.appendChild(e)}),c=this;break;case"sort":var p=w(l.ele);let e=v[0];if(e instanceof Array){let t=Array.from(p.children);e.forEach(e=>{p.appendChild(t[e])})}else{let t=Array.from(p.children).map(e=>A(e)),r=Array.from(t);t.sort(e);let s=[],n=a();t.forEach(e=>{let t=r.indexOf(e);r[t]=n,s.push(t)}),t.forEach(e=>{p.appendChild(e.ele)}),v=[s]}}d.modify={genre:"arrayMethod",methodName:m,modifyId:i,args:v}}return l.emit(d),c};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","includes"].forEach(e=>{let t=Array.prototype[e];t&&h(B,{[e](...e){return t.apply(Array.from(w(this.ele).children).map(e=>A(e)),e)}})}),["pop","push","reverse","splice","shift","unshift","sort"].forEach(e=>{c(B,e,{writable:!0,value(...t){let r=this._entrendModifyId;return r&&delete this._entrendModifyId,z({genre:"arrayMethod",args:t,methodName:e,modifyId:r,receiver:this})}})});const U=(e,t,r,...s)=>{let a=[],{ele:n}=e,l=w(n),{children:i}=l;for(;r>0;){let e=i[t];a.push(O(e)),l.removeChild(e),r--}let o=i[t],h=n.getAttribute("xv-shadow");return t>=0&&o?s.forEach(e=>{let t=O(e).ele;h&&t.setAttribute("xv-shadow",h),l.insertBefore(t,o)}):s.forEach(e=>{let t=O(e).ele;h&&t.setAttribute("xv-shadow",h),l.appendChild(t)}),a};d(B,{display:{get(){return getComputedStyle(this.ele).display},set(e){this.ele.style.display=e}},text:{get(){return w(this.ele).textContent},set(e){w(this.ele).textContent=e}},html:{get(){return w(this.ele).innerHTML},set(e){w(this.ele).innerHTML=e}},style:{get(){return this.ele.style},set(e){let{style:t}=this,r=Array.from(t),s=Object.keys(e);r.forEach(e=>{s.includes(e)||(t[e]="")}),f(t,e)}},position:{get(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}},offset:{get(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}},width:{get(){return parseInt(getComputedStyle(this.ele).width)}},height:{get(){return parseInt(getComputedStyle(this.ele).height)}},innerWidth:{get(){return this.ele.clientWidth}},innerHeight:{get(){return this.ele.clientHeight}},offsetWidth:{get(){return this.ele.offsetWidth}},offsetHeight:{get(){return this.ele.offsetHeight}},outerWidth:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}},outerHeight:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}}}),h(B,{before(e){if(/\D/.test(this.hostkey))throw console.error("can't use before in this data =>",this,e),"";return U(this.parent,this.hostkey,0,e),this},after(e){if(/\D/.test(this.hostkey))throw console.error("can't use after in this data =>",this,e),"";return U(this.parent,this.hostkey+1,0,e),this},siblings(e){let t=Array.from(this.ele.parentElement.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(x(t,e))return!0})),t.map(e=>A(e))},remove(){if(/\D/.test(this.hostkey))throw console.error(`can't delete this key => ${this.hostkey}`,this,data),"";U(this.parent,this.hostkey,1)},empty(){return this.splice(0,this.length),this},parents(e){let t=[],r=this.parent;if(e){if("string"!=l(e)){if(e instanceof s&&(e=e.ele),e instanceof Element)for(;r&&"html"!=r.tag;){if(r.ele==e)return!0;r=r.parent}return!1}for(;r&&"html"!=r.tag;)x(r.ele,e)&&t.push(r),r=r.parent}else for(;r&&"html"!=r.tag;)t.push(r),r=r.parent;return t},parentsUntil(e){if(e){let t=this.parent;for(;t&&"html"!=t.tag;){if(x(t.ele,e))return t;t=t.parent}}},attr(e,t){if(i(t)){if(!(e instanceof Object))return this.ele.getAttribute(e);Object.keys(e).forEach(t=>{this.attr(t,e[t])})}else{if(this.xvRender){k.get(this.tag).attrs.includes(e)&&(this[e]=t)}this.ele.setAttribute(e,t)}},removeAttr(e){return this.ele.removeAttribute(e),this},is(e){return x(this.ele,e)},que(e){return te.que(e,this.ele)},queAll(e){return te.queAll(e,this.ele)}});let G=100;const Q=e=>{let t=k.get(e.tagName.toLowerCase());if(!t)return void console.warn("not register tag "+e.tagName.toLowerCase());if(e.xvRender)return;let r=Array.from(e.childNodes);e.innerHTML=t.temp;let s=G++,a=A(e),{proto:n}=t;n&&Object.keys(n).forEach(e=>{c(a,e,{value:n[e]})}),Array.from(e.querySelectorAll("*")).forEach(e=>e.setAttribute("xv-shadow",s)),Array.from(e.querySelectorAll(`[xv-ele][xv-shadow="${s}"]`)).forEach(e=>Q(e)),e.removeAttribute("xv-ele"),e.setAttribute("xv-render",s),c(a,"xvRender",{value:e.xvRender=s});let l=e.querySelector(`[xv-content][xv-shadow="${s}"]`);if(l){let e=A(l);for(c(a,"$content",{value:e}),c(e,"$host",{value:a});l.xvRender;){let e=l[p].$content;e&&(l=e.ele)}r.forEach(e=>{l.appendChild(e)})}else r.forEach(t=>{e.appendChild(t)});Array.from(e.querySelectorAll(`[xv-tar][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-tar");c(a,"$"+t,{value:A(e)})}),Array.from(e.querySelectorAll(`xv-span[xv-shadow="${s}"]`)).forEach(e=>{var t=document.createTextNode("");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e);var r=e.getAttribute("xvkey");a.watch(r,e=>t.textContent=a[r])}),Array.from(e.querySelectorAll(`[xv-module][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-module"),r=r=>{a[t]=e.value};if(e.xvRender){A(e).watch("value",r)}else e.addEventListener("change",r),e.addEventListener("input",r);a.watch(t,r=>{e.value=a[t]})});let h=t.watch;Object.keys(h).forEach(e=>{a.watch(e,h[e])});let d=f({},t.data);t.attrs.forEach(t=>{let r=e.getAttribute(t);i(r)||null==r||(d[t]=r),a.watch(t,r=>{e.setAttribute(t,r.val)})}),t.props.forEach(t=>{let r=e.getAttribute(t);!i(r)&&null!=r&&(d[t]=r)});let u=Object.keys(d);u.push(...t.attrs),u.push(...t.props),u.push(...Object.keys(h)),u=new Set(u),c(a,m,{value:u}),u.forEach(e=>{let t=d[e];t instanceof Object&&(t=o(t),t=L(t,{parent:a,hostkey:e})),i(t)||(a[e]=t)}),u.has("value")&&c(e,"value",{get:()=>a.value,set(e){a.value=e}}),t.inited&&t.inited.call(a),t.attached&&!e[v]&&e.getRootNode()===document&&(t.attached.call(a),e[v]=1)};let X=0;const Y=()=>{if(X)return;X=1;new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:t,removedNodes:r}=e;t&&Z(Array.from(t),"attached",v),r&&Z(Array.from(r),"detached",g)})}).observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})},Z=(e,t,r)=>{e.forEach(s=>{s.xvRender&&ee(s,t,r),s instanceof Element&&e.forEach(e=>{ee(s,t,r)})})},ee=(e,t,r)=>{if(!e.xvRender||e[r])return;let s=k.get(e.tagName.toLowerCase());s[t]&&(s[t].call(e,A(e)),e[r]=1)};let te=e=>{if(e instanceof s)return e;let t=e;return"string"===l(e)&&-1===e.search("<")&&(t=document.querySelector(e)),O(t)};e.$=te,f(te,{fn:B,type:l,init:A,que:(e,t=document)=>A(t.querySelector(e)),queAll:(e,t=document)=>Array.from(t.querySelectorAll(e)).map(e=>A(e)),xdata:L,register:e=>{let t={tag:"",temp:"",attrs:[],props:[],data:{},watch:{}};if(f(t,e),t.attrs=t.attrs.slice(),t.props=t.props.slice(),t.data=o(t.data),t.watch=f({},t.watch),t.temp){let{temp:e}=t,s=document.createElement("div");if(s.innerHTML=e,!s.querySelector("[xv-content]"))throw t.tag+" need container!";var r=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);r&&r.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<xv-span xvkey="${r[1].trim()}"></xv-span>`))}),t.temp=e}(t.attached||t.detached)&&Y(),k.set(t.tag,t),Array.from(document.querySelectorAll(t.tag+"[xv-ele]")).forEach(e=>{Q(e)})}});let re=document.createElement("style");re.innerHTML="[xv-ele]{display:none;}",document.head.appendChild(re),u(()=>{Array.from(document.querySelectorAll("[xv-ele]")).forEach(e=>{Q(e)})})})(window);