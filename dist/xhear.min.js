/*!
* xhear v5.4.0
* https://github.com/kirakiray/Xhear#readme
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const a=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),n=e=>void 0===e,s=e=>a(e).includes("function"),l=e=>e instanceof I?e.object:JSON.parse(JSON.stringify(e)),i=(()=>{if(null!==document.currentScript.getAttribute("debug")){let e=new Map;return(r,a)=>{a||(a=t());let n=e.get(a);clearTimeout(n),e.set(a,setTimeout(()=>{r(),e.delete(a)}))}}let e=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let a=!1;return(n,s)=>{s||(s=t()),e.set(s,{key:s,fun:n}),a||(a=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),a=!1}))}})(),o=(e,r,a,n,s)=>{let i;i=e._modifyId?e._modifyId:t(),$(e,_).push(i),d(e);let o=new v({type:"update",target:e[E]||e});Object.defineProperties(o,{trend:{get:()=>new T(o)}}),n&&Object.assign(o,n),o.modify={name:r,args:a.map(e=>e instanceof I?e.object:e instanceof Object?l(e):e),mid:i},s&&s(o),e.emit(o)};let c,h=new Set;const d=e=>{e[_].length<50||(clearTimeout(c),h.add(e),c=setTimeout(()=>{let e=Array.from(h);setTimeout(()=>{e.forEach(e=>d(e))},1e3),h.forEach(e=>{let t=e[_];t.splice(0,Math.ceil(t.length/2))}),h.clear()},3e3))},u=e=>{if(!(e instanceof I))return;let t=e[O];if(t)try{t.index=void 0,t.parent=void 0}catch(e){}if(e instanceof J){let{mappingXData:r}=e,a=r[A].find(e=>e.data===t),{leftUpdate:n,rightUpdate:s}=a;e.off("update",s),r.off("update",n),t.mappingXData=null}if(t[D])for(let[r,a]of t[D])e.unsync(r);t[A]&&(t[A].forEach(e=>{let{data:r,leftUpdate:a,rightUpdate:n}=e;r.off("update",n),t.off("update",a),r.mappingXData=null}),t[A].splice(0)),t.emit("clearxdata"),t[k]&&t[k].clear(),t[g]&&t[g].clear()},f=(e,t)=>{let r=e;switch(a(e)){case"object":case"array":r=new I(e,t)}return r},p=(e,t)=>{if(e instanceof Array)return e.map(e=>p(e,t));if(e instanceof Object){let r={},a=[];return Object.keys(e).forEach(n=>{/\D/.test(n)?r[n]=p(e[n]):a.push(p(e[n],t))}),a.length&&(r[t]=a),r}return e},g=Symbol("events"),b=(e,t)=>{let r=t[g];r||(r=new Map,Object.defineProperty(t,g,{value:r}));let a=r.get(e);return a||(a=[],r.set(e,a)),a},m=(e,t)=>{let r;return e instanceof v?e=(r=e).type:r=new v({type:e,target:t[E]||t}),r};class y{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,r){this.addListener({type:e,data:r,callback:t})}one(e,t,r){this.addListener({count:1,type:e,data:r,callback:t})}addListener(e={}){let{type:t,data:r,callback:a,count:s=1/0,eventId:l}=e;if(!t)throw{desc:"addListener no type",options:e};let i=t.split("#");1 in i&&(t=i[0],l=i[1]);let o=b(t,this);n(l)||Array.from(o).some(e=>{if(e.eventId===l){let t=o.indexOf(e);return t>-1&&o.splice(t,1),!0}}),a&&o.push({type:t,data:r,callback:a,eventId:l,count:s})}off(e,t){if(e){if(!t)throw{desc:"off must have callback"};{let r=b(e,this),a=r.findIndex(e=>e.callback==t);a>-1&&r.splice(a,1)}}}emitHandler(e,t){let r=m(e,this);e=r.type;let a=b(e,this),n=[];return r.currentTarget=this[E]||this,a.some(e=>{e.data&&(r.data=e.data),e.eventId&&(r.eventId=e.eventId);let a={self:this,event:r,emitData:t};if((e.before?e.before(a):1)&&e.callback.call(this[E]||this,r,t),e.after&&e.after(a),delete r.data,delete r.eventId,e.count--,e.count||n.push(e),r.cancel)return!0}),delete r.currentTarget,n.forEach(e=>{let t=a.indexOf(e);t>-1&&a.splice(t,1)}),r}emit(e,t){let r=this.emitHandler(e,t);if(r.bubble&&!r.cancel){let{parent:e}=this;e&&(r.keys.unshift(this.index),e.emit(r,t))}}}class v extends y{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const x=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,w=/^parent$|^index$|^length$|^object$/;let j={get:(e,t,r)=>"symbol"==typeof t||x.test(t)?Reflect.get(e,t,r):e.getData(t),set:(e,t,r,a)=>"symbol"==typeof t?Reflect.set(e,t,r,a):e.setData(t,r)};const E=Symbol("proxyThis"),O=Symbol("XDataSelf"),k=Symbol("WatchHost"),_=Symbol("ModifyIDS"),D=Symbol("SyncHost"),A=Symbol("VirDataHost"),S=Symbol("StanzID"),$=(e,t)=>{let r=e[t];if(!r){switch(t){case k:case D:r=new Map;break;case _:case A:r=[]}Object.defineProperty(e,t,{value:r})}return r},C="undefined"!=typeof Element;class I extends y{constructor(e,r={}){super(r);let a=new Proxy(this,j),n=0;Object.keys(e).forEach(t=>{let r=e[t];/^\_/.test(t)||C&&r instanceof Element?Object.defineProperty(this,t,{configurable:!0,writable:!0,value:r}):(/\D/.test(t)||(t=parseInt(t))>=n&&(n=t+1),r instanceof Object?this[t]=new I(r,{parent:this,index:t}):this[t]=r)});const s=t();Object.defineProperties(this,{[O]:{get:()=>this},[E]:{value:a},[S]:{value:s},xid:{get:()=>s},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:n}})}setData(e,t){if(w.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let r=this[O];if(/\./.test(e)){let a=e.split("."),n=a.length-1;return a.some((t,a)=>{if(a==n)return e=t,!0;r=r[t]}),r.setData(e,t),!0}if("string"===a(e)){let a=r[e];return t===a||(a instanceof I&&(a=a.object),t instanceof I?((t=t[O]).remove(),t.parent=r,t.index=e):t instanceof Object&&(t=f(t,{parent:r,index:e})),r[e]=t,o(r,"setData",[e,t],{oldValue:a}),!0)}if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let a=t[e];r.setData(e,a)}),!0}}getData(e){let t=this[e];return t instanceof I&&(t=t[E]),t}remove(e){if(n(e)){let{parent:e}=this;e?e.remove(this.index):u(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],u(t),o(this,"remove",[e])):this.splice(parseInt(e),1)}}deepClear(){Object.keys(this).forEach(e=>{if(/\D/.test(e)){let t=this[e];t instanceof I&&t.deepClear()}}),this.forEach(e=>{e instanceof I&&e.deepClear()}),u(this)}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return f(l(this))[E]}emitHandler(e,t){let r=m(e,this);if("update"===r.type){let{_unBubble:e,_update:t,_unpush:a}=this,{fromKey:n}=r.trend;(!1===t||e&&e.includes(n))&&(r.bubble=!1),a&&a.includes(n)&&Object.defineProperty(r,"_unpush",{value:!0})}return y.prototype.emitHandler.call(this,r,t),r}noStanz(e={childKey:"children"}){return p(this.object,e.childKey)}get object(){let e={},t=!0,{_unBubble:r=[]}=this;return Object.keys(this).forEach(a=>{if(/^_/.test(a)||!/\D/.test(a)||r.includes(a))return;let n=this[a];if(n instanceof I){if(!1===n._update)return;n=n.object}e[a]=n,t=!1}),this.forEach((t,r)=>{t instanceof I&&(t=t.object),e[r]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}toJSON(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}getTarget(e){let t=this;return e.length&&e.some(e=>{if(!t)return console.warn("getTarget failure"),!0;t=t[e]}),t}watch(e,t,r){let n,s=a(e);if("object"===s)return void Object.keys(e).forEach(r=>{this.watch(r,e[r],t)});/function/.test(s)&&(r=t,t=e,e=""),n=""===e?"watchSelf":e instanceof RegExp?"watchKeyReg":/\./.test(e)?"watchPointKey":"watchKey";let l=$(this,k).get(e);l||(l=new Set,$(this,k).set(e,l));let o,c={trends:[],callback:t,expr:e,push(e){this.trends.push(e)}};l.add(c);let h=this[E];switch(n){case"watchSelf":o=(e=>{c.push(e.trend),i(()=>{t.call(h,{trends:Array.from(c.trends)},h),c.trends.length=0},c)}),!0===r&&t.call(h,{trends:[]},h);break;case"watchKey":case"watchKeyReg":o=(r=>{let{trend:a}=r;("watchKeyReg"===n&&e.test(a.fromKey)||a.fromKey==e)&&(c.push(r.trend),c.cacheOld||(c._oldVal=r.oldValue instanceof I?r.oldValue.object:r.oldValue,c.cacheOld=!0),i(()=>{let r=this[e];t.call(h,{expr:e,val:r,old:c._oldVal,trends:Array.from(c.trends)},r),c.trends.length=0,c._oldVal=c.cacheOld=!1},c))}),!0===r&&t.call(h,{expr:e,val:h[e],trends:[]},h[e]);break;case"watchPointKey":let a=e.split("."),s=a[0],l=this.getTarget(a);o=(r=>{let{trend:n}=r;if(n.fromKey==s){let s;try{s=this.getTarget(a)}catch(r){}s!==l&&(c.push(n),i(()=>{(s=this.getTarget(a))!==l&&t.call(h,{expr:e,old:l,val:s,trends:Array.from(c.trends)},s),c.trends.length=0},c))}}),!0===r&&t.call(h,{expr:e,val:l},l)}return this.on("update",o),c.updateMethod=o,this}unwatch(e,t){let r=a(e);if("object"===r)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(r)&&(t=e,e="");let n=$(this,k).get(e);if(n){let r=Array.from(n).find(r=>r.callback===t&&r.expr===e);r&&(r.updateMethod&&this.off("update",r.updateMethod),n.delete(r),!n.size&&$(this,k).delete(e))}return this}watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r,a=new Function(`\n            try{with(this){\n                return ${e}\n            }}catch(e){}`).bind(this);this.watch(r=(()=>{let e=a();e&&(this.unwatch(r),t(e))}),!0)})}entrend(e){let{mid:t,keys:r,name:a,args:n,_unpush:s}=e;if(s)return;let{_unpull:l}=this,i=P(e);if(l&&l.includes(i))return;if(!t)throw{text:"Illegal trend data"};let o=this.getTarget(r);if(o){let e=o[O];if($(e,_).includes(t))return!1;e._modifyId=t,e[a](...n),e._modifyId=null}return!0}}const P=e=>{let t=e.keys[0];return!n(t)||"setData"!==e.name&&"remove"!==e.name||(t=e.args[0]),t};class T{constructor(e){if(e instanceof v){let{modify:{name:t,args:r,mid:a},keys:n}=l(e),{_unpush:s}=e;s&&Object.defineProperty(this,"_unpush",{value:!0}),Object.assign(this,{name:t,args:r,mid:a,keys:n})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){return P(this)}set fromKey(e){let t=this.keys[0];n(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}const N=(e,t,r)=>{t.trends.forEach(t=>{t.fromKey===e&&r.entrend(t)})},L=(e,t,r)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&r.entrend(t)})},M=(e,t,r)=>{l(t.trends).forEach(t=>{t=new T(t);let{fromKey:a}=t;if(!n(a)){let n=e.get(a);n&&(t.fromKey=n,r.entrend(t))}})},H=e=>(e instanceof I&&(e=e.object),e),V=(e,t,r)=>{Object.keys(e).forEach(a=>{let n=e[a];if(n instanceof Object){t[a]||(t.setData?t.setData(a,{}):t[a]={});let e=t[a];V(n,e,r)}else{let s=r([a,n],{self:e,target:t});if(s){let[e,r]=s;t[e]=r}}})},K=(e,t,r)=>{let{trend:a}=t;if(a){switch(a.name){case"setData":let e=a.args[1];if(e instanceof Object){let t={};V(e,t,r),a.args[1]=t}else n(e)||(a.args=r(a.args,{event:t}));break;default:a.args=a.args.map(e=>{let t=e;return e instanceof Object&&V(e,t={},r),t})}e.entrend(a)}},W={sync(e,t,r){let n,s;switch(a(t)){case"string":r&&e.setData(t,H(this[t])),n=(r=>N(t,r,e)),s=(e=>N(t,e,this));break;case"array":r&&t.forEach(t=>{e.setData(t,H(this[t]))}),n=(r=>L(t,r,e)),s=(e=>L(t,e,this));break;case"object":let l=new Map(Object.entries(t)),i=new Map(Object.entries(t).map(e=>e.reverse()));r&&Object.keys(t).forEach(r=>{e.setData(t[r],H(this[r]))}),n=(t=>M(l,t,e)),s=(e=>M(i,e,this));break;default:if(r){let t=this.object;Object.keys(t).forEach(r=>{e.setData(r,t[r])})}n=(t=>t.trends.forEach(t=>e.entrend(t))),s=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(n),e.watch(s);let l=$(this,D);l.has(e)&&this.unsync(e),l.set(e,{selfWatch:n,oppWatch:s}),$(e,D).set(this,{selfWatch:s,oppWatch:n})},unsync(e){let t=$(this,D).get(e);if(t){let{selfWatch:r,oppWatch:a}=t;this.unwatch(r),e.unwatch(a),$(this,D).delete(e),$(e,D).delete(this)}},virData(e,t){let r,n,s=new J(this[O],{}),l=a(e),i=e;if("object"==l)if("mapKey"in i){let r=Object.entries(i.mapKey),a=new Map(r),n=new Map(r.map(e=>e.reverse()));e=(([e,t])=>a.has(e)?[a.get(e),t]:[e,t]),t=(([e,t])=>n.has(e)?[n.get(e),t]:[e,t])}else if("mapValue"in i){let r=i.key,a=Object.entries(i.mapValue),n=new Map(a),s=new Map(a.map(e=>e.reverse()));e=(([e,t])=>e===r&&n.has(t)?[e,n.get(t)]:[e,t]),t=(([e,t])=>e===r&&s.has(t)?[e,s.get(t)]:[e,t])}return V(this,s,e),this.on("update",r=(t=>K(s,t,e))),s.on("update",n=(e=>K(this,e,t))),$(this,A).push({data:s,leftUpdate:r,rightUpdate:n}),s[E]}};Object.keys(W).forEach(e=>{Object.defineProperty(I.prototype,e,{writable:!0,value:W[e]})});class J extends I{constructor(e,...t){super(...t),Object.defineProperty(this,"mappingXData",{writable:!0,value:e})}}["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...e){return t.apply(this,e)}})});const F=(e,t,r)=>{t!==r&&e.emitHandler("updateIndex",{oldIndex:r,index:t})};["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...r){let a=[],n=this[O],s=n.object;r.forEach(e=>{if(e instanceof I){let t=e[O];t.remove(),a.push(t)}else{let t=f(e,{parent:n});a.push(t)}});let l=t.apply(n,a);switch(n.forEach((e,t)=>{if(e instanceof I){let r=e.index;e.index=t,F(e,t,r)}}),e){case"shift":case"pop":l instanceof I&&u(l);break;case"splice":l.forEach(e=>{e instanceof I&&u(e)})}return o(n,e,r,{oldValue:s}),l}})}),Object.defineProperties(I.prototype,{sort:{value(e){let t=[],r=this[O],a=r.object,n=Array.from(r);if(s(e)||!e){Array.prototype.sort.call(r,e),r.forEach((e,t)=>{if(e instanceof I){let r=e.index;e.index=t,F(e,t,r)}}),t=[n.map(e=>e.index)],n=null}else e instanceof Array&&(e.forEach((e,t)=>{let a=r[e]=n[t],s=a.index;a.index=e,F(a,e,s)}),t=[e]);return o(r,"sort",t,{oldValue:a}),this}}});const U=(e,t)=>{if(!e.tagName)return!1;if(e===t)return!0;if(e===document)return!1;let r=document.createElement("template"),a=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`;return r.innerHTML=a,!!r.content.querySelector(t)},X=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let{data:r}=e;if(r&&Object.keys(r).forEach(e=>{let a=r[e];t.dataset[e]=a}),t.xvele){let r=Se(t);r[ee].forEach(t=>{let a=e[t];n(a)||(r[t]=a)})}let a=0;for(;a in e;){let r=X(e[a]);t.appendChild(r),a++}return t},B=Object.getOwnPropertyDescriptor,R=e=>{let t;if(e instanceof se)return e.ele;switch(a(e)){case"string":/\<.+\>/.test(e)&&(t=(t=(e=>{let t=document.createElement("div");return t.innerHTML=e,Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e))[0]);break;case"object":t=X(e);break;default:(e instanceof Element||e instanceof DocumentFragment||e instanceof Document)&&(t=e)}return t},z=(e,t)=>{let r=e.querySelectorAll(t);return r?Array.from(r):[]},q=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),Z=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),G={get:function(e,t){return e._ele.getAttribute(Z(t))},set:function(e,t,r){return null===r?e._ele.removeAttribute(Z(t)):e._ele.setAttribute(Z(t),String(r)),!0}};const Q=e=>{let t=e.__p_attrs;return t||(e.__p_attrs=t=new Proxy(new class{constructor(e){Object.defineProperties(this,{_ele:{get:()=>e}})}}(e),G)),t},Y=(e,t)=>{Object.keys(t).forEach(r=>{let{get:a,set:n,value:s}=B(t,r);s?e.hasOwnProperty(r)?e[r]=s:Object.defineProperty(e,r,{value:s}):(Object.defineProperty(e,r,{get:a,set:n}),n&&re.add(r))})},ee=Symbol("cansetkeys"),te=Symbol("orignEvents"),re=new Set(["text","html","display","style"]),ae=new Set(["parent","slot"]),ne=I.prototype.setData;class se extends I{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this,configurable:!0}});let t=e.tagName?e.tagName.toLowerCase():"";Object.defineProperties(this,{tag:{enumerable:!0,value:t},ele:{value:e},[te]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?$e(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){if("string"==a(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),n=Object.keys(e);r.forEach(e=>{n.includes(e)||(t[e]="")}),Object.assign(t,e)}get $shadow(){let{shadowRoot:e}=this.ele;return e&&$e(e)}get $root(){let e=this.ele;for(;e.parentNode;)e=e.parentNode;return e&&$e(e)}get $host(){let{$root:e}=this;return e&&e.ele.host&&$e(e.ele.host)}get attrs(){return Q(this.ele)}moni(e,t){let r;this.watch(()=>{let a=this.all(e),n=!0;if(r&&r.length==a.length?a.some(e=>{if(!r.includes(e))return n=!1,!0}):n=!1,n)return;let s={old:r,val:a};r=a,t(a,s)},!0)}setData(e,t){if(ae.has(e))return console.warn("can't set this key => ",e),!1;e=q(e);let r=this[O],a=this[ee];if(re.has(e)){let a=B(r,e);return a&&a.set?a.set.call(this[E],t):r[e]=t,!0}if(a&&a.has(e)||/^_.+/.test(e))return ne.call(r,e,t);if(!/\D/.test(e)){let a=Ce(t),n=r.ele.children[e];if(n){let s=r.getData(e).object;r.ele.insertBefore(a.ele,n),r.ele.removeChild(n),o(r,"setData",[e,t],{oldValue:s})}else r.ele.appendChild(a.ele),o(r,"setData",[e,t],{oldValue:void 0})}return!0}getData(e){e=q(e);let t,r=this[O];if(/\D/.test(e)){let a=B(r,e);if(a){let{get:r,value:s}=a;n(s)?r&&(t=r.call(this[E],e)):t=s}else t=r[e]}else(t=r.ele.children[e])&&(t=$e(t));return t instanceof I&&(t=t[E]),t}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(U(t,e))return!0})),t.map(e=>$e(e))}empty(){return this.splice(0,this.length),this}parents(e,t){let r=[],n=this.parent;if(e){if("string"==a(e))for(;n&&n;)U(n.ele,e)&&r.push(n),n=n.parent}else for(;n;)r.push(n),n=n.parent;if(t)if(t instanceof se){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==a(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}is(e){return U(this.ele,e)}$(e){let t=this.ele.querySelector(e);if(t)return $e(t)}all(e){return z(this.ele,e).map(e=>$e(e))}clone(){let e=$e(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}getTarget(e){let t=this;return e.length&&e.some(e=>{if(!t)return console.warn("getTarget failure"),!0;(t=t[e])._fakeWrapper&&(t=t._fakeWrapper)}),t}}const le=se.prototype,ie=e.MouseEvent||Event,oe=e.TouchEvent||Event,ce=new Map([["click",ie],["mousedown",ie],["mouseup",ie],["mousemove",ie],["mouseenter",ie],["mouseleave",ie],["touchstart",oe],["touchend",oe],["touchmove",oe]]),he=e=>{let t,r,n,s=e[0];if("object"==a(s)){let e=s;s=e.event,r=e.callback,n=e.data,t=e.selector}else switch(a(e[1])){case"string":t=e[1],r=e[2],n=e[3];break;default:r=e[1],n=e[2]}return{eventName:s,selector:t,callback:r,data:n}};function de(e,t={count:1/0}){let{eventName:r,selector:a,callback:n,data:s}=he(e),l=this[te]||(this[te]=new Map);if(!l.has(r)){let e=e=>{let a,{_para_x_eve_:s}=e;if(s){(a=s).target.ele!==e.target&&(a.target=$e(e.target));let t=[],r=e.target;for(;r!==e.currentTarget;){let e=r.parentNode;if(!e)break;let a=Array.from(e.children).indexOf(r);t.unshift(a),r=e}a.keys=t}else(a=new v({type:r,target:$e(e.target)})).on("set-bubble",(t,r)=>!r&&e.stopPropagation()),a.on("set-cancel",(t,r)=>r&&e.stopImmediatePropagation()),a.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=a;a.originalEvent=e,this.emitHandler(a),a.originalEvent=null,t.count--,t.count||this.off(r,n)};l.set(r,e),this.ele.addEventListener(r,e)}if(this.addListener({type:r,count:t.count,data:s,callback:n}),a){b(r,this).forEach(e=>{e.callback==n&&(e.before=(e=>{let t,{self:r,event:n}=e,s=n.target;return(t=s.is(a)?s:s.parents(a)[0])?(Object.assign(n,{selector:a,delegateTarget:t}),1):0}),e.after=(e=>{let{self:t,event:r}=e;delete r.selector,delete r.delegateTarget}))})}}Y(le,{on(...e){return de.call(this,e),this},off(...e){let t=e[0],r=b(t,this);if(I.prototype.off.apply(this,e),!r.length){let e=this[te]||(this[te]=new Map),r=e.get(t);r&&this.ele.removeEventListener(t,r),e.delete(t)}return this},one(...e){return de.call(this,e,{count:1}),this},trigger(e,t){let r,a={bubbles:!0,cancelable:!0};if(Object.assign(a,t),e instanceof Event)r=e;else{r=new(ce.get(e)||Event)(e,{bubbles:a.bubbles,cancelable:a.cancelable})}return this.ele.dispatchEvent(r),this}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(le,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>$e(e)),e)}})});const ue=(e,t)=>{e.forEach((e,r)=>{let a=t.findIndex(t=>t===e);-1!==a&&a!==r&&F(e,r,a)})},fe=(e,t,r,a=[])=>{let n=e[O],s=[];t<0&&(t+=n.length);let l=n.ele,{children:i}=l,c=/\D/.test(r)?n.length:r,h=n.map(e=>e);for(;c>0;){let e=i[t];if(!e)break;s.push($e(e)),l.removeChild(e),c--}let d=i[t];if(a.length){let e=document.createDocumentFragment();a.forEach(t=>e.appendChild(R(t))),t>=0&&d?l.insertBefore(e,d):l.appendChild(e)}return ue(n,h),o(n,"splice",[t,r,...a]),s},pe=(e,t)=>{let r=e[O],{ele:a}=r,n=Array.from(a.children),s=document.createDocumentFragment();t.forEach(e=>{let t=n[e];t.xvele&&(t[be]=1),s.appendChild(t)}),a.appendChild(s),n.forEach(e=>e.xvele&&(e[be]=0))};Y(le,{push(...e){let t=document.createDocumentFragment();return e.forEach(e=>{let r=R(e);t.appendChild(r)}),this.ele.appendChild(t),o(this[O],"push",e),this.length},splice(e,t,...r){return fe(this,e,t,r)},unshift(...e){return fe(this,0,0,e),this.length},shift(){return fe(this,0,1)},pop(){return fe(this,this.length-1,1)},reverse(){let e=this.map(e=>e),t=Array.from(this.ele.children),r=t.length;pe(this,t.map((e,t)=>r-1-t)),ue(this,e),o(this[O],"reverse",[])},sort(e){let r=this.map(e=>e);if(s(e)){let r=Array.from(this.ele.children).map(e=>$e(e)),a=Array.from(r);r.sort(e),e=[];let n=t();r.forEach(t=>{let r=a.indexOf(t);a[r]=n,e.push(r)})}e instanceof Array&&pe(this,e),ue(this,r),o(this[O],"sort",[e])}});const ge=new Map,be=Symbol("runArray"),me=Symbol("renderend"),ye=Symbol("renderend_resove"),ve=(Symbol("renderend_reject"),t(),e=>(xe.lastIndex=0,xe.test(e.trim()))),xe=/(".*?"|'.*?'|\(|\)|\[|\]|\{|\}|\|\||\&\&|\?|\!|:| |\+|\-|\*|%|\,|\<|\>)/g,we=/(".*?"|'.*?'|\(|\)|\[|\]|\{|\}|\|\||\&\&|\?|\!|:| |\+|\-|\*|%|\,|[\<\>\=]?[=]?=|\<|\>)/,je=/(^\$event$|^\$args$|^debugger$|^console\.|^Number$|^String$|^Object$|^Array$|^parseInt$|^parseFloat$|^undefined$|^null$|^true$|^false$|^[\d])/,Ee=e=>{const r="$$"+t()+"_";let a=[],n=e.replace(/\? *[\w]+?:/g,e=>{let r="__"+t()+"__";return a.push({k:r,v:e}),r}).replace(/[\w]+? *:/g,e=>`${r}${e}`);return a.forEach(e=>{n=n.replace(e.k,e.v)}),n.split(xe).map(e=>e.includes(r)?e.replace(r,""):we.test(e)||!e.trim()||/^\./.test(e)||je.test(e)?e:`this.${e}`).join("")},Oe=e=>new Function("...args",`\n    const $event = args[0];\n    const $args = args;\n    args = undefined;\n\n    try{\n        ${(e=>{let t="",r=e.split(";").filter(e=>!!e);return r.length>1?r.forEach(e=>{t+="\n"+Ee(e)+";"}):t=`return ${Ee(r[0])}`,t})(e)}\n    }catch(e){\n    let errObj = {\n        expr:'${e.replace(/'/g,"\\'").replace(/"/g,'\\"')}',\n    }\n    this.ele.__xInfo && Object.assign(errObj,this.ele.__xInfo);\n    console.error(errObj,e);\n    }\n            `),ke=e=>{let t=document.createTextNode(""),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{textnode:t,par:r}},_e=(e,t,r={rmAttr:!0})=>{let a=z(e,t).map(e=>({ele:e})),n=/^\[(.+)\]$/.exec(t);if(a.length&&n){let e=n[1];a.forEach(t=>{let{ele:a}=t,n=a.getAttribute(e);r.rmAttr&&(a.removeAttribute(e),a.setAttribute(`rendered-${e}`,n)),t.attrVal=n})}return a};const De=({sroot:e,proxyEle:r,temps:a})=>{let n=new class{constructor(e){this.processObj=new Map,this.proxyEle=e}init(){let{processObj:e,proxyEle:t}=this;const r=t[ee];for(let[a,n]of e){let{calls:e,target:s}=n;if(s=s||t,r.has(a)){let r;s.watch(a,r=((t,r)=>{e.forEach(e=>e.change(r,t.trends))}),!0),t.on("clearxdata",e=>{s.unwatch(a,r)})}else{let r,n,l=Oe(a),i=1;s.watch(n=(t=>{let a=l.call(s);if(i)i=0;else if(a===r||a instanceof I&&a.string===r)return;let n=t?t.trends:void 0;e.forEach(e=>e.change(a,n)),r=a instanceof I?a.string:a}),!0),t.on("clearxdata",e=>{s.unwatch(n)}),s.on("updateIndex",n),s.on("reloadView",n)}}}add(e,t){let r=this.processObj,a=r.get(e.trim());a?a=a.calls:(a=[],r.set(e,{calls:a})),a.push({change:t})}}(r);const l=r[ee];let{templateId:i}=(e=>{let r=t();return _e(e,"*").forEach(e=>{let{ele:t}=e,a=Array.from(t.attributes),n=new Set,s={},l={};a.forEach(e=>{let{name:r,value:a}=e;if("$"===(r=q(r)))return t.setAttribute("x-target",a),void n.add(r);let i=/^@(.+)/.exec(r);if(i)return s[i[1]]=a,void n.add(r);let o=/^:(.+)/.exec(r);return o?(l[o[1]]=a,void n.add(r)):void 0});let i=JSON.stringify(s);"{}"!=i&&t.setAttribute("x-on",i);let o=JSON.stringify(l);"{}"!=o&&t.setAttribute("x-bind",o),n.forEach(e=>{t.removeAttribute(e)}),t.getAttribute("x-model")&&t.setAttribute("x-model-id",r)}),{templateId:r}})(e);_e(e,"[x-if]").forEach(e=>{let t,{ele:r,attrVal:a}=e,{textnode:s,par:l}=ke(r);n.add(a,e=>{!e&&t?l.removeChild(t):e&&(t=r.cloneNode(!0),l.insertBefore(t,s))})});let o=_e(e,"[x-fill]");o.length&&o.forEach(e=>{let{ele:t,attrVal:a}=e,s=a.match(/(.+?) +use +(.+)/);if(!s)return void console.error({expr:a,desc:"fill expression error"});let[,l,i]=s,o=$e(t);const c=e=>{let t;o.html="",e.forEach(e=>{/^[a-z]+\-[a-z]+$/.test(i)&&(t=Ce({tag:i}),o.ele.appendChild(t.ele),Object.assign(t,e.object))})};n.add(l,(e,t)=>{t&&t.length?t.forEach(t=>{if("setData"==t.name&&0==t.keys.length&&t.args[0]==l)return void c(e);let r=JSON.parse(JSON.stringify(t));r.keys.shift(),o.entrend(r)}):c(e)}),o.watch(e=>{e.trends.forEach(e=>{r[l].entrend(e)})})}),_e(e,"[x-target]").forEach(e=>{let{ele:t,attrVal:a}=e;Object.defineProperty(r,"$"+a,{get:()=>$e(t)})}),_e(e,"[x-show]").forEach(e=>{let{ele:t,attrVal:r}=e;n.add(r,e=>{t.style.display=e?"":"none"})}),_e(e,"x-span").forEach(e=>{let{ele:t}=e,{textnode:r,par:a}=ke(t),s=t.getAttribute("xvkey");n.add(s,e=>{e=e instanceof I?e.string:String(e),r.textContent=e})}),_e(e,"[x-on]").forEach(t=>{let{ele:a,attrVal:n}=t,l=JSON.parse(n),i=Se(a);Object.keys(l).forEach(t=>{let a,[n,...o]=t.split("."),c=l[t];a=ve(c)?Oe(c):r[c];let h="on";o.includes("once")&&(h="one");let d=s(a);d||console.warn({target:e,eventName:n,desc:"no binding functions"}),i[h](n,(e,t)=>{o.includes("prevent")&&e.preventDefault(),o.includes("stop")&&(e.bubble=!1),d&&a.call(r,e,t)})})}),_e(e,"[x-bind]").forEach(e=>{let{ele:t,attrVal:a}=e,s=JSON.parse(a);Object.keys(s).forEach(e=>{let a=s[e],i=/^#(.+)/.exec(e);if(i){if(e=i[1],i=!!i,ve(a))throw{desc:"Function expressions cannot be used for sync binding"};l.has(a)||console.error({desc:"the key can't sync bind",key:"attrName",target:t,host:r}),Se(t).watch(e,(e,t)=>{r.setData(a,t)})}n.add(a,r=>{r instanceof se&&(r=r.object),t.xvele?Se(t).setData(e,r):void 0===r||null===r?t.removeAttribute(e):t.setAttribute(e,r)})})});let c=new Set;_e(e,"[x-model]").forEach(a=>{let{ele:n,attrVal:s}=a;if(c.has(n))return;let l=s;switch(n.tagName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":let a=_e(e,`input[type="checkbox"][rendered-x-model="${l}"][x-model-id="${i}"]`);return void(a.length>1?(a.forEach(e=>{e.ele.addEventListener("change",e=>{let{value:t,checked:a}=e.target,n=r.getData(l);a?n.add(t):n.delete(t)})}),a.forEach(e=>{c.add(e)})):(r.watch(l,(e,t)=>{n.checked=t},!0),n.addEventListener("change",e=>{let{checked:t}=n;r.setData(l,t)})));case"radio":let s=_e(e,`input[type="radio"][rendered-x-model="${l}"][x-model-id="${i}"]`),o=t();return void s.forEach(e=>{let t=e.ele;t.setAttribute("name",`radio_${l}_${o}`),t.addEventListener("change",e=>{t.checked&&r.setData(l,t.value)})})}case"textarea":case"text":r.watch(l,(e,t)=>{n.value=t},!0),n.addEventListener("input",e=>{r.setData(l,n.value)});break;case"select":r.watch(l,(e,t)=>{n.value=t},!0),n.addEventListener("change",e=>{r.setData(l,n.value)});break;default:if(n.xvele){let e=n.__xhear__;e.watch("value",(e,t)=>{r.setData(l,t)},!0),r.watch(l,(t,r)=>{e.setData("value",r)})}else console.warn("can't x-model with thie element => ",n)}}),c.clear(),c=null,n.init()},Ae=(e,t)=>{let r=Se(e),a=[];t.proto&&Y(r,t.proto);let s,{temp:l}=t,o=Object.assign({},t.data),c=Object.keys(o);c.push(...t.attrs),c.push(...Object.keys(t.watch)),(c=new Set(c)).forEach(e=>{/^_.+/.test(e)&&c.delete(e)});let h=r[ee];if(h?c.forEach(e=>h.add(e)):Object.defineProperty(r,ee,{value:c}),c.has("value")&&Object.defineProperty(e,"value",{get:()=>r.value,set(e){r.value=e}}),r.watch(t.watch),t.attrs.forEach(t=>{r.watch(t,r=>{null===r.val||void 0===r.val?e.removeAttribute(Z(t)):e.setAttribute(Z(t),r.val)})}),Object.keys(o).forEach(e=>{let t=o[e];n(t)||r.setData(e,t)}),l){s=e.attachShadow({mode:"open"});var d=(l=l.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);d&&d.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(l=l.replace(e,`<x-span xvkey="${t[1].trim()}"></x-span>`))});let t=document.createElement("template");t.innerHTML=l,Array.from(t.content.querySelectorAll("[x-if]")).forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),s.innerHTML=t.innerHTML,i(()=>{De({sroot:s,proxyEle:r[E]})})}if(s){let t=z(s,"link");t.length&&t.forEach(t=>{a.push(new Promise((r,a)=>{t.sheet?r():(t.addEventListener("load",e=>{r()}),t.addEventListener("error",t=>{a({desc:"link load error",error:t,target:e})}))}))})}let u=()=>{i(()=>e.setAttribute("x-ele",1),e.xvid),r[ye](),r.trigger("renderend",{bubbles:!1}),u=null};a.length?Promise.all(a).then(()=>{u()}):u()},Se=e=>e.__xhear__||new se(e),$e=e=>Se(e)[E];let Ce=e=>{if(e instanceof se)return e;let t;return(t="string"!==a(e)||/\<.+\>/.test(e)?R(e):document.querySelector(e))?$e(t):null};Object.assign(Ce,{register:e=>{let r={tag:"",temp:"",attrs:[],data:{},watch:{}};Object.assign(r,e);let n=r.attrs,s=a(n);if("object"==s){let e=Object.keys(n);e.forEach(e=>{r.data[q(e)]=n[e]}),n=r.attrs=e.map(e=>q(e))}else"array"==s&&(n=r.attrs=n.map(e=>q(e)));r.data=l(r.data),r.watch=Object.assign({},r.watch);let o=r.tag=Z(r.tag);const c=class extends se{constructor(...e){super(...e),this[me]=new Promise((e,t)=>{this[ye]=e})}get finish(){return this[me]}};r.proto&&Y(c.prototype,r.proto);let h=document.currentScript&&document.currentScript.src;const d=class extends HTMLElement{constructor(){super(),this.__xInfo={scriptSrc:h},delete this.__xhear__;let e=new c(this);Object.defineProperty(this,"xvele",{value:!0}),Object.defineProperty(e,"xvele",{value:!0});let a=this.xvid="xv"+t(),n=Object.assign({},r);this.parentElement?this.setAttribute("x-ele",""):i(()=>this.setAttribute("x-ele",""),a),Ae(this,n),n.ready&&n.ready.call(e[E]),n.slotchange&&e.$shadow.on("slotchange",t=>n.slotchange.call(e[E],t)),Object.defineProperties(this,{[be]:{writable:!0,value:0}})}connectedCallback(){this[be]||r.attached&&r.attached.call($e(this))}disconnectedCallback(){if(this[be])return;let e=$e(this);r.detached&&r.detached.call(e),e.deepClear()}attributeChangedCallback(e,t,r){let a=this.__xhear__;r!=a[e=q(e)]&&a.setData(e,r)}static get observedAttributes(){return n.map(e=>Z(e))}};Object.assign(r,{XhearElement:d}),ge.set(r.tag,r),customElements.define(o,d)},nextTick:i,xdata:e=>f(e)[E],v:5004e3,version:"5.4.0",fn:le,isXhear:e=>e instanceof se,ext:e=>{e({renderComponent:Ae})},all:e=>z(document,e).map(e=>$e(e))}),e.$=Ce})(window);