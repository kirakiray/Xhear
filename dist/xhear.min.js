/*!
* xhear v6.0.0
* https://github.com/kirakiray/Xhear#readme
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);var r=Object.prototype.toString,s=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const n=e=>s(e).search("function")>-1;var a=e=>!Object.keys(e).length;const i=Object.defineProperties,o=Object.getOwnPropertyDescriptor,l=e=>e instanceof y,c=null!==document.currentScript.getAttribute("debug"),h=(()=>{if(c){let e=new Map;return(r,s)=>{s||(s=t());let n=e.get(s);clearTimeout(n),e.set(s,setTimeout(()=>{r(),e.delete(s)}))}}let e=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(n,a)=>{a||(a=t()),e.set(a,{key:a,fun:n}),s||(s=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),s=!1}))}})(),d=(e,t)=>{let r,s=[];const n=a=>{s.push(Object.assign({},a)),t?(clearTimeout(r),r=setTimeout(()=>{e(s),s.length=0},t)):h(()=>{e(s),s.length=0},n)};return n},u=(e,t,r={})=>{Object.keys(t).forEach(s=>{let{get:n,set:a,value:i}=o(t,s);i?e.hasOwnProperty(s)?e[s]=i:Object.defineProperty(e,s,{...r,value:i}):Object.defineProperty(e,s,{...r,get:n,set:a})})},p=(Date.now(),Symbol("self")),m=Symbol("proxy"),f=Symbol("watchs"),g=Symbol("can_update"),b=new Set(["root","sub","revoke"]),x=(e,t,r,s)=>{if(r&&r.includes(e[m]))return;let n;n=t.path=r?[e[m],...r]:[e[m]],e[f].forEach(e=>e(t)),s||e._unupdate||e.owner&&e.owner.forEach(e=>x(e,t,n.slice()))};class y{constructor(e,r){let s;e.get?(s=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:v.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):s=new Proxy(this,v);let n=r;i(this,{[p]:{value:this},[m]:{value:s},xid:{value:"x_"+t()},_xtatus:{get:()=>n,set(e){if(!b.has(e))throw{target:s,desc:`xtatus not allowed to be set ${e}`};const t=this.owner.size;if("revoke"===e&&t)throw{target:s,desc:"the owner is not empty"};if("revoke"===n&&"revoke"!==e)t||_(this);else if("sub"===n&&"root"===e)throw{target:s,desc:"cannot modify sub to root"};n=e}},owner:{configurable:!0,writable:!0,value:new Set},length:{configurable:!0,writable:!0,value:0},[f]:{value:new Map},[g]:{writable:!0,value:0}});let a=-1;return Object.keys(e).forEach(t=>{let r=o(e,t),{value:n,get:l,set:c}=r;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>a&&(a=t),l||c?i(this,{[t]:r}):s[t]=n)}),a>-1&&(this.length=a+1),this[g]=1,s}watch(e){const r="e_"+t();return this[f].set(r,e),r}unwatch(e){return this[f].delete(e)}setData(e,t){let r,n=s(t);"array"!=n&&"object"!=n||(t=E(t,"sub")).owner.add(this);const a=Object.getOwnPropertyDescriptor(this,e),i=this[m];try{r=i[e]}catch(e){}if(r===t)return!0;let o;return a&&a.set?(a.set.call(i,t),o=!0):o=Reflect.set(this,e,t),this[g]&&x(this,{xid:this.xid,name:"setData",args:[e,t]}),w(r,this),o}update(e={}){x(this,Object.assign({},e,{xid:this.xid,isCustom:!0}))}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[p];let r=t[e];w(r,t);let s=Reflect.deleteProperty(t,e);return x(this,{xid:this.xid,name:"delete",args:[e]}),s}}const v={set(e,t,r,s){if("symbol"==typeof t)return Reflect.set(e,t,r,s);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,s):i(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return e.setData(t,r)}catch(e){throw{desc:`failed to set ${t}`,key:t,value:r,target:s}}},deleteProperty:function(e,t){return e.delete(t)}},w=(e,t)=>{if(!l(e))return;const{owner:r}=e;r.delete(t),r.size||(e._xtatus="revoke",Object.values(e).forEach(t=>{w(t,e[p])}))},_=e=>{"revoke"===e._xtatus&&Object.values(e).forEach(t=>{l(t)&&(_(t),t.owner.add(e),t._xtatus="sub")})},E=(e,t="root")=>l(e)?(e._xtatus=t,e):new y(e,t);u(y.prototype,{seek(e){let t=[];if(!n(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{l(r)&&t.push(...r.seek(e))}),t},watchTick(e,t){return this.watch(d(e,t))},watchUntil(e){let t=n(e);if(!t&&/[^=><]=[^=]/.test(e))throw"cannot use single =";return new Promise(r=>{let s,n=t?e.bind(this):new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const a=this.watchTick(s=(()=>{let e=n();e&&(this.unwatch(a),r(e))}));s()})},watchKey(e,t){t&&Object.keys(e).forEach(t=>e[t].call(this,this[t]));let r={};return Object.keys(e).forEach(e=>{r[e]=this[e]}),this.watch(d(t=>{Object.keys(e).forEach(s=>{let n=this[s],a=r[s];if(a!==n)e[s].call(this,n,{old:a});else if(l(n)){t.some(e=>{return e.path[1]==n})&&e[s].call(this,n,{old:a})}r[s]=n})}))},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(s=>{let n=this[s];/\D/.test(s)?t=!1:(s=parseInt(s))>r&&(r=s),l(n)&&(n=n.toJSON()),e[s]=n}),t&&(e.length=r+1,e=Array.from(e));const s=this.xid;return i(e,{xid:{get:()=>s}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&i(y.prototype,{[e]:{value:t}})});const k=Array.prototype.splice;u(y.prototype,{splice(e,t,...r){let n=this[p];r=r.map(e=>{let t=s(e);return"array"!=t&&"object"!=t||(e=E(e,"sub")).owner.add(n),e});let a="number"==s(t)?t:this.length-e,i=k.call(n,e,a,...r);return i.forEach(e=>w(e,n)),x(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),i},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&i(y.prototype,{[e]:{value(...r){let s=t.apply(this[p],r);return x(this,{xid:this.xid,name:e}),s}}})});const O=e=>e?e.__xEle__?e.__xEle__:e.__xEle__=new H(e):null,A=document.createElement("template"),j=(e,t)=>!!e.tagName&&(e===t||e!==document&&(A.innerHTML=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`,!!A.content.querySelector(t))),S=e=>{const t=document.createElement("div");return t.innerHTML=e,Array.from(t.children).map(function(e){return t.removeChild(e),e})},C=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot);const r=O(t);r[M].forEach(t=>{e[t]&&(r[t]=e[t])});let s=0;for(;s in e;){let r=C(e[s]);t.appendChild(r),s++}return t},T=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),$=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),N={get:(e,t,r)=>"string"!=typeof t||/\D/.test(t)?Reflect.get(e,t,r):O(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},L=Symbol("events"),D=y.prototype.setData,P=["text","html","show","style"],M=Symbol("cansetkeys");class H extends y{constructor(e){super(Object.assign({},N));const t=this[p];t.tag=e.tagName?e.tagName.toLowerCase():"",i(t,{owner:{get(){let t=e.parentNode;return t?[O(t)]:[]}}}),i(t,{ele:{get:()=>e},[L]:{writable:!0,value:""}}),delete t.length,"input"!=t.tag&&"textarea"!=t.tag&&"select"!=t.tag||J(t)}setData(e,t){if(!this[M]||this[M].has(e))return D.call(this,e,t)}get root(){return O(this.ele.getRootNode())}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?O(t):null}get shadow(){return O(this.ele.shadowRoot)}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?O(e):null}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get length(){return this.ele.children.length}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get style(){return this.ele.style}set style(e){if("string"==s(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),n=Object.keys(e);r.forEach(e=>{n.includes(e)||(t[e]="")}),Object.assign(t,e)}get show(){return"none"!==this.ele.style.display}set show(e){this.ele.style.display=e?"":"none"}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get next(){const e=this.ele.nextElementSibling;return e?O(e):null}get prev(){const e=this.ele.previousElementSibling;return e?O(e):null}$(e){const t=this.ele.querySelector(e);return t?O(t):null}all(e){return Array.from(this.ele.querySelectorAll(e)).map(e=>O(e))}is(e){return j(this.ele,e)}attr(...e){let[t,r]=e,{ele:s}=this;if(1==e.length)return t instanceof Object&&Object.keys(t).forEach(e=>{s.setAttribute(e,t[e])}),s.getAttribute(t);null===r?s.removeAttribute(t):s.setAttribute(t,r)}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(j(t,e))return!0})),t.map(e=>O(e))}parents(e,t){let r=[],n=this.parent;if(e){if("string"==s(e))for(;n&&n;)j(n.ele,e)&&r.push(n),n=n.parent}else for(;n;)r.push(n),n=n.parent;if(t)if(t instanceof H){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==s(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}clone(){let e=O(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}remove(){const{parent:e}=this;e.splice(e.indexOf(this),1)}extend(e){const t=Object.getOwnPropertyDescriptors(e);Object.entries(t).forEach(([e,t])=>{t.set&&this[M].add(e)}),u(this,e,{configurable:!0})}initSizeObs(e=300){if(this._initedSizeObs)return void console.warn({target:this.ele,desc:"initRect is runned"});this._initedSizeObs=1;const t=()=>{clearTimeout(void 0),setTimeout(()=>{x(this,{xid:this.xid,name:"sizeUpdate"},void 0,!1)},e)};if(t(),window.ResizeObserver){const e=new ResizeObserver(e=>{t()});return e.observe(this.ele),()=>{e.disconnect()}}{let e;return window.addEventListener("resize",e=(e=>{t()})),()=>{window.removeEventListener("resize",e)}}}}i(H.prototype,{[M]:{value:new Set(P)}});const J=e=>{let t=e.attr("type")||"text";const{ele:r}=e;let s={type:{enumerable:!0,get:()=>t},name:{enumerable:!0,get:()=>r.name},value:{enumerable:!0,get:()=>r.hasOwnProperty("__value")?r.__value:r.value,set(t){r.value=r.__value=t,x(e,{xid:e.xid,name:"setData",args:["value",t]})}},disabled:{enumerable:!0,get:()=>r.disabled,set(e){r.disabled=e}},msg:{writable:!0,value:null},[M]:{value:new Set(["value","disabled","msg",...P])}};switch(t){case"radio":case"checkbox":Object.assign(s,{checked:{enumerable:!0,get:()=>r.checked,set(e){r.checked=e}},name:{enumerable:!0,get:()=>r.name}}),delete s.msg,e.on("change",t=>{x(e,{xid:e.xid,name:"setData",args:["checked",r.checked]})}),s[M].value.add("checked");break;case"file":Object.assign(s,{accept:{enumerable:!0,get:()=>r.accept}});break;case"text":default:e.on("input",t=>{delete r.__value,x(e,{xid:e.xid,name:"setData",args:["value",r.value]})})}i(e,s)};const R=(e,t)=>{const r={};return e.forEach(e=>{const{name:s,type:n,value:a}=e;switch(n){case"radio":e.checked&&(r[s]=a);break;case"checkbox":let i=r[s]||(r[s]=t[s])||(r[s]=[]);e.checked?i.includes(e.value)||i.push(a):i.includes(e.value)&&i.splice(i.indexOf(e.value),1);break;case"text":default:r[s]=a}}),r},I=e=>{e.forEach(e=>{const t=new CustomEvent("verify",{bubbles:!1});t.msg="",t.formData=this,t.$target=e,e.trigger(t);const{msg:r}=t,n=s(r);"string"==n?e.msg=r||null:"error"==n?"error"===s(e.msg)&&e.msg.message===r.message||(e.msg=r):console.warn({target:e,msg:r,desc:"msg can only be Error or String"})})};u(H.prototype,{form(e){const t={selector:"input,textarea,select",delay:100};return"string"===s(e)?t.selector=e:Object.assign(t,e),new class extends y{constructor(e,{selector:t,delay:r,_target:s}){super(e,"root"),this._selector=t,this._target=s,this._delay=r;let n,a,i=0,o=()=>{const e=this.formEles,t=R(e,this),r=Object.keys(t);Object.keys(this).filter(e=>!r.includes(e)).forEach(e=>{delete this[e]}),Object.assign(this,t),n=this.toJSON(),i&&I(e)};this._wid=s.watch(()=>{clearTimeout(a),a=setTimeout(()=>{o()},this._delay)}),o(),i=1,this.watchTick(e=>{let t=this.toJSON();Object.entries(t).forEach(([e,t])=>{let r=n[e];(t!==r||"object"==typeof t&&"object"==typeof r&&JSON.stringify(t)!==JSON.stringify(r))&&this.getTarget(e).forEach(e=>{switch(e.type){case"checkbox":t.includes(e.value)?e.checked=!0:e.checked=!1;break;case"radio":e.value==t?e.checked=!0:e.checked=!1;break;case"text":default:e.value=t}})}),n=t})}get formEles(){return this._target.all(this._selector)}getTarget(e){return this.formEles.filter(t=>t.name===e)}}({},{selector:t.selector,delay:t.delay,_target:this})}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{const t=Array.prototype[e];t&&Object.defineProperty(H.prototype,e,{value(...e){return t.apply(Array.from(this.ele.children).map(O),e)}})}),u(H.prototype,{splice(e,t,...r){const{ele:n}=this,a=Array.from(n.children),i=[];let o=e,l="number"==s(t)?t:this.length-e,c=a[o];for(;c&&l>0;)i.push(c),n.removeChild(c),l--,c=a[++o];if(r.length){let t=document.createDocumentFragment();r.forEach(e=>{if(e instanceof Element)return void t.appendChild(e);if(e instanceof H)return void t.appendChild(e.ele);let r=s(e);"string"==r?S(e).forEach(e=>{t.appendChild(e)}):"object"==r&&t.appendChild(C(e))}),e>=this.length?n.appendChild(t):n.insertBefore(t,n.children[e])}return x(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),i},sort(e){const t=this.ele,r=Array.from(t.children).map(O).sort(e);return q(t,r),x(this,{xid:this.xid,name:"sort"}),this},reverse(){const e=this.ele,t=Array.from(e.children).reverse();return q(e,t),x(this,{xid:this.xid,name:"reverse"}),this}});const q=(e,t)=>{const{children:r}=e;t.forEach((t,s)=>{let n=t.ele||t;const a=r[s];a?n!==a&&e.insertBefore(n,a):e.appendChild(n)})},z=e=>e[L]?e[L]:e[L]=new Map,F=e.MouseEvent||Event,U=e.TouchEvent||Event,K=new Map([["click",F],["mousedown",F],["mouseup",F],["mousemove",F],["mouseenter",F],["mouseleave",F],["touchstart",U],["touchend",U],["touchmove",U]]),B=(e,t,r,s=!0)=>{let n=K.get(t)||CustomEvent;const a=t instanceof Event?t:new n(t,{bubbles:s,cancelable:!0});return a.data=r,e.ele.dispatchEvent(a)};u(H.prototype,{on(e,r,s){if(n(r))s=r,r=void 0;else{const e=s,{ele:t}=this;s=(s=>{let n;s.path?n=s.path:(n=O(s.target).parents(null,t).map(e=>e.ele)).unshift(s.target),n.some(n=>{if(n==t)return!0;O(n).is(r)&&(s.selector=n,e(s),delete s.selector)})})}this.ele.addEventListener(e,s);const a="e_"+t();return z(this).set(a,{name:e,selector:r,callback:s}),a},off(e){let t=z(this).get(e);return!!t&&(this.ele.removeEventListener(t.name,t.callback),this[L].delete(e),!0)},one(e,t,r){let s,n;return"string"==typeof t?(n=r,r=(e=>{n(e),this.off(s)})):(n=t,t=(e=>{n(e),this.off(s)})),s=this.on(e,t,r)},trigger(e,t){return B(this,e,t)},triggerHandler(e,t){return B(this,e,t,!1)}}),["click","focus","blur"].forEach(e=>{u(H.prototype,{[e](t){if(!n(t))return this.trigger(e,t);this.on(e,t)}})});const W={},Z={},G=Symbol("runned_revoke"),Q=e=>{const{attrs:t,data:r,watch:s,proto:n}=e,a=[...Object.keys(t),...Object.keys(r),...Object.keys(s)],i=Object.getOwnPropertyDescriptors(n);return Object.keys(i).forEach(e=>{let{set:t}=i[e];t&&a.push(e)}),a},V=(e,t)=>{var r=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);r&&r.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<x-span prop="${encodeURI(r[1])}"></x-span>`))});const s=document.createElement("template");s.innerHTML=e;let n=[],a=[];Array.from(s.content.querySelectorAll("*")).forEach(e=>{const t={},r=[];Array.from(e.attributes).forEach(s=>{let i,o,{name:l,value:c}=s,h=/^temp:(.+)/.exec(l);if(h){let[,t]=h,r=document.createElement("template");return r.setAttribute("name",t),e.removeAttribute(l),r.innerHTML=e.outerHTML,n.push(r),a.push(e),!0}if(/^#/.test(l))i="cmd",o=l.replace(/^#/,"");else if(/^@/.test(l))i="on",o=l.replace(/^@/,"");else if(l.includes(":")){let t=l.split(":");if(2!=t.length)throw{desc:"template binding mark error",target:e,expr:l};i=t[0],o=t[1],""===i&&(i="prop")}if(i){let e=t[i]||(t[i]={});"on"==i?e[o]={name:c}:o&&(e[o]=c),r.push(l)}}),r.length&&(Object.keys(t).forEach(r=>{let s=t[r];"cmd"==r?Object.keys(s).forEach(t=>{e.setAttribute(`x-cmd-${t}`,s[t])}):e.setAttribute(`x-${r}`,JSON.stringify(s))}),r.forEach(t=>e.removeAttribute(t)))}),n.length&&(n.forEach(e=>{s.content.appendChild(e)}),a.forEach(e=>{s.content.removeChild(e)})),Array.from(s.content.querySelectorAll("template")).forEach(e=>{e.innerHTML=V(e.innerHTML).html}),X(s);let i=new Map;if(Array.from(s.content.querySelectorAll("template[name]")).forEach(e=>{i.set(e.getAttribute("name"),{ele:e,code:e.content.children[0].outerHTML}),e.parentNode.removeChild(e)}),i.size)for(let[e,r]of i.entries()){const{children:s}=r.ele.content;if(1!==s.length)throw{name:e,html:r.code,tag:t,desc:"register error, only one element must exist in the template"};if(s[0].getAttribute("x-cmd-if"))throw{name:e,html:r.code,tag:t,desc:"register error, cannot use if on template first element"}}return{temps:i,html:s.innerHTML}},X=e=>{e.content.querySelectorAll("[x-cmd-if],[x-cmd-else-if],[x-cmd-else],[x-cmd-await],[x-cmd-then],[x-cmd-catch]").forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");["x-cmd-if","x-cmd-else-if","x-cmd-else","x-cmd-await","x-cmd-then","x-cmd-catch"].forEach(r=>{let s=e.getAttribute(r);null!==s&&(t.setAttribute(r,s),e.removeAttribute(r))}),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(e.content.querySelectorAll("template")).forEach(X)},Y=(e,t)=>{let r=Array.from(e.querySelectorAll(t));return e instanceof Element&&j(e,t)&&r.push(e),r},ee=e=>{let t=new Comment("x-marker"),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{marker:t,parent:r}},te=e=>new Function("...$args",`\nconst [$e,$target] = $args;\n\ntry{\n    with(this){\n        ${e};\n    }\n}catch(e){\n    throw {\n        message:e.message || "run error",\n        expr:\`${e.replace(/`/g,"\\`")}\`,\n        target:this,\n        error:e\n    };\n}`),re=(e,t,r)=>{e.removeAttribute(t);let s=e.__renderData;s||(s=e.__renderData={},e.setAttribute("x-rendered","")),s[t]=r},se=(e,t,r)=>{let s=e.watchTick(t);r.push({eid:s,target:e})},ne=(e,t)=>{let r;return r=le.test(e)?te("return "+e).bind(t):()=>t[e]},ae=({xdata:e,host:t,expr:r,watchFun:s})=>{const n=[];return e instanceof H?se(e,s,n):r.includes("$host")?(r.includes("$index")&&se(e,s,n),se(t,s,n)):r.includes("$index")||r.includes("$item")?(se(e,s,n),l(e.$data)&&se(e.$data,s,n)):r.includes("$data")&&l(e.$data)&&se(e.$data,s,n),n},ie=({xdata:e,host:t,expr:r,callback:s,isArray:n})=>{let a,i,o,c=ne(r,e);const h=e=>{const t=c();if(l(t))if(n){let r=t.map(e=>e&&e.xid?e.xid:e).join(",");i!==r&&(s({val:t,modifys:e}),i=r)}else{let r=t.toJSON();a===t&&r===o||(s({val:t,modifys:e}),o=r)}else a!==t&&(s({val:t,modifys:e}),o=null);a=t};return h(),ae({xdata:e,host:t,expr:r,watchFun:h})},oe=(e,t)=>{(e.__bindings||(e.__bindings=[])).push(...t)},le=/[\(\)\;\.\=\>\<\|\!\?]/,ce=(e,t)=>{Array.from(e.childNodes).forEach(e=>{t(e),e instanceof Element&&ce(e,t)})},he=e=>{ce(e,e=>{e.isCustom&&O(e).revoke(),e.__bindings&&e.__bindings.forEach(e=>{let{target:t,eid:r}=e;t.unwatch(r)})})},de=({temp:e,temps:t,marker:r,parent:s,host:n,xdata:a})=>{let i=S(e.innerHTML);return i.forEach(e=>{s.insertBefore(e,r),pe({host:n,xdata:a,content:e,temps:t})}),i},ue=e=>{e.forEach(e=>{he(e),e.parentNode.removeChild(e)})},pe=({host:e,xdata:t,content:r,temps:s})=>{Y(r,"[x-on]").forEach(e=>{let r=JSON.parse(e.getAttribute("x-on")),s=[];const a=O(e);Object.keys(r).forEach(e=>{let i,{name:o}=r[e];if(le.test(o)){const r=te(o);i=a.on(e,e=>{r.call(t,e,a)})}else i=a.on(e,e=>{const r=t[o];r?n(r)?r.call(t,e):console.error({target:t,name:o,value:r,desc:"bind value is not function"}):console.error({target:t,name:o,desc:"no binding function"})});s.push(i)}),re(e,"x-on",r)}),Y(r,"[x-attr]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-attr"));re(r,"x-attr",s),Object.keys(s).forEach(n=>{const a=ie({xdata:t,host:e,expr:s[n],callback:({val:e})=>{null===e||void 0===e?r.removeAttribute(n):r.setAttribute(n,e)}});oe(r,a)})}),Y(r,"[x-class]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-class"));re(r,"x-class",s),Object.keys(s).forEach(n=>{const a=ie({xdata:t,host:e,expr:s[n],callback:({val:e})=>{e?r.classList.add(n):r.classList.remove(n)}});oe(r,a)})}),Y(r,"[x-prop]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-prop")),n=O(r);re(r,"x-prop",s),Object.keys(s).forEach(a=>{const i=ie({xdata:t,host:e,expr:s[a],callback:({val:e})=>{n[a]=e}});oe(r,i)})}),Y(r,"[x-sync]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-sync")),n=O(r);Object.keys(s).forEach(a=>{let i=s[a];if(le.test(i))throw{desc:"sync only accepts attribute names"};const o=ie({xdata:t,host:e,expr:i,callback:({val:e})=>{n[a]=e}}),l=ie({xdata:n,host:e,expr:a,callback:({val:e})=>{t[i]=e}});oe(r,[...o,...l])})}),Y(r,"x-span").forEach(r=>{let s=decodeURI(r.getAttribute("prop")),{marker:n,parent:a}=ee(r);const i=document.createTextNode("");a.replaceChild(i,n);const o=ie({xdata:t,host:e,expr:s,callback:({val:e})=>{i.textContent=e}});oe(i,o)}),Y(r,"[x-cmd-if]").forEach(r=>{const n=[r];let{nextElementSibling:a}=r;for(;a&&(a.hasAttribute("x-cmd-else-if")||a.hasAttribute("x-cmd-else"));)a.parentNode.removeChild(a),n.push(a),a=r.nextElementSibling;let i="";const o=n.map((e,r)=>{let s;const n=e.getAttribute("x-cmd-else-if")||e.getAttribute("x-cmd-if");return n&&(s=ne(n,t),i+=`${0==r?"if":"else-if"}(${n})...`),{callback:s,tempEle:e}});let{marker:l,parent:c}=ee(r),h=null,d=-1;const u=r=>{let n,a,i=-1;o.some((e,t)=>{if(e.callback){if(a=!!e.callback())return n=e.tempEle,i=t,!0}else n=e.tempEle,i=t}),d!==i&&(h&&(he(h),h.parentNode.removeChild(h),h=null),n&&(h=S(n.content.children[0].outerHTML)[0],c.insertBefore(h,l),pe({host:e,xdata:t,content:h,temps:s}))),d=i};u(),oe(l,ae({xdata:t,host:e,expr:i,watchFun:u}))}),Y(r,"[x-cmd-await]").forEach(r=>{let n,a,i=r,{nextElementSibling:o}=r;for(;o&&(o.hasAttribute("x-cmd-then")||o.hasAttribute("x-cmd-catch"));)o.hasAttribute("x-cmd-then")?n=o:o.hasAttribute("x-cmd-catch")&&(a=o),o.parentNode.removeChild(o),o=r.nextElementSibling;let l,c,{marker:h,parent:d}=ee(r),u=r.getAttribute("x-cmd-await");const p=ie({xdata:t,host:e,expr:u,callback:({val:r})=>{c&&(ue(c),c=null),c=de({temp:i,temps:s,marker:h,parent:d,host:e,xdata:t}),l=r,r.then(t=>{l===r&&(ue(c),c=null,n&&(c=de({temp:n,temps:s,marker:h,parent:d,host:e,xdata:{[n.getAttribute("x-cmd-then")]:t}})))}).catch(t=>{l===r&&(ue(c),c=null,a&&(c=de({temp:a,temps:s,marker:h,parent:d,host:e,xdata:{[a.getAttribute("x-cmd-catch")]:t}})))})}});oe(h,p)}),Y(r,"[x-fill]").forEach(r=>{const n=JSON.parse(r.getAttribute("x-fill"));let a=r.getAttribute("x-item");a&&(a=JSON.parse(a));const i=r;O(i)._unupdate=1;let o,[l,c]=Object.entries(n)[0];re(r,"x-fill",n),re(r,"x-item",a);const h=ie({xdata:t,host:e,expr:c,isArray:1,callback:r=>{const n=r.val;let c=s.get(l);if(!c)throw{target:e.ele,desc:"this template was not found",name:l};if(o){const r=Array.from(i.children),o=r.map(e=>e.__fill_item.$data),l=Symbol("holder"),h=[];n.forEach((n,i)=>{let d=o.indexOf(n);if(-1===d){let r=fe({host:e,data:n,index:i,tempData:c,temps:s});a&&me(r,a,t,e),h.push(r.ele)}else{let e=r[d];e.__fill_item.$index=i,h.push(e),o[d]=l}});const d=[];o.forEach((e,t)=>{if(e!==l){let e=r[t];d.push(e),i.removeChild(e)}}),d.forEach(e=>he(e)),q(i,h)}else n.forEach((r,n)=>{const o=fe({host:e,data:r,index:n,tempData:c,temps:s});a&&me(o,a,t,e),i.appendChild(o.ele)}),o=n.xid}});oe(r,h)})},me=(e,t,r,s)=>{let n=e.$item;Object.keys(t).forEach(a=>{let i=t[a];const o=T(a);let l=ie({xdata:r,host:s,expr:i,callback:({val:e})=>{n[o]=e}});oe(e.ele,l)})},fe=({host:e,data:t,index:r,tempData:s,temps:n})=>{const a=O(S(s.code)[0]),o=E({get $host(){return e},$index:r,get $data(){return t},get $item(){return o}});return i(a,{$item:{get:()=>o},$data:{get:()=>t}}),a.ele.__fill_item=o,pe({host:e,xdata:o,content:a.ele,temps:n}),a};function ge(e){if(e instanceof Element)return O(e);const t=s(e);let r;return"string"==t?r=/\<.+\>/.test(e)?S(e)[0]:document.querySelector(e):"object"==t?r=C(e):(e===document||e instanceof DocumentFragment)&&(r=e),r?O(r):null}Object.assign(ge,{all:e=>Array.from(document.querySelectorAll(e)).map(e=>O(e)),register:e=>{const t={tag:"",temp:"",attrs:{},data:{},watch:{},proto:{}};let r;if(Object.assign(t,e),t.temp){const e=V(t.temp,t.tag);t.temp=e.html,r=e.temps}let s=T(e.tag);const n=class extends H{constructor(e){super(e),e.isCustom=!0}forceUpdate(){x(this,{xid:this.xid,name:"forceUpdate"})}revoke(){this[G]||(this[G]=1,Object.values(this).forEach(e=>{e instanceof H||!l(e)||w(e,this[p])}),he(this.shadow.ele))}};u(n.prototype,t.proto);const o=Q(t);i(n.prototype,{[M]:{writable:!0,value:new Set([...P,...o])}});customElements.define(t.tag,class extends HTMLElement{constructor(...e){super(...e);let s=this.__xEle__;s&&console.warn({target:s,desc:"please re-instantiate the object"}),this.__xEle__=new n(this),(async({xele:e,defs:t,temps:r,_this:s})=>{if(Object.assign(e,t.data,t.attrs),t.created&&t.created.call(e),t.temp){const n=s.attachShadow({mode:"open"});n.innerHTML=t.temp,pe({host:e,xdata:e,content:n,temps:r}),e.shadow&&e.shadow.watchTick(t=>{t.some(e=>e.path.length>1)&&x(e,{xid:e.xid,name:"forceUpdate"})},10);let a=n.querySelectorAll("link");a.length&&await Promise.all(Array.from(a).map(t=>new Promise((r,s)=>{if(t.sheet)r();else{let n,a;t.addEventListener("load",n=(e=>{t.removeEventListener("load",n),t.removeEventListener("error",a),r()})),t.addEventListener("error",a=(r=>{t.removeEventListener("load",n),t.removeEventListener("error",a),s({desc:"link load error",ele:t,target:e.ele})}))}})))}if(t.ready&&t.ready.call(e),!a(t.attrs)){const{ele:r}=e;Object.keys(t.attrs).forEach(t=>{r.hasAttribute(t)&&(e[t]=r.getAttribute(t))}),e.watchTick(r=>{s.__set_attr=1,Object.keys(t.attrs).forEach(t=>{let r=e[t];null===r||void 0===r?s.removeAttribute($(t)):s.setAttribute($(t),e[t])}),delete s.__set_attr})}let n=t.watch;a(n)||e.watchKey(n,!0)})({xele:O(this),defs:t,temps:r,_this:this}).then(e=>{this.__x_connected?this.setAttribute("x-render",1):this.x_render=1})}connectedCallback(){this.x_render&&this.setAttribute("x-render",this.x_render),this.__x_connected=!0,t.attached&&!this.__x_runned_connected&&h(()=>{this.__x_connected&&!this.__x_runned_connected&&(this.__x_runned_connected=!0,t.attached.call(O(this)))})}disconnectedCallback(){this.__x_connected=!1,t.detached&&!this.__x_runnded_disconnected&&h(()=>{this.__x_connected||this.__x_runnded_disconnected||(this.__x_runnded_disconnected=!0,t.detached.call(O(this)))})}attributeChangedCallback(e,t,r){this.__set_attr||(O(this)[T(e)]=r)}static get observedAttributes(){return Object.keys(t.attrs).map(e=>$(e))}}),Z[s]?(Z[s](n),delete Z[s]):W[s]=Promise.resolve(n)},xdata:e=>E(e),nextTick:h,fn:H.prototype,tag:e=>{if(e=T(e),W[e])return W[e];let t=new Promise(t=>{Z[e]=t});return W[e]=t,t}}),e.$=ge})(window);