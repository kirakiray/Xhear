//! xhear - v7.2.3 https://github.com/kirakiray/Xhear  (c) 2018-2023 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("stanz/src/public.mjs"),require("stanz/src/accessor.mjs"),require("stanz/src/watch.mjs"),require("stanz/src/base.mjs"),require("stanz/src/main.mjs")):"function"==typeof define&&define.amd?define(["stanz/src/public.mjs","stanz/src/accessor.mjs","stanz/src/watch.mjs","stanz/src/base.mjs","stanz/src/main.mjs"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).$=t(e.public_mjs,e.accessor_mjs,e.watchFn,e.stanz,e.Stanz)}(this,(function(e,t,r,n,s){"use strict";const a=t=>e.getType(t).includes("function"),i=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const o=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),c=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};function l(e,t,r){const n=e.indexOf(t);if(-1===n)throw new Error("Value not found in array");return e.splice(r,0,e.splice(n,1)[0]),e}const h=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},d={set:(e,r,n,s)=>/\D/.test(r)?t.handler.set(e,r,n,s):Reflect.set(e,r,n,s),get:(e,t,r,n)=>/\D/.test(String(t))?Reflect.get(e,t,r,n):F(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},u=e=>e.__revokes||(e.__revokes=[]),f=(e,t)=>u(e).push(t),p=(e,t)=>new Function("...$args",`\nconst [$event] = $args;\ntry{\n  with(this){\n    return ${e};\n  }\n}catch(error){\n  console.error(error);\n}\n`).bind(t);function g({data:e,target:t,template:r,temps:n,isRenderSelf:s,...i}){const o=r&&r.innerHTML;o&&(t.innerHTML=o);const l=t.querySelectorAll("xtext"),d=[],g=u(t);Array.from(l).forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=p(t.getAttribute("expr"),e),a=()=>{r.textContent=s()};d.push(a);const i=()=>{h(g,i),h(d,a),h(u(r),i)};g.push(i),f(r,i)}));const m=(_=t,y="[x-bind-data]",Array.from(_.querySelectorAll(y)));var _,y;if(s&&c(t,"[x-bind-data]")&&m.unshift(t),m.forEach((t=>{const r=JSON.parse(t.getAttribute("x-bind-data")),s=F(t);for(let[o,c]of Object.entries(r))c.forEach((r=>{try{const{always:c}=s[o],l=()=>s[o](...r,{isExpr:!0,data:e,temps:n,...i});let p;if(c)d.push(l),p=()=>{h(g,p),h(d,l),h(u(t),p)};else{const e=l();a(e)?p=()=>{h(g,p),h(u(t),p),e()}:console.warn(`${o} render method need return revoke`)}g.push(p),f(t,p)}catch(e){const t=new Error(`Execution of the ${o} method reports an error :\n ${e.stack}`);throw t.error=e,t}}));t.removeAttribute("x-bind-data")})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),d.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,d.forEach((e=>e()));const r=e.watchTick((t=>{d.length?d.forEach((e=>e())):e.unwatch(r)}))}}function m(e){let t={};const{tagName:r}=e;if("TEMPLATE"===r){let r=e.innerHTML;const n=r.match(/{{.+?}}/g);n&&(n.forEach((e=>{r=r.replace(e,`<xtext expr="${e.replace(/{{(.+?)}}/,"$1")}"></xtext>`)})),e.innerHTML=r);const s=e.getAttribute("name");s&&(e.content.children.length>1&&console.warn({target:e,content:e.innerHTML,desc:"Only the first child element inside the template will be used"}),t[s]=e,e.remove()),t={...t,...m(e.content)}}else if(r){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,a]=n;s||(s="prop");(t[s]||(t[s]=[])).push([a,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}return e.children&&Array.from(e.children).forEach((e=>{t={...t,...m(e)}})),t}const _=e=>a(e)?e():e,y={_convertExpr(e={},t){const{isExpr:r,data:n}=e;return r?p(t,n):t},prop(...e){let[t,r,n]=e;if(1===e.length)return this[t];r=this._convertExpr(n,r),r=_(r),t=i(t),this[t]=r},attr(...e){let[t,r,n]=e;if(1===e.length)return this.ele.getAttribute(t);r=this._convertExpr(n,r),r=_(r),this.ele.setAttribute(t,r)}};y.prop.always=!0,y.attr.always=!0;var b={sync(e,t,r){if(!r)throw"Sync is only allowed within the renderer";const{data:n}=r;this[e]=n[t];const s=this.watch((r=>{r.hasModified(e)&&(n[t]=this[e])})),a=n.watch((r=>{r.hasModified(t)&&(this[e]=n[t])}));return()=>{this.unwatch(s),n.unwatch(a)}}},v={on(e,t,r){return t=r&&r.isExpr&&!/[^\d\w_\$\.]/.test(t)?r.data.get(t):this._convertExpr(r,t),r&&r.data&&(t=t.bind(r.data)),this.ele.addEventListener(e,t),r?()=>this.ele.removeEventListener(e,t):this},one(e,t,r){const n=r=>{this.off(e,n),t(r)};return this.on(e,n,r),this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t){let r;return e&&(r=new Event(e)),t&&Object.assign(r,t),this.ele.dispatchEvent(r),this}};const x=(e,t,r,...n)=>{const{children:s}=e,a=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];a.push(t)}if(a.forEach((e=>e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(K(e).ele)));const a=s[t];a?e.insertBefore(r,a):e.appendChild(r)}return a},w=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],k={push(...e){const{ele:t}=this;return x(t,t.children.length,0,...e),r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,n=x(t,t.children.length-1,1,...e);return r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),F(n[0])},shift(...e){const{ele:t}=this,n=x(t,0,1,...e);return r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),F(n[0])},unshift(...e){const{ele:t}=this;return x(t,0,0,...e),r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=x(this.ele,...e);return r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(F)},reverse(...e){const t=Array.from(this.ele.childNodes);E.reverse.call(t,...e);const n=document.createDocumentFragment();return t.forEach((e=>{e.__inArray=1,n.append(e)})),this.ele.append(n),t.forEach((e=>{delete e.__inArray})),r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(F);E.sort.call(t,...e);const n=document.createDocumentFragment();return t.forEach((e=>{e.ele.__inArray=1,n.append(e.ele)})),this.ele.append(n),t.forEach((e=>{delete e.ele.__inArray})),r.emitUpdate({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},E=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(E)).forEach((e=>{if("constructor"===e||"length"===e||w.includes(e))return;const t=E[e];a(t)&&(k[e]=function(...e){return t.apply(Array.from(this.ele.children).map(F),e)})}));class A{}for(let[e,t]of Object.entries(k))Object.defineProperty(A.prototype,e,{value:t});const{defineProperty:T,assign:S}=Object,j=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;T(t,e,{enumerable:!0,get:()=>n?Number(r[e]):r[e],set:t=>{n="number"==typeof t,r[e]=t}})}}))},O=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),C=(e,t={})=>{const{name:n,type:s}=t,{ele:a}=e;let i=a[n];e.on(s,(()=>{r.emitUpdate({type:"set",target:e,currentTarget:e,name:n,value:a[n],oldValue:i}),i=a[n]}))},$=e=>{switch(e.attr("type")){case"file":j(["multiple","files"],e),C(e,{name:"files",type:"change"});break;case"checkbox":j(["checked","multiple"],e),C(e,{name:"checked",type:"change"});break;case"radio":j(["checked"],e),C(e,{name:"checked",type:"change"});break;default:j(["placeholder","value"],e),C(e,{name:"value",type:"input"})}},M=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=s.querySelectorAll("option:checked");if(s.multiple)r[t]=Array.from(e).map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var N={formData(e,t={wait:200}){const r=n({});return S(r,M(this,e||"input,select,textarea")),this.watchTick((t=>{S(r,M(this,e||"input,select,textarea"))}),t.wait),r}};const L={},H=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};!function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag);const r=(n=i(t.tag)).charAt(0).toUpperCase()+n.slice(1);var n;if(L[r])throw`Component ${r} already exists`;const s=document.createElement("template");s.innerHTML=t.temp;const a=m(s),c=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},l=L[r]=class extends HTMLElement{constructor(...e){super(...e);const r=F(this);if(t.created&&t.created.call(r),r.extend(t.proto,{enumerable:!1}),t.attrs){const e=c(t.attrs);r.watchTick((t=>{e.forEach((e=>{t.hasModified(e)&&this.setAttribute(o(e),r[e])}))}))}const n={...t.data,...t.attrs};for(let[e,t]of Object.entries(n))r.hasOwnProperty(e)||(r[e]=t);if(t.temp){const e=this.attachShadow({mode:"open"});e.innerHTML=s.innerHTML,g({target:e,data:r,temps:a})}if(t.ready&&t.ready.call(r),t.watch){const e=Object.entries(t.watch);r.watchTick((t=>{for(let[n,s]of e)t.hasModified(n)&&s.call(r,r[n],{watchers:t})}));for(let[t,n]of e)n.call(r,r[t],{})}}connectedCallback(){t.attached&&!D(this)&&t.attached.call(F(this))}disconnectedCallback(){t.detached&&!D(this)&&t.detached.call(F(this))}attributeChangedCallback(e,t,r){const n=F(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[e]=r}static get observedAttributes(){return c(t.attrs||{}).map((e=>o(e)))}};customElements.define(t.tag,l)};function D(e){let t=e;for(;t;){if(t.__inArray)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function R(e,t=!0){const r=[];let n=t?e.__marked_end:e.__marked_start;for(;;)if(n=t?n.nextSibling:n.previousSibling,n instanceof Comment)n.__$ele&&(r.push(n.__$ele),n=t?n.__end:n.__start);else if(!(n instanceof Text))break;return r}const z={_getRenderData(){let e=this.__marked_end;for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null},_renderMarked(){const{ele:e}=this,{parentNode:t}=e,r=`${this.tag}: ${this.__originHTML.trim().slice(0,20).replace(/\n/g,"")} ...`,n=document.createComment(r+" --start"),s=document.createComment(r+" --end");n.__end=s,s.__start=n,s.__$ele=n.__$ele=this,t.insertBefore(n,e),t.insertBefore(s,e),this.__marked_start=n,this.__marked_end=s,Object.defineProperties(e,{__revokes:{set(e){n.__revokes=e},get:()=>n.__revokes}})},_renderContent(){const e=this._getRenderData();if(!e)return;const{target:t,data:r,temps:n}=e,s=this.__marked_end,a=document.createElement("template");a.innerHTML=this.__originHTML,s.parentNode.insertBefore(a.content,s),g({target:t,data:r,temps:n})},_revokeRender(){const e=this.__marked_start;let t=this.__marked_end.previousSibling;for(;t&&t!==e;){V(t);const e=t;t=t.previousSibling,e.remove()}},_refreshCondition(){const t=[this];if(!this._refreshing){switch(this.tag){case"x-if":t.push(...R(this));break;case"x-else-if":t.unshift(...R(this,!1)),t.push(...R(this))}t.forEach((e=>e._refreshing=!0)),e.nextTick((()=>{let e=!1;t.forEach((t=>{if(delete t._refreshing,!e)return t.value||"x-else"===t.tag?(t._renderContent(),void(e=!0)):void t._revokeRender();t._revokeRender()}))}))}}},q={tag:"x-if",data:{value:null},watch:{value(){this._refreshCondition()}},proto:z,ready(){this.__originHTML=this.html,this.html="",this._renderMarked(),e.nextTick((()=>this.ele.remove()))}};H(q),H({...q,tag:"x-else-if"}),H({tag:"x-else",proto:z,ready:q.ready});const P=(e,t,r,n)=>{const a=new s({$data:e,$host:n}),i=K(t.innerHTML),{ele:o}=i;g({target:o,data:a,temps:r,$host:n,isRenderSelf:!0});const c=o.__revokes,l=()=>{h(c,l),a.revoke()};return c.push(l),{ele:o,itemData:a}};H({tag:"x-fill",data:{value:null},watch:{value(t){const r=this._getChilds();if(!t)return void(r&&r.forEach((e=>{V(e),e.remove()})));if(!(t instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${e.getType(t)}`),void(r&&r.forEach((e=>{V(e),e.remove()})));const n=Array.from(t),s=r.map((e=>e.__render_data.$data));if(((e,t)=>{if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0})(s,n))return;const a=this._name,{data:o,temps:c}=this._getRenderData();if(!c)return;const h=c[i(a)],d=this.__marked_end,u=d.parentNode,f=r.slice(),p=o.$host||o;for(let e=0,n=t.length;e<n;e++){const n=t[e],a=r[e];if(!a){const{ele:e}=P(n,h,c,p);u.insertBefore(e,d);continue}const i=a.__render_data.$data;if(n!==i)if(s.includes(n)){const t=r.find((e=>e.__render_data.$data===n));t.__inArray=1,u.insertBefore(t,a),delete t.__inArray,l(r,t,e)}else{const{ele:t}=P(n,h,c,p);u.insertBefore(t,a),r.splice(e,0,t)}}f.forEach(((e,t)=>{const r=s[t];n.includes(r)||(V(e),e.remove())}))}},proto:{_getRenderData:z._getRenderData,_renderMarked:z._renderMarked,_getChilds(){const e=[],{__marked_end:t,__marked_start:r}=this;if(!r)return[];let n=r;for(;n=n.nextSibling,n&&n!==t;)n instanceof Element&&e.push(n);return e}},ready(){this.__originHTML="origin",this._name=this.attr("name"),this._renderMarked(),e.nextTick((()=>this.ele.remove()))}});const{defineProperties:U}=Object,B=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[F(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),U(e,n),(e=>{const{tag:t}=e;if(O.has(t))switch(j(["type","name","disabled"],e),t){case"input":$(e);break;case"textarea":j(["value"],e),C(e,{name:"value",type:"input"});break;case"option":j(["selected","value"],e);break;case"select":j(["value"],e),C(e,{name:"value",type:"change"})}})(r)};class W extends A{constructor({ele:e}){super();const t=s.constructor.call(this,{},d);return B({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele.children.length}$(e){const t=this.ele.querySelector(e);return t?F(t):null}all(e){return Array.from(this.ele.querySelectorAll(e)).map(F)}extend(t,r){return e.extend(this,t,r)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get shadow(){return F(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?F(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?F(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?F(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?F(e):null}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?F(e):null}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}set style(t){if("string"==e.getType(t))return void(this.ele.style=t);let{style:r}=this,n=Array.from(r),s=Object.keys(t);n.forEach((e=>{s.includes(e)||(r[e]="")})),Object.assign(r,t)}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return c(this.ele,e)}remove(){this.ele.remove()}}const I=s.prototype;W.prototype.extend({get:I.get,toJSON:I.toJSON,toString:I.toString,...r,...v,...y,...b,...N},{enumerable:!1});const F=e=>e?e.__xhear__?e.__xhear__:new W({ele:e}):null,J=document.createElement("template"),K=(t,r)=>{if(t instanceof W)return t;if(t instanceof Element)return F(t);switch(e.getType(t)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=F(r);return Object.assign(n,t),n})(t);case"string":return(e=>{J.innerHTML=e;const t=J.content.children[0]||J.content.childNodes[0];return J.innerHTML="",F(t)})(t)}},V=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{V(e)}))};function Y(t){if("string"===e.getType(t)&&!/<.+>/.test(t)){const e=document.querySelector(t);return F(e)}return K(t)}return Object.assign(Y,{stanz:n,render:g,convert:m,register:H,fn:W.prototype,all:e=>Array.from(document.querySelectorAll(e)).map(F)}),Y}));