/*!
* xhear v6.0.0
* https://github.com/kirakiray/Xhear#readme
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);var r=Object.prototype.toString,n=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const s=e=>n(e).search("function")>-1;var i=e=>!Object.keys(e).length;const o=Object.defineProperties,l=Object.getOwnPropertyDescriptor,c=e=>e instanceof m,a=null!==document.currentScript.getAttribute("debug"),h=(()=>{if(a){let e=new Map;return(r,n)=>{n||(n=t());let s=e.get(n);clearTimeout(s),e.set(n,setTimeout(()=>{r(),e.delete(n)}))}}let e=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let n=!1;return(s,i)=>{i||(i=t()),e.set(i,{key:i,fun:s}),n||(n=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),n=!1}))}})(),u=(e,t)=>{Object.keys(t).forEach(r=>{let{get:n,set:s,value:i}=l(t,r);i?e.hasOwnProperty(r)?e[r]=i:Object.defineProperty(e,r,{value:i}):Object.defineProperty(e,r,{get:n,set:s})})},d=(Date.now(),Symbol("self")),p=Symbol("watchs"),f=Symbol("can_update"),g=(e,t)=>{e[p].forEach(e=>e(t)),e.owner.forEach(e=>g(e,t))};class m{constructor(e){if(c(e))return e;let r;e.get?(r=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:y.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):r=new Proxy(this,y),o(this,{[d]:{value:this},xid:{value:"x_"+t()},owner:{value:new Set},length:{configurable:!0,writable:!0,value:0},[p]:{value:new Map},[f]:{writable:!0,value:0}});let n=-1;return Object.keys(e).forEach(t=>{let r=l(e,t),{value:s,get:i,set:c}=r;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>n&&(n=t),i||c?o(this,{[t]:r}):this.setData(t,s))}),n>-1&&(this.length=n+1),this[f]=1,r}watch(e){const r="e_"+t();return this[p].set(r,e),r}unwatch(e){return this[p].delete(e)}setData(e,t){if(/^_/.test(e))return o(this,{[e]:{writable:!0,configurable:!0,value:t}}),!0;let r=n(t);"array"!=r&&"object"!=r||(t=new m(t,this)).owner.add(this);const s=this[e];let i=Reflect.set(this,e,t);return this[f]&&g(this,{xid:this.xid,name:"setData",args:[e,t]}),c(s)&&s.owner.delete(this),i}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[d];let r=t[e];c(r)&&r.owner.delete(t);let n=Reflect.deleteProperty(t,e);return g(this,{xid:this.xid,name:"delete",args:[e]}),n}}const y={set:(e,t,r,n)=>"symbol"==typeof t?Reflect.set(e,t,r,n):e.setData(t,r),deleteProperty:function(e,t){return e.delete(t)}};u(m.prototype,{seek(e){let t=[];if(!s(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{c(r)&&t.push(...r.seek(e))}),t},watchTick(e){return this.watch((e=>{let t=[];const r=n=>{t.push(n),h(()=>{e(t),t.length=0},r)};return r})(e))},watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r=new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const n=this.watch(()=>{let e=r();e&&(this.unwatch(n),t(e))})})},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),c(s)&&(s=s.toJSON()),e[n]=s}),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return o(e,{xid:{get:()=>n}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&o(m.prototype,{[e]:{value:t}})});const b=Array.prototype.splice;u(m.prototype,{splice(e,t,...r){let s=this[d];r=r.map(e=>{let t=n(e);return"array"!=t&&"object"!=t||(e=new m(e)).owner.add(s),e});let i=b.call(s,e,t,...r);return i.forEach(e=>c(e)&&e.owner.delete(s)),g(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),i},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&o(m.prototype,{[e]:{value(...r){let n=t.apply(this[d],r);return g(this,{xid:this.xid,name:e}),n}}})});const x=e=>e.__xEle__?e.__xEle__:e.__xEle__=new N(e),w=document.createElement("template"),E=(e,t)=>!!e.tagName&&(e===t||e!==document&&(w.innerHTML=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`,!!w.content.querySelector(t))),v=document.createElement("div"),_=e=>{return v.innerHTML=e,Array.from(v.children).map(function(e){return v.removeChild(e),e})},O=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let r=0;for(;r in e;){let n=O(e[r]);t.appendChild(n),r++}return t},A={get:(e,t,r)=>"string"!=typeof t||/\D/.test(t)?Reflect.get(e,t,r):x(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},j=Symbol("events"),S=m.prototype.setData,k=["text","html","show","style"],C=Symbol("cansetkeys");class N extends m{constructor(e){super(Object.assign({tag:e.tagName.toLowerCase()},A));const t=this[d];o(t,{ele:{get:()=>e},[j]:{writable:!0,value:""},[C]:{value:new Set(k)}}),delete t.length}setData(e,t){if(!this[C]||this[C].has(e))return S.call(this,e,t)}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?x(e):null}get length(){return this.ele.children.length}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get style(){return this.ele.style}set style(e){if("string"==n(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),s=Object.keys(e);r.forEach(e=>{s.includes(e)||(t[e]="")}),Object.assign(t,e)}get show(){return"none"!==this.ele.style.display}set show(e){this.ele.style.display=e?"":"none"}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}$(e){return x(this.ele.querySelector(e))}all(e){return Array.from(this.ele.children).map(e=>x(e))}is(e){return E(this.ele,e)}attr(...e){let[t,r]=e,{ele:n}=this;if(1==e.length)return t instanceof Object&&Object.keys(t).forEach(e=>{n.setAttribute(e,t[e])}),n.getAttribute(t);n.setAttribute(t,r)}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(E(t,e))return!0})),t.map(e=>x(e))}parents(e,t){let r=[],s=this.parent;if(e){if("string"==n(e))for(;s&&s;)E(s.ele,e)&&r.push(s),s=s.parent}else for(;s;)r.push(s),s=s.parent;if(t)if(t instanceof XhearEle){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==n(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}clone(){let e=x(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}}["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{const t=Array.prototype[e];t&&Object.defineProperty(N.prototype,e,{value(...e){return t.apply(Array.from(this.ele.children).map(x),e)}})}),u(N.prototype,{splice(e,t,...r){const{ele:s}=this,i=Array.from(s.children),o=[];let l=e,c=t,a=i[l];for(;a&&c>0;)o.push(a),s.removeChild(a),c--,a=i[++l];if(r.length){let t=document.createDocumentFragment();r.forEach(e=>{if(e instanceof Element)return void t.appendChild(e);if(e instanceof N)return void t.appendChild(e.ele);let r=n(e);"string"==r?_(e).forEach(e=>{t.appendChild(e)}):"object"==r&&t.appendChild(O(e))}),e>=this.length?s.appendChild(t):s.insertBefore(t,s.children[e])}return g(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),o},sort(e){const t=this.ele,r=Array.from(t.children).map(x).sort(e),n=document.createDocumentFragment();return r.forEach(e=>{e.ele.__runarray=1,n.appendChild(e.ele)}),t.appendChild(n),r.forEach(e=>delete e.ele.__runarray),g(this,{xid:this.xid,name:"sort"}),this},reverse(){const e=this.ele;return Array.from(e.children).reverse().forEach(t=>e.appendChild(t)),g(this,{xid:this.xid,name:"reverse"}),this}});const T=e=>e[j]?e[j]:e[j]=new Map,D=e.MouseEvent||Event,P=e.TouchEvent||Event,L=new Map([["click",D],["mousedown",D],["mouseup",D],["mousemove",D],["mouseenter",D],["mouseleave",D],["touchstart",P],["touchend",P],["touchmove",P]]),H=(e,t,r,n=!0)=>{let s=L.get(t)||CustomEvent;const i=t instanceof Event?t:new s(t,{bubbles:n,cancelable:!0});return i.data=r,e.ele.dispatchEvent(i)};u(N.prototype,{on(e,r,n){if(s(r))n=r,r=void 0;else{const e=n,{ele:t}=this;n=(n=>{n.path.some(s=>{if(s==t)return!0;x(s).is(r)&&(n.selector=s,e(n),delete n.selector)})})}this.ele.addEventListener(e,n);const i="e_"+t();return T(this).set(i,{name:e,selector:r,callback:n}),i},off(e){let t=T(this).get(e);return!!t&&(this.ele.removeEventListener(t.name,t.callback),this[j].delete(e),!0)},one(e,t,r){let n,s;return"string"==typeof t?(s=r,r=(e=>{s(e),this.off(n)})):(s=t,t=(e=>{s(e),this.off(n)})),n=this.on(e,t,r)},trigger(e,t){return H(this,e,t)},triggerHandler(e,t){return H(this,e,t,!1)}}),["click","focus","blur"].forEach(e=>{u(N.prototype,{[e](t){if(!s(t))return this.trigger(e,t);this.on(e,t)}})});const M=(e,t)=>{const{attrs:r,data:n,watch:s,proto:i}=e,o=[...Object.keys(r),...Object.keys(n),...Object.keys(s)],l=Object.getOwnPropertyDescriptors(i);Object.keys(l).forEach(e=>{let{set:t}=l[e];t&&o.push(e)}),o.forEach(e=>t[C].add(e));const c=t[d];u(c,i),Object.assign(c,n,r)},I=e=>{var t=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);t&&t.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<span :text="${r[1]}"></span>`))});const r=document.createElement("template");return r.innerHTML=e,Array.from(r.content.querySelectorAll("*")).forEach(e=>{const t={},r={},n={};let s=[];Array.from(e.attributes).forEach(e=>{let{name:i,value:o}=e,l=/^attr:(.+)/.exec(i);if(l)return t[l[1]]=o,void s.push(i);let c=/^:(.+)/.exec(i);c&&(r[c[1]]=o,s.push(i));let a=/^@(.+)/.exec(i);return a?(n[a[1]]={name:o},void s.push(i)):void 0}),!i(t)&&e.setAttribute("x-attr",JSON.stringify(t)),!i(r)&&e.setAttribute("x-prop",JSON.stringify(r)),!i(n)&&e.setAttribute("x-on",JSON.stringify(n)),s.forEach(t=>e.removeAttribute(t))}),J(r),r.innerHTML},J=e=>{e.content.querySelectorAll("[x-if]").forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(e.content.querySelectorAll("template")).forEach(J)},$=(e,t)=>Array.from(e.querySelectorAll(t)),q=e=>new Function("...$args",`\n        const [$event] = $args;\n        \n        with(this){\n            return ${e};\n        }\n    `),R=(e,t,r,n)=>{if(e===t){let s,i=(s=W.test(r)?q(r).bind(t):()=>e[r])();n(i),e.watchTick(()=>{const e=s();i!==e&&(n(e),i=e)})}},W=/[\(\)\;\.\=\>\<]/,F=({host:e,xdata:t,content:r})=>{$(r,"[x-on]").forEach(t=>{let r=JSON.parse(t.getAttribute("x-on")),n=[];Object.keys(r).forEach(t=>{let s,{name:i}=r[t];if(W.test(i)){const r=q(i);s=e.on(t,t=>{r.call(e,t)})}else s=e.on(t,t=>{e[i]&&e[i].call(e,t)});n.push(s)}),t.setAttribute("rendered-on",JSON.stringify(n))}),$(r,"[x-attr]").forEach(r=>{const n=JSON.parse(r.getAttribute("x-attr"));Object.keys(n).forEach(s=>{R(t,e,n[s],e=>{r.setAttribute(s,e)})})}),$(r,"[x-prop]").forEach(r=>{const n=JSON.parse(r.getAttribute("x-prop")),s=x(r);Object.keys(n).forEach(r=>{R(t,e,n[r],e=>{s[r]=e})})}),$(r,"[x-if]").forEach(r=>{const n=r.getAttribute("x-if");let s,{textnode:i,parent:o}=(e=>{let t=document.createTextNode(""),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{textnode:t,parent:r}})(r);R(t,e,n,e=>{e?(s=K(r.content.children[0].outerHTML).ele,o.insertBefore(s,i)):s&&s.parentNode.removeChild(s)})})};function K(e){if(e instanceof Element)return x(e);const t=n(e);return"string"==t?/\<.+\>/.test(e)?x(_(e)[0]):x(document.querySelector(e)):"object"==t?x(O(e)):null}Object.assign(K,{all:e=>Array.from(document.querySelectorAll(e)).map(e=>x(e)),register:e=>{const t={tag:"",temp:"",attrs:{},data:{},watch:{},proto:{}};Object.assign(t,e),t.temp&&(t.temp=I(t.temp));customElements.define(t.tag,class extends HTMLElement{constructor(...e){super(...e);const r=x(this);if(M(t,r),t.temp){const e=this.attachShadow({mode:"open"});e.innerHTML=t.temp,F({host:r,xdata:r,content:e})}}connectedCallback(){console.log("connectedCallback => ",this),this.__x_connected=!0,t.attached&&!this.__x_runned_connected&&nexTick(()=>{this.__x_connected&&!this.__x_runned_connected&&(this.__x_runned_connected=!0,t.attached.call(x(this)))})}disconnectedCallback(){console.log("disconnectedCallback => ",this),this.__x_connected=!1,t.detached&&!this.__x_runnded_disconnected&&nexTick(()=>{this.__x_connected||this.__x_runnded_disconnected||(this.__x_runnded_disconnected=!0,t.detached.call(x(this)))})}})}}),e.$=K})(window);