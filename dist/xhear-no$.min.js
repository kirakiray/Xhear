(e=>{"use strict";let t=e.$,r=t.fn,a={};e.tagDatabase=a;const{assign:n,create:s,defineProperty:i,defineProperties:l}=Object;let o=e=>void 0!==e&&null!==e;const h=(e,t)=>{if(!e.getAttribute)return!1;let r=e.getAttribute(t);return null!==r&&void 0!==r||void 0};let c=Object.prototype.toString;const d=e=>c.call(e).toLowerCase().replace(/(\[object )|(])/g,""),v=(e,t)=>Array.from(e).forEach(t),u=()=>Math.random().toString(32).substr(2),f=((()=>{let e=!1,t=[]})(),"_"+u()),p=f+"_watchs",x=p+"_get",w=f+"_observer",m=u()+"_xhearobj",b=u()+"_attached",g=u()+"xdatas",y=e=>{let t=e.tagName.toLowerCase();return a[t]},A=e=>{let t=e[m],r=s(t);return r.push(e),r},N=e=>1==e.length&&e[0][m]?A(e[0]):(e=>{let t=s(O);return t.splice(-1,0,...e),e.prevObject&&(t.prevObject=e.prevObject),t})(e),j=e=>{e.is("[xv-ele]")&&e.each((e,t)=>{k(t)}),t("[xv-ele]",Array.from(e)).each((e,t)=>{k(t)})};let O=s(r),$=100;const k=e=>{if(!h(e,"xv-ele"))return;let r=y(e);if(!r)return void console.warn("no exist tag",e);let a=t(e),s=Array.from(e.childNodes);e.innerHTML=r.temp;let l=++$,c=new r.XHear;e[m]=c;let v=A(e);v.xdata=v[g],a.removeAttr("xv-ele").attr("xv-render",l),a.find("*").attr("xv-shadow",l),t(`[xv-ele][xv-shadow="${l}"]`,e).each((e,t)=>{k(t)}),t(`xv-span[xv-shadow="${l}"]`,e).each((e,t)=>{var r=document.createTextNode("");t.parentNode.insertBefore(r,t),t.parentNode.removeChild(t);var a=t.getAttribute("svkey");c.watch(a,e=>{r.textContent=e})});let u=t(`[xv-content][xv-shadow="${l}"]`,e);if(0 in u&&(i(c,"$content",{enumerable:!0,get:()=>N(u)}),u.prop("svParent",e),u.append(s),r.childChange)){let t=new MutationObserver(t=>{t.forEach(t=>{let{addedNodes:a,removedNodes:n}=t,s={};0 in a&&(s.addedNodes=Array.from(a)),0 in n&&(s.removedNodes=Array.from(n)),r.childChange(A(e),s)})});t.observe(u[0],{attributes:!1,childList:!0,characterData:!1,subtree:!1}),c.__obs=t}t(`[xv-tar][xv-shadow="${l}"]`,e).each((e,r)=>{let a=t(r).attr("xv-tar");i(c,"$"+a,{enumerable:!0,get:()=>N([r])})});let f=n({},r.data);r.attrs.forEach(e=>{let t=a.attr(e);o(t)&&(f[e]=t),c.watch(e,t=>{a.attr(e,t)})}),r.props.forEach(e=>{let t=a.attr(e);o(t)&&(f[e]=t)}),t(`[xv-module][xv-shadow="${l}"]`,e).each((e,r)=>{let a=t(r),n=a.attr("xv-module");c.watch(n,e=>{r.value=e}),r[m]?r[m].watch("value",e=>{c[n]=e}):a.on("change input",e=>{c[n]=r.value})}),a.removeAttr("xv-ele").attr("xv-render",l);let p=r.watch;if(p)for(let e in p)e in f||(f[e]=void 0);if(c.set(Object.keys(f)),p)for(let e in p){let t,r,a=p[e];switch(d(a)){case"function":r=a;break;case"object":t=a.get,r=a.set}t&&E(c,e,t.bind(v)),r&&c.watch(e,r.bind(v))}"value"in f&&i(e,"value",{get:()=>c.value,set(e){c.value=e}});for(let e in f)o(f[e])&&(c[e]=f[e]);r.inited&&r.inited.call(e,v),r.attached&&e.getRootNode()===document&&!e[b]&&(r.attached.call(e,v),e[b]=1)};let _=function(...e){let r=t(...e),[a,n]=e;("string"==d(a)&&a.search("<")>-1||a instanceof Element)&&j(r);let s;return n&&(n.getAttribute?s=n.getAttribute("xv-shadow"):n.attr&&(s=n.attr("xv-shadow"))),r=s?H(r,s):H(r),r=N(r)};_.prototype=r,n(_,{init:(...e)=>N(e)},t);const P=(e,t,r=p)=>e[r]&&(e[r][t]||(e[r][t]=[])),E=(e,t,r)=>{P(e,t).push(r)},S=(e,t,r,a,n="update")=>{"update"===n&&v(P(e,t),e=>{e(r,a)}),v(e[w],e=>{e({name:t,type:n,oldVal:a,val:r})})},C=(e,t,r,a)=>{e.watch(t,e=>{r[a]=e}),r.watch(a,r=>{e[t]=r}),r[a]=e[t]};let L=function(){i(this,p,{value:{}}),i(this,g,{value:{}}),this.xdata=this[g],i(this,x,{value:{}}),i(this,w,{value:[]})},D={watch(e,t){switch(d(e)){case"string":P(this,e).push(t);break;case"object":for(let t in e)this.watch(t,e[t])}},unwatch(e,t){if(e&&t){let r=P(this,e),a=r.indexOf(t);r.splice(a,1)}},set(e,t){switch(d(e)){case"object":for(let t in e)this.set(t,e[t]);return;case"array":return void v(e,e=>this.set(e))}let r=this[g];r[e]=t,i(this,e,{enumerable:!0,get(){return P(this,e,x).forEach(t=>{t(r[e])}),r[e]},set(t){let a=r[e];r[e]=t;let n=0;a!==t&&(n=1),n&&S(this,e,t,a)}}),S(this,e,t,void 0,"new"),this[e]=t},emit(e){S(this,e,this[e],this[e])},observe(e){return e&&this[w].push(e),this},unobserve(e){if(e){let t=this[w],r=t.indexOf(e);r>-1&&t.splice(r,1)}return this},cover(e){for(let t in e)t in this&&(this[t]=e[t]);return this}},R={syncData:{value(e,t){if(!(e instanceof L||e.svRender))throw"the arg1 is not xdata";switch(d(t)){case"object":for(let r in t)C(this,r,e,t[r]);break;case"array":v(t,t=>{C(this,t,e,t)});break;case"string":C(this,t,e,t);break;default:for(let t in this)t in e&&C(this,t,e,t)}return this}},transData:{value(e){let t={key:"",target:"",targetKey:""};n(t,e);let{key:r,target:a,targetKey:s,trans:i,get:l,set:o}=t;if(t.trans){let e={};for(let t in i)e[i[t]]=t;this.watch(r,e=>{e=i[e],a[s]=e}),a.watch(s,t=>{t=e[t],this[r]=t}),t.target[t.targetKey]=i[this[t.key]]}else l&&a.watch(s,e=>{e=l(e),this[r]=e}),o&&this.watch(r,e=>{e=o(e),a[s]=e});return this}}};for(let e in D)R[e]={value:D[e]};l(L.prototype,R),_.xdata=function(e,t){let r=new L;return r.set(e),r};let M=Object.create(O);M.svRender=!0,n(M,D);const T=e=>{let r={tag:"",temp:"",attrs:[],props:[],data:{},watch:{}};n(r,e);let{proto:i,props:l,temp:o,tag:h}=r;l.push("value");let c=function(){L.call(this),delete this.xdata},d=M;i&&(d=s(M),n(d,i)),c.prototype=d;var v=(o=o.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);v&&v.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(o=o.replace(e,`<xv-span svkey="${t[1].trim()}"></xv-span>`))}),a[h]=n({},r,{XHear:c,temp:o}),t(r.tag+"[xv-ele]").each((e,t)=>{k(t)})};_.register=T;const H=(e,r)=>{let a=0,n=[],{prevObject:s}=e;return r?e.each((e,t)=>{h(t,"xv-shadow")&&t.getAttribute("xv-shadow")==r&&(n.push(t),a=1)}):e.each((e,t)=>{h(t,"xv-shadow")?a=1:n.push(t)}),a&&(e=t(n),s&&(e.prevObject=s)),e},K=(e,t)=>{let r=e[0].tagName.toLowerCase(),n=a[r],s=new Set([...Object.keys(n.data),...n.props,...n.attrs]);v(s,r=>{e[r]=t[r]})},U=e=>{let r=e.attr("xv-render");r&&(e.find(`[xv-shadow="${r}"]:not([xv-content])`).remove(),e.find(`[xv-shadow="${r}"][xv-content]`).each((e,r)=>{t(r).before(r.childNodes).remove()}));e.find("[xv-render]").each((e,r)=>{U(t(r))})},q=(e,r)=>{let a=d(r);if(e.is("[xv-shadow]")){let n=e.attr("xv-shadow");if("string"==a&&r.search("<")>-1){let e=t(r);e.attr("xv-shadow",n),e.find("*").attr("xv-shadow",n),r="",v(e,e=>{r+=e.outerHTML})}else a instanceof Element?t(r).attr("xv-shadow",n):r instanceof _&&t(Array.from(r)).attr("xv-shadow",n)}return r},B=e=>(e.is("[xv-render]")&&(e=e.map((e,t)=>{let r=t,a=t[m];for(;a&&a.$content;)a=(r=a.$content[0]).xvData;return r})),e);n(O,{add(...t){let a=t[0];if(a instanceof e.$&&a.is("xv-shadow"))throw"shadow element can't use add";return r.add.apply(this,t)},attr(...e){let[a,n]=e;if(!n||!this.is("[xv-render]"))return r.attr.apply(this,e);this.each((s,i)=>{let l=y(i);l&&l.attrs.indexOf(a)>-1?i[m][a]=n:r.attr.apply(t(i),e)})},clone(...e){if(this.is("[xv-shadow]"))throw"shadow element can't use clone";if(this.svRender){let e=this.html(),r=t(`<div>${e}</div>`);r.find("[xv-render]").each((e,r)=>{t(r).removeAttr("xv-render").attr("xv-ele","")}),e=r.html();this[0].tagName.toLowerCase();let a=this[0].cloneNode();t(a).removeAttr("xv-render").attr("xv-ele","").html(e),k(a);let n=A(a);K(n,this);let s=t("[xv-render]:not([xv-shadow])",this);if(0 in s){let e=t("[xv-render]:not([xv-shadow])",n);e.length==s.length&&e.each((e,t)=>{let r=s[e];if(r.tagName!==t.tagName)return console.warn("cloned xv-ele data does not match"),!1;K(A(t),A(r))})}return n}{let a=this.is("[xv-render]"),n=0 in this.find("[xv-render]");if(a||n){let r=t(Array.from(this)),a=r.clone(...e);U(a),a.find("[xv-render]").removeAttr("xv-render").attr("xv-ele",""),j(a),r.each((e,t)=>{h(t,"xv-render")&&(a[e]=A(t).clone()[0])});let n=e=>{let t=a.find(e);if(0 in t){let a=r.find(e);t.length==a.length&&a.each((e,r)=>{K(A(t[e]),A(r))})}};return n("[xv-render]:not([xv-shadow])"),n("[xv-render][xv-shadow]"),this.prevObject&&(a.prevObject=this),N(a)}r.clone.apply(this,e)}},empty(){return r.empty.call(B(this)),this},parent(e){let t=this.map((e,t)=>{let r=t.parentNode;for(;r.svParent;)r=r.svParent;return r}),r=N(Array.from(new Set(t)));return e&&(r=r.filter(e)),r},parents(e){let t=[];this.each((e,r)=>{let a=r.parentNode;for(;a&&a!==document;){for(;a.svParent;)a=a.svParent;t.push(a),a=a.parentNode}});let r=N(Array.from(new Set(t)));return e&&(r=r.filter(e)),r},parentsUntil(e){let r=[];return this.each((a,n)=>{let s=n.parentNode;for(;s&&s!==document;){for(;s.svParent;)s=s.svParent;if(e&&t(s).is(e))break;r.push(s),s=s.parentNode}}),N(new Set(r))},unwrap(){let e=t(this).parent();return e.is("[xv-content]")?e.each((e,r)=>{let{svParent:a}=r;a=t(a?a:r);let n=r.childNodes;v(n,e=>{a.before(e)}),a.remove()}):r.unwrap.call(this),this},findReal(...e){return N(r.find.apply(this,e))},findShadow(...e){let t=r.find.apply(this,e);return t=H(t,this.attr("xv-render")),N(t)}}),v(["after","before","wrap","wrapAll","replaceWith"],e=>{let t=r[e];t&&(O[e]=function(e){return t.call(this,q(this,e)),j(this.parent()),this})}),v(["insertAfter","insertBefore","replaceAll"],e=>{let a=r[e];a&&(O[e]=function(r){if(this.is("[xv-shadow]"))throw"shadow element can't use "+e;return a.call(q(t(r),this),r),this})}),v(["append","prepend","wrapInner"],e=>{let t=r[e];t&&(O[e]=function(e){return t.call(B(this),q(this,e)),j(this),this})}),v(["appendTo","prependTo"],e=>{let a=r[e];a&&(O[e]=function(r){if(this.is("[xv-shadow]"))throw"shadow element can't use "+e;let n=t(r);return n.is("[xv-shadow]")&&q(n,this),a.call(this,B(n)),this})}),v(["find","children"],e=>{let t=r[e];t&&(O[e]=function(e){let r=t.call(B(this),e);return 1==r.length&&r[0][m]?r=A(r[0]):(r=this.is("[xv-shadow]")?H(r,this.attr("xv-shadow")):H(r),r=N(r)),r})}),v(["eq","first","last","filter","has","not","slice","next","nextAll","nextUntil","prev","prevAll","prevUntil","siblings"],e=>{r[e]&&(O[e]=function(...t){let a=r[e].apply(this,t);return a=N(a)})}),v(["html","text"],e=>{let a=r[e];a&&(O[e]=function(r){let n=this;if((e=>void 0===e)(r)){let e=t(n[0]);if(0 in e.find("[xv-shadow]")){let r=t(e[0].cloneNode(!0));return U(r),a.call(r)}return a.call(e)}return"text"!==e&&(r=q(this,r)),n=a.call(B(this),r),j(this),n})}),(()=>{let{pushStack:e}=r;e&&(O.pushStack=function(...t){return N(e.apply(this,t))})})();const X={register:T};e.xhear=X,e.$=_,t(()=>{const e=e=>{if(e[b])return;let t=y(e);t.attached&&t.attached.call(e,A(e)),e[b]=1},r=e=>{if(e.getRootNode()!=document){let r=y(e);r.detached&&r.detached.call(e,A(e)),t("[xv-content]",e).each((e,t)=>{delete t.svParent});let a=e[m];a&&(a.__obs&&a.__obs.disconnect(),delete a.__obs,delete e[m])}};new MutationObserver(a=>{a.forEach(a=>{let{addedNodes:n,removedNodes:s}=a;n&&0 in n&&v(n,t=>{t[m]&&e(t),t instanceof Element&&v(t.querySelectorAll("[xv-render]"),t=>{e(t)})}),s&&0 in s&&v(s,e=>{e[m]&&r(e),t("[xv-render]",e).each((e,t)=>{r(t)})})})}).observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),t("[xv-ele]").each((e,t)=>{k(t)})}),t("head").append("<style>[xv-ele]{display:none}</style>")})(window);